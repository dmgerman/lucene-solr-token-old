begin_unit
name|'import'
name|'types'
newline|'\n'
name|'import'
name|'re'
newline|'\n'
name|'import'
name|'time'
newline|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'shutil'
newline|'\n'
name|'import'
name|'sys'
newline|'\n'
name|'import'
name|'cPickle'
newline|'\n'
name|'import'
name|'datetime'
newline|'\n'
nl|'\n'
comment|'# TODO'
nl|'\n'
comment|'#   - build wiki/random index as needed (balanced or not, varying # segs, docs)'
nl|'\n'
comment|'#   - verify step'
nl|'\n'
comment|'#   - run searches'
nl|'\n'
comment|'#   - get all docs query in here'
nl|'\n'
nl|'\n'
name|'if'
name|'sys'
op|'.'
name|'platform'
op|'.'
name|'lower'
op|'('
op|')'
op|'.'
name|'find'
op|'('
string|"'darwin'"
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
DECL|variable|osName
indent|'  '
name|'osName'
op|'='
string|"'osx'"
newline|'\n'
dedent|''
name|'elif'
name|'sys'
op|'.'
name|'platform'
op|'.'
name|'lower'
op|'('
op|')'
op|'.'
name|'find'
op|'('
string|"'win'"
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
DECL|variable|osName
indent|'  '
name|'osName'
op|'='
string|"'windows'"
newline|'\n'
dedent|''
name|'elif'
name|'sys'
op|'.'
name|'platform'
op|'.'
name|'lower'
op|'('
op|')'
op|'.'
name|'find'
op|'('
string|"'linux'"
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
DECL|variable|osName
indent|'  '
name|'osName'
op|'='
string|"'linux'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
DECL|variable|osName
indent|'  '
name|'osName'
op|'='
string|"'unix'"
newline|'\n'
nl|'\n'
DECL|variable|TRUNK_DIR
dedent|''
name|'TRUNK_DIR'
op|'='
string|"'/lucene/clean'"
newline|'\n'
DECL|variable|FLEX_DIR
name|'FLEX_DIR'
op|'='
string|"'/lucene/flex.branch'"
newline|'\n'
nl|'\n'
DECL|variable|DEBUG
name|'DEBUG'
op|'='
name|'False'
newline|'\n'
nl|'\n'
comment|'# let shell find it:'
nl|'\n'
DECL|variable|JAVA_COMMAND
name|'JAVA_COMMAND'
op|'='
string|"'java -Xms2048M -Xmx2048M -Xbatch -server'"
newline|'\n'
comment|"#JAVA_COMMAND = 'java -Xms1024M -Xmx1024M -Xbatch -server -XX:+AggressiveOpts -XX:CompileThreshold=100 -XX:+UseFastAccessorMethods'"
nl|'\n'
nl|'\n'
DECL|variable|INDEX_NUM_THREADS
name|'INDEX_NUM_THREADS'
op|'='
number|'1'
newline|'\n'
nl|'\n'
DECL|variable|INDEX_NUM_DOCS
name|'INDEX_NUM_DOCS'
op|'='
number|'5000000'
newline|'\n'
nl|'\n'
DECL|variable|LOG_DIR
name|'LOG_DIR'
op|'='
string|"'logs'"
newline|'\n'
nl|'\n'
DECL|variable|DO_BALANCED
name|'DO_BALANCED'
op|'='
name|'False'
newline|'\n'
nl|'\n'
name|'if'
name|'osName'
op|'=='
string|"'osx'"
op|':'
newline|'\n'
DECL|variable|WIKI_FILE
indent|'  '
name|'WIKI_FILE'
op|'='
string|"'/x/lucene/enwiki-20090724-pages-articles.xml.bz2'"
newline|'\n'
DECL|variable|INDEX_DIR_BASE
name|'INDEX_DIR_BASE'
op|'='
string|"'/lucene'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
DECL|variable|WIKI_FILE
indent|'  '
name|'WIKI_FILE'
op|'='
string|"'/x/lucene/enwiki-20090724-pages-articles.xml.bz2'"
newline|'\n'
DECL|variable|INDEX_DIR_BASE
name|'INDEX_DIR_BASE'
op|'='
string|"'/x/lucene'"
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'DEBUG'
op|':'
newline|'\n'
DECL|variable|NUM_ROUND
indent|'  '
name|'NUM_ROUND'
op|'='
number|'0'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
DECL|variable|NUM_ROUND
indent|'  '
name|'NUM_ROUND'
op|'='
number|'7'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
number|'0'
op|':'
newline|'\n'
indent|'  '
name|'print'
string|"'compile...'"
newline|'\n'
name|'if'
string|"'-nocompile'"
name|'not'
name|'in'
name|'sys'
op|'.'
name|'argv'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'os'
op|'.'
name|'system'
op|'('
string|"'ant compile > compile.log 2>&1'"
op|')'
op|'!='
number|'0'
op|':'
newline|'\n'
indent|'      '
name|'raise'
name|'RuntimeError'
op|'('
string|"'compile failed (see compile.log)'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'BASE_SEARCH_ALG'
op|'='
string|'\'\'\'\nanalyzer=org.apache.lucene.analysis.standard.StandardAnalyzer\ndirectory=FSDirectory\nwork.dir = $INDEX$\nsearch.num.hits = $NUM_HITS$\nquery.maker=org.apache.lucene.benchmark.byTask.feeds.FileBasedQueryMaker\nfile.query.maker.file = queries.txt\nprint.hits.field = $PRINT_FIELD$\nlog.queries=true\nlog.step=100000\n\n$OPENREADER$\n{"XSearchWarm" $SEARCH$}\n\n# Turn off printing, after warming:\nSetProp(print.hits.field,)\n\n$ROUNDS$\nCloseReader \nRepSumByPrefRound XSearch\n\'\'\''
newline|'\n'
nl|'\n'
name|'BASE_INDEX_ALG'
op|'='
string|'\'\'\'\nanalyzer=org.apache.lucene.analysis.standard.StandardAnalyzer\n\n$OTHER$\ndeletion.policy = org.apache.lucene.benchmark.utils.NoDeletionPolicy\ndoc.tokenized = false\ndoc.body.tokenized = true\ndoc.stored = true\ndoc.body.stored = false\ndoc.term.vector = false\nlog.step.AddDoc=10000\n\ndirectory=FSDirectory\nautocommit=false\ncompound=false\n\nwork.dir=$WORKDIR$\n\n{ "BuildIndex"\n  - CreateIndex\n  $INDEX_LINE$\n  - CommitIndex(dp0)\n  - CloseIndex\n  $DELETIONS$\n}\n\nRepSumByPrefRound BuildIndex\n\'\'\''
newline|'\n'
nl|'\n'
DECL|class|RunAlgs
name|'class'
name|'RunAlgs'
op|':'
newline|'\n'
nl|'\n'
DECL|member|__init__
indent|'  '
name|'def'
name|'__init__'
op|'('
name|'self'
op|','
name|'resultsPrefix'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'self'
op|'.'
name|'counter'
op|'='
number|'0'
newline|'\n'
name|'self'
op|'.'
name|'results'
op|'='
op|'['
op|']'
newline|'\n'
name|'self'
op|'.'
name|'fOut'
op|'='
name|'open'
op|'('
string|"'%s.txt'"
op|'%'
name|'resultsPrefix'
op|','
string|"'wb'"
op|')'
newline|'\n'
nl|'\n'
DECL|member|makeIndex
dedent|''
name|'def'
name|'makeIndex'
op|'('
name|'self'
op|','
name|'label'
op|','
name|'dir'
op|','
name|'source'
op|','
name|'numDocs'
op|','
name|'balancedNumSegs'
op|'='
name|'None'
op|','
name|'deletePcts'
op|'='
name|'None'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'if'
name|'source'
name|'not'
name|'in'
op|'('
string|"'wiki'"
op|','
string|"'random'"
op|')'
op|':'
newline|'\n'
indent|'      '
name|'raise'
name|'RuntimeError'
op|'('
string|"'source must be wiki or random'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'dir'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'      '
name|'fullDir'
op|'='
string|"'%s/contrib/benchmark'"
op|'%'
name|'dir'
newline|'\n'
name|'if'
name|'DEBUG'
op|':'
newline|'\n'
indent|'        '
name|'print'
string|"'  chdir %s'"
op|'%'
name|'fullDir'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'chdir'
op|'('
name|'fullDir'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'indexName'
op|'='
string|"'%s.%s.nd%gM'"
op|'%'
op|'('
name|'source'
op|','
name|'label'
op|','
name|'numDocs'
op|'/'
number|'1000000.0'
op|')'
newline|'\n'
name|'if'
name|'balancedNumSegs'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'      '
name|'indexName'
op|'+='
string|"'_balanced%d'"
op|'%'
name|'balancedNumSegs'
newline|'\n'
dedent|''
name|'fullIndexPath'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'INDEX_DIR_BASE'
op|','
name|'indexName'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'fullIndexPath'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'print'
string|"'Index %s already exists...'"
op|'%'
name|'fullIndexPath'
newline|'\n'
name|'return'
name|'indexName'
newline|'\n'
nl|'\n'
dedent|''
name|'print'
string|"'Now create index %s...'"
op|'%'
name|'fullIndexPath'
newline|'\n'
nl|'\n'
name|'s'
op|'='
name|'BASE_INDEX_ALG'
newline|'\n'
nl|'\n'
name|'if'
name|'source'
op|'=='
string|"'wiki'"
op|':'
newline|'\n'
indent|'      '
name|'other'
op|'='
string|"'''doc.index.props = true\ncontent.source=org.apache.lucene.benchmark.byTask.feeds.EnwikiContentSource\ndocs.file=%s\n'''"
op|'%'
name|'WIKI_FILE'
newline|'\n'
comment|"#addDoc = 'AddDoc(1024)'"
nl|'\n'
name|'addDoc'
op|'='
string|"'AddDoc'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'other'
op|'='
string|"'''doc.index.props = true\ncontent.source=org.apache.lucene.benchmark.byTask.feeds.SortableSingleDocSource\n'''"
newline|'\n'
name|'addDoc'
op|'='
string|"'AddDoc'"
newline|'\n'
dedent|''
name|'if'
name|'INDEX_NUM_THREADS'
op|'>'
number|'1'
op|':'
newline|'\n'
comment|"#other += 'doc.reuse.fields=false\\n'"
nl|'\n'
indent|'      '
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'$INDEX_LINE$'"
op|','
string|'\'[ { "AddDocs" %s > : %s } : %s\''
op|'%'
op|'('
name|'addDoc'
op|','
name|'numDocs'
op|'/'
name|'INDEX_NUM_THREADS'
op|','
name|'INDEX_NUM_THREADS'
op|')'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'$INDEX_LINE$'"
op|','
string|'\'{ "AddDocs" %s > : %s\''
op|'%'
op|'('
name|'addDoc'
op|','
name|'numDocs'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'$WORKDIR$'"
op|','
name|'fullIndexPath'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'deletePcts'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'      '
name|'dp'
op|'='
string|"'# Do deletions\\n'"
newline|'\n'
name|'dp'
op|'+='
string|"'OpenReader(false)\\n'"
newline|'\n'
name|'for'
name|'pct'
name|'in'
name|'deletePcts'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'pct'
op|'!='
number|'0'
op|':'
newline|'\n'
indent|'          '
name|'dp'
op|'+='
string|"'DeleteByPercent(%g)\\n'"
op|'%'
name|'pct'
newline|'\n'
name|'dp'
op|'+='
string|"'CommitIndex(dp%g)\\n'"
op|'%'
name|'pct'
newline|'\n'
dedent|''
dedent|''
name|'dp'
op|'+='
string|"'CloseReader()\\n'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'dp'
op|'='
string|"''"
newline|'\n'
nl|'\n'
dedent|''
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'$DELETIONS$'"
op|','
name|'dp'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'balancedNumSegs'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'      '
name|'other'
op|'+='
string|"'''  merge.factor=1000\n  max.buffered=%d\n  ram.flush.mb=2000\n  '''"
op|'%'
op|'('
name|'numDocs'
op|'/'
name|'balancedNumSegs'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'source'
op|'=='
string|"'random'"
op|':'
newline|'\n'
indent|'        '
name|'other'
op|'+='
string|"'ram.flush.mb=1.0\\n'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'other'
op|'+='
string|"'ram.flush.mb=32.0\\n'"
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'$OTHER$'"
op|','
name|'other'
op|')'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'      '
name|'self'
op|'.'
name|'runOne'
op|'('
name|'dir'
op|','
name|'s'
op|','
string|"'index_%s'"
op|'%'
name|'indexName'
op|','
name|'isIndex'
op|'='
name|'True'
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'fullIndexPath'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'shutil'
op|'.'
name|'rmtree'
op|'('
name|'fullIndexPath'
op|')'
newline|'\n'
dedent|''
name|'raise'
newline|'\n'
dedent|''
name|'return'
name|'indexName'
newline|'\n'
nl|'\n'
DECL|member|getLogPrefix
dedent|''
name|'def'
name|'getLogPrefix'
op|'('
name|'self'
op|','
op|'**'
name|'dArgs'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'l'
op|'='
name|'dArgs'
op|'.'
name|'items'
op|'('
op|')'
newline|'\n'
name|'l'
op|'.'
name|'sort'
op|'('
op|')'
newline|'\n'
name|'s'
op|'='
string|"'_'"
op|'.'
name|'join'
op|'('
op|'['
string|"'%s=%s'"
op|'%'
name|'tup'
name|'for'
name|'tup'
name|'in'
name|'l'
op|']'
op|')'
newline|'\n'
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"' '"
op|','
string|"'_'"
op|')'
newline|'\n'
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|'\'"\''
op|','
string|"'_'"
op|')'
newline|'\n'
name|'return'
name|'s'
newline|'\n'
nl|'\n'
DECL|member|runOne
dedent|''
name|'def'
name|'runOne'
op|'('
name|'self'
op|','
name|'dir'
op|','
name|'alg'
op|','
name|'logFileName'
op|','
name|'expectedMaxDocs'
op|'='
name|'None'
op|','
name|'expectedNumDocs'
op|'='
name|'None'
op|','
name|'queries'
op|'='
name|'None'
op|','
name|'verify'
op|'='
name|'False'
op|','
name|'isIndex'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'fullDir'
op|'='
string|"'%s/contrib/benchmark'"
op|'%'
name|'dir'
newline|'\n'
name|'if'
name|'DEBUG'
op|':'
newline|'\n'
indent|'      '
name|'print'
string|"'  chdir %s'"
op|'%'
name|'fullDir'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'chdir'
op|'('
name|'fullDir'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'queries'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'type'
op|'('
name|'queries'
op|')'
name|'in'
name|'types'
op|'.'
name|'StringTypes'
op|':'
newline|'\n'
indent|'        '
name|'queries'
op|'='
op|'['
name|'queries'
op|']'
newline|'\n'
dedent|''
name|'open'
op|'('
string|"'queries.txt'"
op|','
string|"'wb'"
op|')'
op|'.'
name|'write'
op|'('
string|"'\\n'"
op|'.'
name|'join'
op|'('
name|'queries'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'DEBUG'
op|':'
newline|'\n'
indent|'      '
name|'algFile'
op|'='
string|"'tmp.alg'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'algFile'
op|'='
string|"'tmp.%s.alg'"
op|'%'
name|'os'
op|'.'
name|'getpid'
op|'('
op|')'
newline|'\n'
dedent|''
name|'open'
op|'('
name|'algFile'
op|','
string|"'wb'"
op|')'
op|'.'
name|'write'
op|'('
name|'alg'
op|')'
newline|'\n'
nl|'\n'
name|'fullLogFileName'
op|'='
string|"'%s/contrib/benchmark/%s/%s'"
op|'%'
op|'('
name|'dir'
op|','
name|'LOG_DIR'
op|','
name|'logFileName'
op|')'
newline|'\n'
name|'print'
string|"'  log: %s'"
op|'%'
name|'fullLogFileName'
newline|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'LOG_DIR'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'print'
string|"'  mkdir %s'"
op|'%'
name|'LOG_DIR'
newline|'\n'
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'LOG_DIR'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'command'
op|'='
string|'\'%s -classpath ../../build/classes/java:../../build/classes/demo:../../build/contrib/highlighter/classes/java:lib/commons-digester-1.7.jar:lib/commons-collections-3.1.jar:lib/commons-compress-1.0.jar:lib/commons-logging-1.0.4.jar:lib/commons-beanutils-1.7.0.jar:lib/xerces-2.9.0.jar:lib/xml-apis-2.9.0.jar:../../build/contrib/benchmark/classes/java org.apache.lucene.benchmark.byTask.Benchmark %s > "%s" 2>&1\''
op|'%'
op|'('
name|'JAVA_COMMAND'
op|','
name|'algFile'
op|','
name|'fullLogFileName'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'DEBUG'
op|':'
newline|'\n'
indent|'      '
name|'print'
string|"'command=%s'"
op|'%'
name|'command'
newline|'\n'
nl|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
indent|'      '
name|'t0'
op|'='
name|'time'
op|'.'
name|'time'
op|'('
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'system'
op|'('
name|'command'
op|')'
op|'!='
number|'0'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|"'FAILED'"
op|')'
newline|'\n'
dedent|''
name|'t1'
op|'='
name|'time'
op|'.'
name|'time'
op|'('
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'not'
name|'DEBUG'
op|':'
newline|'\n'
indent|'        '
name|'os'
op|'.'
name|'remove'
op|'('
name|'algFile'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'isIndex'
op|':'
newline|'\n'
indent|'      '
name|'s'
op|'='
name|'open'
op|'('
name|'fullLogFileName'
op|','
string|"'rb'"
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'if'
name|'s'
op|'.'
name|'find'
op|'('
string|'\'Exception in thread "\''
op|')'
op|'!='
op|'-'
number|'1'
name|'or'
name|'s'
op|'.'
name|'find'
op|'('
string|"'at org.apache.lucene'"
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|"'alg hit exceptions'"
op|')'
newline|'\n'
dedent|''
name|'return'
newline|'\n'
nl|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
nl|'\n'
comment|'# Parse results:'
nl|'\n'
indent|'      '
name|'bestQPS'
op|'='
name|'None'
newline|'\n'
name|'count'
op|'='
number|'0'
newline|'\n'
name|'nhits'
op|'='
name|'None'
newline|'\n'
name|'numDocs'
op|'='
name|'None'
newline|'\n'
name|'maxDocs'
op|'='
name|'None'
newline|'\n'
name|'warmTime'
op|'='
name|'None'
newline|'\n'
name|'r'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"'^  ([0-9]+): (.*)$'"
op|')'
newline|'\n'
name|'topN'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
name|'for'
name|'line'
name|'in'
name|'open'
op|'('
name|'fullLogFileName'
op|','
string|"'rb'"
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
op|':'
newline|'\n'
indent|'        '
name|'m'
op|'='
name|'r'
op|'.'
name|'match'
op|'('
name|'line'
op|'.'
name|'rstrip'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'m'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'          '
name|'topN'
op|'.'
name|'append'
op|'('
name|'m'
op|'.'
name|'group'
op|'('
number|'2'
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'line'
op|'.'
name|'startswith'
op|'('
string|"'totalHits = '"
op|')'
op|':'
newline|'\n'
indent|'          '
name|'nhits'
op|'='
name|'int'
op|'('
name|'line'
op|'['
number|'12'
op|':'
op|']'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'line'
op|'.'
name|'startswith'
op|'('
string|"'maxDoc()  = '"
op|')'
op|':'
newline|'\n'
indent|'          '
name|'maxDocs'
op|'='
name|'int'
op|'('
name|'line'
op|'['
number|'12'
op|':'
op|']'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'line'
op|'.'
name|'startswith'
op|'('
string|"'numDocs() = '"
op|')'
op|':'
newline|'\n'
indent|'          '
name|'numDocs'
op|'='
name|'int'
op|'('
name|'line'
op|'['
number|'12'
op|':'
op|']'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'line'
op|'.'
name|'startswith'
op|'('
string|"'XSearchWarm'"
op|')'
op|':'
newline|'\n'
indent|'          '
name|'v'
op|'='
name|'line'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'warmTime'
op|'='
name|'float'
op|'('
name|'v'
op|'['
number|'5'
op|']'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'line'
op|'.'
name|'startswith'
op|'('
string|"'XSearchReal'"
op|')'
op|':'
newline|'\n'
indent|'          '
name|'v'
op|'='
name|'line'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
comment|'# print len(v), v'
nl|'\n'
name|'upto'
op|'='
number|'0'
newline|'\n'
name|'i'
op|'='
number|'0'
newline|'\n'
name|'qps'
op|'='
name|'None'
newline|'\n'
name|'while'
name|'i'
op|'<'
name|'len'
op|'('
name|'v'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'v'
op|'['
name|'i'
op|']'
op|'=='
string|"'-'"
op|':'
newline|'\n'
indent|'              '
name|'i'
op|'+='
number|'1'
newline|'\n'
name|'continue'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'              '
name|'upto'
op|'+='
number|'1'
newline|'\n'
name|'i'
op|'+='
number|'1'
newline|'\n'
name|'if'
name|'upto'
op|'=='
number|'5'
op|':'
newline|'\n'
indent|'                '
name|'qps'
op|'='
name|'float'
op|'('
name|'v'
op|'['
name|'i'
op|'-'
number|'1'
op|']'
op|'.'
name|'replace'
op|'('
string|"','"
op|','
string|"''"
op|')'
op|')'
newline|'\n'
name|'break'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'qps'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'RuntimeError'
op|'('
string|"'did not find qps'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'count'
op|'+='
number|'1'
newline|'\n'
name|'if'
name|'bestQPS'
name|'is'
name|'None'
name|'or'
name|'qps'
op|'>'
name|'bestQPS'
op|':'
newline|'\n'
indent|'            '
name|'bestQPS'
op|'='
name|'qps'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'not'
name|'verify'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'count'
op|'!='
name|'NUM_ROUND'
op|':'
newline|'\n'
indent|'          '
name|'raise'
name|'RuntimeError'
op|'('
string|"'did not find %s rounds (got %s)'"
op|'%'
op|'('
name|'NUM_ROUND'
op|','
name|'count'
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'warmTime'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'          '
name|'raise'
name|'RuntimeError'
op|'('
string|"'did not find warm time'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'bestQPS'
op|'='
number|'1.0'
newline|'\n'
name|'warmTime'
op|'='
name|'None'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'nhits'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|'\'did not see "totalHits = XXX"\''
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'maxDocs'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|'\'did not see "maxDoc() = XXX"\''
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'maxDocs'
op|'!='
name|'expectedMaxDocs'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|"'maxDocs() mismatch: expected %s but got %s'"
op|'%'
op|'('
name|'expectedMaxDocs'
op|','
name|'maxDocs'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'numDocs'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|'\'did not see "numDocs() = XXX"\''
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'numDocs'
op|'!='
name|'expectedNumDocs'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|"'numDocs() mismatch: expected %s but got %s'"
op|'%'
op|'('
name|'expectedNumDocs'
op|','
name|'numDocs'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'nhits'
op|','
name|'warmTime'
op|','
name|'bestQPS'
op|','
name|'topN'
newline|'\n'
nl|'\n'
DECL|member|getAlg
dedent|''
dedent|''
name|'def'
name|'getAlg'
op|'('
name|'self'
op|','
name|'indexPath'
op|','
name|'searchTask'
op|','
name|'numHits'
op|','
name|'deletes'
op|'='
name|'None'
op|','
name|'verify'
op|'='
name|'False'
op|','
name|'printField'
op|'='
string|"''"
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'s'
op|'='
name|'BASE_SEARCH_ALG'
newline|'\n'
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'$PRINT_FIELD$'"
op|','
string|"'doctitle'"
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'verify'
op|':'
newline|'\n'
indent|'      '
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'$ROUNDS$'"
op|','
nl|'\n'
string|'\'\'\'                \n  { "Rounds"\n    { "Run"\n      { "TestSearchSpeed"\n        { "XSearchReal" $SEARCH$ > : 3.0s\n      }\n      NewRound\n    } : %d\n  } \n  \'\'\''
op|'%'
name|'NUM_ROUND'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'$ROUNDS$'"
op|','
string|"''"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'deletes'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'      '
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'$OPENREADER$'"
op|','
string|"'OpenReader'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'$OPENREADER$'"
op|','
string|"'OpenReader(true,dp%g)'"
op|'%'
name|'deletes'
op|')'
newline|'\n'
dedent|''
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'$INDEX$'"
op|','
name|'indexPath'
op|')'
newline|'\n'
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'$SEARCH$'"
op|','
name|'searchTask'
op|')'
newline|'\n'
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'$NUM_HITS$'"
op|','
name|'str'
op|'('
name|'numHits'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'return'
name|'s'
newline|'\n'
nl|'\n'
DECL|member|compare
dedent|''
name|'def'
name|'compare'
op|'('
name|'self'
op|','
name|'baseline'
op|','
name|'new'
op|','
op|'*'
name|'params'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'if'
name|'new'
op|'['
number|'0'
op|']'
op|'!='
name|'baseline'
op|'['
number|'0'
op|']'
op|':'
newline|'\n'
indent|'      '
name|'raise'
name|'RuntimeError'
op|'('
string|"'baseline found %d hits but new found %d hits'"
op|'%'
op|'('
name|'baseline'
op|'['
number|'0'
op|']'
op|','
name|'new'
op|'['
number|'0'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'qpsOld'
op|'='
name|'baseline'
op|'['
number|'2'
op|']'
newline|'\n'
name|'qpsNew'
op|'='
name|'new'
op|'['
number|'2'
op|']'
newline|'\n'
name|'pct'
op|'='
number|'100.0'
op|'*'
op|'('
name|'qpsNew'
op|'-'
name|'qpsOld'
op|')'
op|'/'
name|'qpsOld'
newline|'\n'
name|'print'
string|"'  diff: %.1f%%'"
op|'%'
name|'pct'
newline|'\n'
name|'self'
op|'.'
name|'results'
op|'.'
name|'append'
op|'('
op|'('
name|'qpsOld'
op|','
name|'qpsNew'
op|','
name|'params'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'self'
op|'.'
name|'fOut'
op|'.'
name|'write'
op|'('
string|"'|%s|%.2f|%.2f|%.1f%%|\\n'"
op|'%'
op|'('
string|"'|'"
op|'.'
name|'join'
op|'('
name|'str'
op|'('
name|'x'
op|')'
name|'for'
name|'x'
name|'in'
name|'params'
op|')'
op|','
nl|'\n'
name|'qpsOld'
op|','
name|'qpsNew'
op|','
name|'pct'
op|')'
op|')'
newline|'\n'
name|'self'
op|'.'
name|'fOut'
op|'.'
name|'flush'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|member|save
dedent|''
name|'def'
name|'save'
op|'('
name|'self'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'f'
op|'='
name|'open'
op|'('
string|"'%s.pk'"
op|'%'
name|'name'
op|','
string|"'wb'"
op|')'
newline|'\n'
name|'cPickle'
op|'.'
name|'dump'
op|'('
name|'self'
op|'.'
name|'results'
op|','
name|'f'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|verify
dedent|''
dedent|''
name|'def'
name|'verify'
op|'('
name|'r1'
op|','
name|'r2'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'if'
name|'r1'
op|'['
number|'0'
op|']'
op|'!='
name|'r2'
op|'['
number|'0'
op|']'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'different total hits: %s vs %s'"
op|'%'
op|'('
name|'r1'
op|'['
number|'0'
op|']'
op|','
name|'r2'
op|'['
number|'0'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'h1'
op|'='
name|'r1'
op|'['
number|'3'
op|']'
newline|'\n'
name|'h2'
op|'='
name|'r2'
op|'['
number|'3'
op|']'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'h1'
op|')'
op|'!='
name|'len'
op|'('
name|'h2'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'different number of results'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'len'
op|'('
name|'h1'
op|')'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'s1'
op|'='
name|'h1'
op|'['
name|'i'
op|']'
op|'.'
name|'replace'
op|'('
string|"'score=NaN'"
op|','
string|"'score=na'"
op|')'
op|'.'
name|'replace'
op|'('
string|"'score=0.0'"
op|','
string|"'score=na'"
op|')'
newline|'\n'
name|'s2'
op|'='
name|'h2'
op|'['
name|'i'
op|']'
op|'.'
name|'replace'
op|'('
string|"'score=NaN'"
op|','
string|"'score=na'"
op|')'
op|'.'
name|'replace'
op|'('
string|"'score=0.0'"
op|','
string|"'score=na'"
op|')'
newline|'\n'
name|'if'
name|'s1'
op|'!='
name|'s2'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|"'hit %s differs: %s vs %s'"
op|'%'
op|'('
name|'i'
op|','
name|'s1'
op|','
name|'s2'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|usage
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'usage'
op|'('
op|')'
op|':'
newline|'\n'
indent|'  '
name|'print'
newline|'\n'
name|'print'
string|"'Usage: python -u %s -run <name> | -report <name>'"
op|'%'
name|'sys'
op|'.'
name|'argv'
op|'['
number|'0'
op|']'
newline|'\n'
name|'print'
newline|'\n'
name|'print'
string|"'  -run <name> runs all tests, saving results to file <name>.pk'"
newline|'\n'
name|'print'
string|"'  -report <name> opens <name>.pk and prints Jira table'"
newline|'\n'
name|'print'
string|"'  -verify confirm old & new produce identical results'"
newline|'\n'
name|'print'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
DECL|function|main
dedent|''
name|'def'
name|'main'
op|'('
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'  '
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'LOG_DIR'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'LOG_DIR'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
string|"'-run'"
name|'in'
name|'sys'
op|'.'
name|'argv'
op|':'
newline|'\n'
indent|'    '
name|'i'
op|'='
name|'sys'
op|'.'
name|'argv'
op|'.'
name|'index'
op|'('
string|"'-run'"
op|')'
newline|'\n'
name|'mode'
op|'='
string|"'run'"
newline|'\n'
name|'if'
name|'i'
op|'<'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|')'
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'      '
name|'name'
op|'='
name|'sys'
op|'.'
name|'argv'
op|'['
number|'1'
op|'+'
name|'i'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'usage'
op|'('
op|')'
newline|'\n'
dedent|''
dedent|''
name|'elif'
string|"'-report'"
name|'in'
name|'sys'
op|'.'
name|'argv'
op|':'
newline|'\n'
indent|'    '
name|'i'
op|'='
name|'sys'
op|'.'
name|'argv'
op|'.'
name|'index'
op|'('
string|"'-report'"
op|')'
newline|'\n'
name|'mode'
op|'='
string|"'report'"
newline|'\n'
name|'if'
name|'i'
op|'<'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|')'
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'      '
name|'name'
op|'='
name|'sys'
op|'.'
name|'argv'
op|'['
number|'1'
op|'+'
name|'i'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'usage'
op|'('
op|')'
newline|'\n'
dedent|''
dedent|''
name|'elif'
string|"'-verify'"
name|'in'
name|'sys'
op|'.'
name|'argv'
op|':'
newline|'\n'
indent|'    '
name|'mode'
op|'='
string|"'verify'"
newline|'\n'
name|'name'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'usage'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'mode'
name|'in'
op|'('
string|"'run'"
op|','
string|"'verify'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'run'
op|'('
name|'mode'
op|','
name|'name'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'report'
op|'('
name|'name'
op|')'
newline|'\n'
nl|'\n'
DECL|function|report
dedent|''
dedent|''
name|'def'
name|'report'
op|'('
name|'name'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'  '
name|'print'
string|"'||Query||Deletes %||Tot hits||QPS old||QPS new||Pct change||'"
newline|'\n'
nl|'\n'
name|'results'
op|'='
name|'cPickle'
op|'.'
name|'load'
op|'('
name|'open'
op|'('
string|"'%s.pk'"
op|'%'
name|'name'
op|')'
op|')'
newline|'\n'
name|'for'
name|'qpsOld'
op|','
name|'qpsNew'
op|','
name|'params'
name|'in'
name|'results'
op|':'
newline|'\n'
indent|'    '
name|'pct'
op|'='
number|'100.0'
op|'*'
op|'('
name|'qpsNew'
op|'-'
name|'qpsOld'
op|')'
op|'/'
name|'qpsOld'
newline|'\n'
name|'if'
name|'pct'
op|'<'
number|'0.0'
op|':'
newline|'\n'
indent|'      '
name|'c'
op|'='
string|"'red'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'c'
op|'='
string|"'green'"
newline|'\n'
nl|'\n'
dedent|''
name|'params'
op|'='
name|'list'
op|'('
name|'params'
op|')'
newline|'\n'
nl|'\n'
name|'query'
op|'='
name|'params'
op|'['
number|'0'
op|']'
newline|'\n'
name|'if'
name|'query'
op|'=='
string|"'*:*'"
op|':'
newline|'\n'
indent|'      '
name|'query'
op|'='
string|"'<all>'"
newline|'\n'
dedent|''
name|'params'
op|'['
number|'0'
op|']'
op|'='
name|'query'
newline|'\n'
nl|'\n'
name|'pct'
op|'='
string|"'{color:%s}%.1f%%{color}'"
op|'%'
op|'('
name|'c'
op|','
name|'pct'
op|')'
newline|'\n'
name|'print'
string|"'|%s|%.2f|%.2f|%s|'"
op|'%'
op|'('
string|"'|'"
op|'.'
name|'join'
op|'('
name|'str'
op|'('
name|'x'
op|')'
name|'for'
name|'x'
name|'in'
name|'params'
op|')'
op|','
nl|'\n'
name|'qpsOld'
op|','
name|'qpsNew'
op|','
name|'pct'
op|')'
newline|'\n'
nl|'\n'
DECL|function|run
dedent|''
dedent|''
name|'def'
name|'run'
op|'('
name|'mode'
op|','
name|'name'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'  '
name|'for'
name|'dir'
name|'in'
op|'('
name|'TRUNK_DIR'
op|','
name|'FLEX_DIR'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'dir'
op|'='
string|"'%s/contrib/benchmark'"
op|'%'
name|'dir'
newline|'\n'
name|'print'
string|'\'"ant compile" in %s...\''
op|'%'
name|'dir'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
name|'dir'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'system'
op|'('
string|"'ant compile'"
op|')'
op|'!='
number|'0'
op|':'
newline|'\n'
indent|'      '
name|'raise'
name|'RuntimeError'
op|'('
string|"'ant compile failed'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'r'
op|'='
name|'RunAlgs'
op|'('
name|'name'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'WIKI_FILE'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'print'
newline|'\n'
name|'print'
string|'\'ERROR: wiki source file "%s" does not exist\''
op|'%'
name|'WIKI_FILE'
newline|'\n'
name|'print'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'print'
newline|'\n'
name|'print'
string|"'JAVA:\\n%s'"
op|'%'
name|'os'
op|'.'
name|'popen'
op|'('
string|"'java -version 2>&1'"
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'print'
newline|'\n'
name|'if'
name|'osName'
op|'!='
string|"'windows'"
op|':'
newline|'\n'
indent|'    '
name|'print'
string|"'OS:\\n%s'"
op|'%'
name|'os'
op|'.'
name|'popen'
op|'('
string|"'uname -a 2>&1'"
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'print'
string|"'OS:\\n%s'"
op|'%'
name|'sys'
op|'.'
name|'platform'
newline|'\n'
nl|'\n'
dedent|''
name|'deletePcts'
op|'='
op|'('
number|'0.0'
op|','
number|'0.1'
op|','
number|'1.0'
op|','
number|'10'
op|')'
newline|'\n'
nl|'\n'
name|'indexes'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'for'
name|'rev'
name|'in'
op|'('
string|"'baseline'"
op|','
string|"'flex'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'rev'
op|'=='
string|"'baseline'"
op|':'
newline|'\n'
indent|'      '
name|'dir'
op|'='
name|'TRUNK_DIR'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'dir'
op|'='
name|'FLEX_DIR'
newline|'\n'
dedent|''
name|'source'
op|'='
string|"'wiki'"
newline|'\n'
name|'indexes'
op|'['
name|'rev'
op|']'
op|'='
name|'r'
op|'.'
name|'makeIndex'
op|'('
name|'rev'
op|','
name|'dir'
op|','
name|'source'
op|','
name|'INDEX_NUM_DOCS'
op|','
name|'deletePcts'
op|'='
name|'deletePcts'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'doVerify'
op|'='
name|'mode'
op|'=='
string|"'verify'"
newline|'\n'
name|'source'
op|'='
string|"'wiki'"
newline|'\n'
name|'numHits'
op|'='
number|'10'
newline|'\n'
nl|'\n'
name|'queries'
op|'='
op|'('
nl|'\n'
string|"'body:[tec TO tet]'"
op|','
nl|'\n'
string|"'real*'"
op|','
nl|'\n'
string|"'1'"
op|','
nl|'\n'
string|"'2'"
op|','
nl|'\n'
string|"'+1 +2'"
op|','
nl|'\n'
string|"'+1 -2'"
op|','
nl|'\n'
string|"'1 2 3 -4'"
op|','
nl|'\n'
string|'\'"world economy"\''
op|')'
newline|'\n'
nl|'\n'
name|'for'
name|'query'
name|'in'
name|'queries'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'for'
name|'deletePct'
name|'in'
name|'deletePcts'
op|':'
newline|'\n'
nl|'\n'
indent|'      '
name|'print'
string|"'\\nRUN: query=%s deletes=%g%% nhits=%d'"
op|'%'
op|'('
name|'query'
op|','
name|'deletePct'
op|','
name|'numHits'
op|')'
newline|'\n'
nl|'\n'
name|'maxDocs'
op|'='
name|'INDEX_NUM_DOCS'
newline|'\n'
name|'numDocs'
op|'='
name|'int'
op|'('
name|'INDEX_NUM_DOCS'
op|'*'
op|'('
number|'1.0'
op|'-'
name|'deletePct'
op|'/'
number|'100.'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'prefix'
op|'='
name|'r'
op|'.'
name|'getLogPrefix'
op|'('
name|'query'
op|'='
name|'query'
op|','
name|'deletePct'
op|'='
name|'deletePct'
op|')'
newline|'\n'
name|'indexPath'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'INDEX_DIR_BASE'
op|','
name|'indexes'
op|'['
string|"'baseline'"
op|']'
op|')'
newline|'\n'
nl|'\n'
comment|'# baseline (trunk)'
nl|'\n'
name|'s'
op|'='
name|'r'
op|'.'
name|'getAlg'
op|'('
name|'indexPath'
op|','
nl|'\n'
string|"'Search'"
op|','
nl|'\n'
name|'numHits'
op|','
nl|'\n'
name|'deletes'
op|'='
name|'deletePct'
op|','
nl|'\n'
name|'verify'
op|'='
name|'doVerify'
op|','
nl|'\n'
name|'printField'
op|'='
string|"'doctitle'"
op|')'
newline|'\n'
name|'baseline'
op|'='
name|'r'
op|'.'
name|'runOne'
op|'('
name|'TRUNK_DIR'
op|','
name|'s'
op|','
string|"'baseline_%s'"
op|'%'
name|'prefix'
op|','
name|'maxDocs'
op|','
name|'numDocs'
op|','
name|'query'
op|','
name|'verify'
op|'='
name|'doVerify'
op|')'
newline|'\n'
nl|'\n'
comment|'# flex'
nl|'\n'
name|'indexPath'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'INDEX_DIR_BASE'
op|','
name|'indexes'
op|'['
string|"'flex'"
op|']'
op|')'
newline|'\n'
name|'s'
op|'='
name|'r'
op|'.'
name|'getAlg'
op|'('
name|'indexPath'
op|','
nl|'\n'
string|"'Search'"
op|','
nl|'\n'
name|'numHits'
op|','
nl|'\n'
name|'deletes'
op|'='
name|'deletePct'
op|','
nl|'\n'
name|'verify'
op|'='
name|'doVerify'
op|','
nl|'\n'
name|'printField'
op|'='
string|"'doctitle'"
op|')'
newline|'\n'
name|'flex'
op|'='
name|'r'
op|'.'
name|'runOne'
op|'('
name|'FLEX_DIR'
op|','
name|'s'
op|','
string|"'flex_%s'"
op|'%'
name|'prefix'
op|','
name|'maxDocs'
op|','
name|'numDocs'
op|','
name|'query'
op|','
name|'verify'
op|'='
name|'doVerify'
op|')'
newline|'\n'
nl|'\n'
name|'print'
string|"'  %d hits'"
op|'%'
name|'flex'
op|'['
number|'0'
op|']'
newline|'\n'
nl|'\n'
name|'verify'
op|'('
name|'baseline'
op|','
name|'flex'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'mode'
op|'=='
string|"'run'"
name|'and'
name|'not'
name|'DEBUG'
op|':'
newline|'\n'
indent|'        '
name|'r'
op|'.'
name|'compare'
op|'('
name|'baseline'
op|','
name|'flex'
op|','
nl|'\n'
name|'query'
op|','
name|'deletePct'
op|','
name|'baseline'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'r'
op|'.'
name|'save'
op|'('
name|'name'
op|')'
newline|'\n'
nl|'\n'
DECL|function|cleanScores
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'cleanScores'
op|'('
name|'l'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'for'
name|'i'
name|'in'
name|'range'
op|'('
name|'len'
op|'('
name|'l'
op|')'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'pos'
op|'='
name|'l'
op|'['
name|'i'
op|']'
op|'.'
name|'find'
op|'('
string|"' score='"
op|')'
newline|'\n'
name|'l'
op|'['
name|'i'
op|']'
op|'='
name|'l'
op|'['
name|'i'
op|']'
op|'['
op|':'
name|'pos'
op|']'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'  '
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
