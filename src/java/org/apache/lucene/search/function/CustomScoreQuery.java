begin_unit
begin_package
DECL|package|org.apache.lucene.search.function
package|package
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|search
operator|.
name|function
package|;
end_package
begin_comment
comment|/**  * Licensed to the Apache Software Foundation (ASF) under one or more  * contributor license agreements.  See the NOTICE file distributed with  * this work for additional information regarding copyright ownership.  * The ASF licenses this file to You under the Apache License, Version 2.0  * (the "License"); you may not use this file except in compliance with  * the License.  You may obtain a copy of the License at  *  *     http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment
begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import
begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Set
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|index
operator|.
name|IndexReader
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|search
operator|.
name|ComplexExplanation
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|search
operator|.
name|Explanation
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|search
operator|.
name|Query
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|search
operator|.
name|Scorer
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|search
operator|.
name|Searcher
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|search
operator|.
name|Similarity
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|search
operator|.
name|Weight
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|util
operator|.
name|ToStringUtils
import|;
end_import
begin_comment
comment|/**  * Query that sets document score as a programmatic function of (up to) two (sub) scores.  *<ol>  *<li>the score of its subQuery (any query)</li>  *<li>(optional) the score of its ValueSourtceQuery,  *        for most simple/convineient use case this query would be a   *        {@link org.apache.lucene.search.function.FieldScoreQuery FieldScoreQuery}</li>  *</ol>  * Subclasses can modify the computation by overriding {@link #customScore(int, float, float)}.  *   *<p><font color="#FF0000">  * WARNING: The status of the<b>search.function</b> package is experimental.   * The APIs introduced here might change in the future and will not be   * supported anymore in such a case.</font>  */
end_comment
begin_class
DECL|class|CustomScoreQuery
specifier|public
class|class
name|CustomScoreQuery
extends|extends
name|Query
block|{
DECL|field|subQuery
specifier|private
name|Query
name|subQuery
decl_stmt|;
DECL|field|valSrcQuery
specifier|private
name|ValueSourceQuery
name|valSrcQuery
decl_stmt|;
comment|// optional, can be null
DECL|field|strict
specifier|private
name|boolean
name|strict
init|=
literal|false
decl_stmt|;
comment|// if true, valueSource part of query does not take part in weights normalization.
comment|/**    * Create a CustomScoreQuery over input subQuery.    * @param subQuery the sub query whose scored is being customed. Must not be null.     */
DECL|method|CustomScoreQuery
specifier|public
name|CustomScoreQuery
parameter_list|(
name|Query
name|subQuery
parameter_list|)
block|{
name|this
argument_list|(
name|subQuery
argument_list|,
literal|null
argument_list|)
expr_stmt|;
block|}
comment|/**    * Create a CustomScoreQuery over input subQuery and a {@link ValueSourceQuery}.    * @param subQuery the sub query whose score is being customed. Must not be null.    * @param valSrcQuery a value source query whose scores are used in the custom score    * computation. For most simple/convineient use case this would be a     * {@link org.apache.lucene.search.function.FieldScoreQuery FieldScoreQuery}.    * This parameter is optional - it can be null.    */
DECL|method|CustomScoreQuery
specifier|public
name|CustomScoreQuery
parameter_list|(
name|Query
name|subQuery
parameter_list|,
name|ValueSourceQuery
name|valSrcQuery
parameter_list|)
block|{
name|super
argument_list|()
expr_stmt|;
name|this
operator|.
name|subQuery
operator|=
name|subQuery
expr_stmt|;
name|this
operator|.
name|valSrcQuery
operator|=
name|valSrcQuery
expr_stmt|;
if|if
condition|(
name|subQuery
operator|==
literal|null
condition|)
throw|throw
operator|new
name|IllegalArgumentException
argument_list|(
literal|"<subqyery> must not be null!"
argument_list|)
throw|;
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Query#rewrite(org.apache.lucene.index.IndexReader) */
DECL|method|rewrite
specifier|public
name|Query
name|rewrite
parameter_list|(
name|IndexReader
name|reader
parameter_list|)
throws|throws
name|IOException
block|{
name|subQuery
operator|=
name|subQuery
operator|.
name|rewrite
argument_list|(
name|reader
argument_list|)
expr_stmt|;
if|if
condition|(
name|valSrcQuery
operator|!=
literal|null
condition|)
block|{
name|valSrcQuery
operator|=
operator|(
name|ValueSourceQuery
operator|)
name|valSrcQuery
operator|.
name|rewrite
argument_list|(
name|reader
argument_list|)
expr_stmt|;
block|}
return|return
name|this
return|;
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Query#extractTerms(java.util.Set) */
DECL|method|extractTerms
specifier|public
name|void
name|extractTerms
parameter_list|(
name|Set
name|terms
parameter_list|)
block|{
name|subQuery
operator|.
name|extractTerms
argument_list|(
name|terms
argument_list|)
expr_stmt|;
if|if
condition|(
name|valSrcQuery
operator|!=
literal|null
condition|)
block|{
name|valSrcQuery
operator|.
name|extractTerms
argument_list|(
name|terms
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Query#clone() */
DECL|method|clone
specifier|public
name|Object
name|clone
parameter_list|()
block|{
name|CustomScoreQuery
name|clone
init|=
operator|(
name|CustomScoreQuery
operator|)
name|super
operator|.
name|clone
argument_list|()
decl_stmt|;
name|clone
operator|.
name|subQuery
operator|=
operator|(
name|Query
operator|)
name|subQuery
operator|.
name|clone
argument_list|()
expr_stmt|;
if|if
condition|(
name|valSrcQuery
operator|!=
literal|null
condition|)
block|{
name|clone
operator|.
name|valSrcQuery
operator|=
operator|(
name|ValueSourceQuery
operator|)
name|valSrcQuery
operator|.
name|clone
argument_list|()
expr_stmt|;
block|}
return|return
name|clone
return|;
block|}
comment|/* (non-Javadoc) @see org.apache.lucene.search.Query#toString(java.lang.String) */
DECL|method|toString
specifier|public
name|String
name|toString
parameter_list|(
name|String
name|field
parameter_list|)
block|{
name|StringBuffer
name|sb
init|=
operator|new
name|StringBuffer
argument_list|(
name|name
argument_list|()
argument_list|)
operator|.
name|append
argument_list|(
literal|"("
argument_list|)
decl_stmt|;
name|sb
operator|.
name|append
argument_list|(
name|subQuery
operator|.
name|toString
argument_list|(
name|field
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|valSrcQuery
operator|!=
literal|null
condition|)
block|{
name|sb
operator|.
name|append
argument_list|(
literal|", "
argument_list|)
operator|.
name|append
argument_list|(
name|valSrcQuery
operator|.
name|toString
argument_list|(
name|field
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|sb
operator|.
name|append
argument_list|(
literal|")"
argument_list|)
expr_stmt|;
name|sb
operator|.
name|append
argument_list|(
name|strict
condition|?
literal|" STRICT"
else|:
literal|""
argument_list|)
expr_stmt|;
return|return
name|sb
operator|.
name|toString
argument_list|()
operator|+
name|ToStringUtils
operator|.
name|boost
argument_list|(
name|getBoost
argument_list|()
argument_list|)
return|;
block|}
comment|/** Returns true if<code>o</code> is equal to this. */
DECL|method|equals
specifier|public
name|boolean
name|equals
parameter_list|(
name|Object
name|o
parameter_list|)
block|{
if|if
condition|(
name|getClass
argument_list|()
operator|!=
name|o
operator|.
name|getClass
argument_list|()
condition|)
block|{
return|return
literal|false
return|;
block|}
name|CustomScoreQuery
name|other
init|=
operator|(
name|CustomScoreQuery
operator|)
name|o
decl_stmt|;
return|return
name|this
operator|.
name|getBoost
argument_list|()
operator|==
name|other
operator|.
name|getBoost
argument_list|()
operator|&&
name|this
operator|.
name|subQuery
operator|.
name|equals
argument_list|(
name|other
operator|.
name|subQuery
argument_list|)
operator|&&
operator|(
name|this
operator|.
name|valSrcQuery
operator|==
literal|null
condition|?
name|other
operator|.
name|valSrcQuery
operator|==
literal|null
else|:
name|this
operator|.
name|valSrcQuery
operator|.
name|equals
argument_list|(
name|other
operator|.
name|valSrcQuery
argument_list|)
operator|)
return|;
block|}
comment|/** Returns a hash code value for this object. */
DECL|method|hashCode
specifier|public
name|int
name|hashCode
parameter_list|()
block|{
name|int
name|valSrcHash
init|=
name|valSrcQuery
operator|==
literal|null
condition|?
literal|0
else|:
name|valSrcQuery
operator|.
name|hashCode
argument_list|()
decl_stmt|;
return|return
operator|(
name|getClass
argument_list|()
operator|.
name|hashCode
argument_list|()
operator|+
name|subQuery
operator|.
name|hashCode
argument_list|()
operator|+
name|valSrcHash
operator|)
operator|^
name|Float
operator|.
name|floatToIntBits
argument_list|(
name|getBoost
argument_list|()
argument_list|)
return|;
block|}
comment|/**    * Compute a custom score by the subQuery score and the ValueSourceQuery score.    *<p>     * Subclasses can override this method to modify the custom score.    *<p>    * The default computation herein is:    *<pre>    *     ModifiedScore = valSrcScore * subQueryScore.    *</pre>    *     * @param doc id of scored doc.     * @param subQueryScore score of that doc by the subQuery.    * @param valSrcScore score of that doc by the ValueSourceQuery.    * @return custom score.    */
DECL|method|customScore
specifier|public
name|float
name|customScore
parameter_list|(
name|int
name|doc
parameter_list|,
name|float
name|subQueryScore
parameter_list|,
name|float
name|valSrcScore
parameter_list|)
block|{
return|return
name|valSrcScore
operator|*
name|subQueryScore
return|;
block|}
comment|/**    * Explain the custom score.    * Whenever overriding {@link #customScore(int, float, float)},     * this method should also be overriden to provide the correct explanation    * for the part of the custom scoring.     * @param doc doc being explained.    * @param subQueryExpl explanation for the sub-query part.    * @param valSrcExpl explanation for the value source part.    * @return an explanation for the custom score    */
DECL|method|customExplain
specifier|public
name|Explanation
name|customExplain
parameter_list|(
name|int
name|doc
parameter_list|,
name|Explanation
name|subQueryExpl
parameter_list|,
name|Explanation
name|valSrcExpl
parameter_list|)
block|{
name|float
name|valSrcScore
init|=
name|valSrcExpl
operator|==
literal|null
condition|?
literal|1
else|:
name|valSrcExpl
operator|.
name|getValue
argument_list|()
decl_stmt|;
name|Explanation
name|exp
init|=
operator|new
name|Explanation
argument_list|(
name|valSrcScore
operator|*
name|subQueryExpl
operator|.
name|getValue
argument_list|()
argument_list|,
literal|"custom score: product of:"
argument_list|)
decl_stmt|;
name|exp
operator|.
name|addDetail
argument_list|(
name|subQueryExpl
argument_list|)
expr_stmt|;
if|if
condition|(
name|valSrcExpl
operator|!=
literal|null
condition|)
block|{
name|exp
operator|.
name|addDetail
argument_list|(
name|valSrcExpl
argument_list|)
expr_stmt|;
block|}
return|return
name|exp
return|;
block|}
comment|//=========================== W E I G H T ============================
DECL|class|CustomWeight
specifier|private
class|class
name|CustomWeight
implements|implements
name|Weight
block|{
DECL|field|searcher
name|Searcher
name|searcher
decl_stmt|;
DECL|field|subQueryWeight
name|Weight
name|subQueryWeight
decl_stmt|;
DECL|field|valSrcWeight
name|Weight
name|valSrcWeight
decl_stmt|;
comment|// optional
DECL|field|qStrict
name|boolean
name|qStrict
decl_stmt|;
DECL|method|CustomWeight
specifier|public
name|CustomWeight
parameter_list|(
name|Searcher
name|searcher
parameter_list|)
throws|throws
name|IOException
block|{
name|this
operator|.
name|searcher
operator|=
name|searcher
expr_stmt|;
name|this
operator|.
name|subQueryWeight
operator|=
name|subQuery
operator|.
name|weight
argument_list|(
name|searcher
argument_list|)
expr_stmt|;
if|if
condition|(
name|valSrcQuery
operator|!=
literal|null
condition|)
block|{
name|this
operator|.
name|valSrcWeight
operator|=
name|valSrcQuery
operator|.
name|createWeight
argument_list|(
name|searcher
argument_list|)
expr_stmt|;
block|}
name|this
operator|.
name|qStrict
operator|=
name|strict
expr_stmt|;
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Weight#getQuery() */
DECL|method|getQuery
specifier|public
name|Query
name|getQuery
parameter_list|()
block|{
return|return
name|CustomScoreQuery
operator|.
name|this
return|;
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Weight#getValue() */
DECL|method|getValue
specifier|public
name|float
name|getValue
parameter_list|()
block|{
return|return
name|getBoost
argument_list|()
return|;
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Weight#sumOfSquaredWeights() */
DECL|method|sumOfSquaredWeights
specifier|public
name|float
name|sumOfSquaredWeights
parameter_list|()
throws|throws
name|IOException
block|{
name|float
name|sum
init|=
name|subQueryWeight
operator|.
name|sumOfSquaredWeights
argument_list|()
decl_stmt|;
if|if
condition|(
name|valSrcWeight
operator|!=
literal|null
condition|)
block|{
if|if
condition|(
name|qStrict
condition|)
block|{
name|valSrcWeight
operator|.
name|sumOfSquaredWeights
argument_list|()
expr_stmt|;
comment|// do not include ValueSource part in the query normalization
block|}
else|else
block|{
name|sum
operator|+=
name|valSrcWeight
operator|.
name|sumOfSquaredWeights
argument_list|()
expr_stmt|;
block|}
block|}
name|sum
operator|*=
name|getBoost
argument_list|()
operator|*
name|getBoost
argument_list|()
expr_stmt|;
comment|// boost each sub-weight
return|return
name|sum
return|;
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Weight#normalize(float) */
DECL|method|normalize
specifier|public
name|void
name|normalize
parameter_list|(
name|float
name|norm
parameter_list|)
block|{
name|norm
operator|*=
name|getBoost
argument_list|()
expr_stmt|;
comment|// incorporate boost
name|subQueryWeight
operator|.
name|normalize
argument_list|(
name|norm
argument_list|)
expr_stmt|;
if|if
condition|(
name|valSrcWeight
operator|!=
literal|null
condition|)
block|{
if|if
condition|(
name|qStrict
condition|)
block|{
name|valSrcWeight
operator|.
name|normalize
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|// do not normalize the ValueSource part
block|}
else|else
block|{
name|valSrcWeight
operator|.
name|normalize
argument_list|(
name|norm
argument_list|)
expr_stmt|;
block|}
block|}
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Weight#scorer(org.apache.lucene.index.IndexReader) */
DECL|method|scorer
specifier|public
name|Scorer
name|scorer
parameter_list|(
name|IndexReader
name|reader
parameter_list|)
throws|throws
name|IOException
block|{
name|Scorer
name|subQueryScorer
init|=
name|subQueryWeight
operator|.
name|scorer
argument_list|(
name|reader
argument_list|)
decl_stmt|;
name|Scorer
name|valSrcScorer
init|=
operator|(
name|valSrcWeight
operator|==
literal|null
condition|?
literal|null
else|:
name|valSrcWeight
operator|.
name|scorer
argument_list|(
name|reader
argument_list|)
operator|)
decl_stmt|;
return|return
operator|new
name|CustomScorer
argument_list|(
name|getSimilarity
argument_list|(
name|searcher
argument_list|)
argument_list|,
name|reader
argument_list|,
name|this
argument_list|,
name|subQueryScorer
argument_list|,
name|valSrcScorer
argument_list|)
return|;
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Weight#explain(org.apache.lucene.index.IndexReader, int) */
DECL|method|explain
specifier|public
name|Explanation
name|explain
parameter_list|(
name|IndexReader
name|reader
parameter_list|,
name|int
name|doc
parameter_list|)
throws|throws
name|IOException
block|{
return|return
name|scorer
argument_list|(
name|reader
argument_list|)
operator|.
name|explain
argument_list|(
name|doc
argument_list|)
return|;
block|}
block|}
comment|//=========================== S C O R E R ============================
comment|/**    * A scorer that applies a (callback) function on scores of the subQuery.    */
DECL|class|CustomScorer
specifier|private
class|class
name|CustomScorer
extends|extends
name|Scorer
block|{
DECL|field|weight
specifier|private
specifier|final
name|CustomWeight
name|weight
decl_stmt|;
DECL|field|qWeight
specifier|private
specifier|final
name|float
name|qWeight
decl_stmt|;
DECL|field|subQueryScorer
specifier|private
name|Scorer
name|subQueryScorer
decl_stmt|;
DECL|field|valSrcScorer
specifier|private
name|Scorer
name|valSrcScorer
decl_stmt|;
comment|// optional
DECL|field|reader
specifier|private
name|IndexReader
name|reader
decl_stmt|;
comment|// constructor
DECL|method|CustomScorer
specifier|private
name|CustomScorer
parameter_list|(
name|Similarity
name|similarity
parameter_list|,
name|IndexReader
name|reader
parameter_list|,
name|CustomWeight
name|w
parameter_list|,
name|Scorer
name|subQueryScorer
parameter_list|,
name|Scorer
name|valSrcScorer
parameter_list|)
throws|throws
name|IOException
block|{
name|super
argument_list|(
name|similarity
argument_list|)
expr_stmt|;
name|this
operator|.
name|weight
operator|=
name|w
expr_stmt|;
name|this
operator|.
name|qWeight
operator|=
name|w
operator|.
name|getValue
argument_list|()
expr_stmt|;
name|this
operator|.
name|subQueryScorer
operator|=
name|subQueryScorer
expr_stmt|;
name|this
operator|.
name|valSrcScorer
operator|=
name|valSrcScorer
expr_stmt|;
name|this
operator|.
name|reader
operator|=
name|reader
expr_stmt|;
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Scorer#next() */
DECL|method|next
specifier|public
name|boolean
name|next
parameter_list|()
throws|throws
name|IOException
block|{
name|boolean
name|hasNext
init|=
name|subQueryScorer
operator|.
name|next
argument_list|()
decl_stmt|;
if|if
condition|(
name|valSrcScorer
operator|!=
literal|null
operator|&&
name|hasNext
condition|)
block|{
name|valSrcScorer
operator|.
name|skipTo
argument_list|(
name|subQueryScorer
operator|.
name|doc
argument_list|()
argument_list|)
expr_stmt|;
block|}
return|return
name|hasNext
return|;
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Scorer#doc() */
DECL|method|doc
specifier|public
name|int
name|doc
parameter_list|()
block|{
return|return
name|subQueryScorer
operator|.
name|doc
argument_list|()
return|;
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Scorer#score() */
DECL|method|score
specifier|public
name|float
name|score
parameter_list|()
throws|throws
name|IOException
block|{
name|float
name|valSrcScore
init|=
operator|(
name|valSrcScorer
operator|==
literal|null
condition|?
literal|1
else|:
name|valSrcScorer
operator|.
name|score
argument_list|()
operator|)
decl_stmt|;
return|return
name|qWeight
operator|*
name|customScore
argument_list|(
name|subQueryScorer
operator|.
name|doc
argument_list|()
argument_list|,
name|subQueryScorer
operator|.
name|score
argument_list|()
argument_list|,
name|valSrcScore
argument_list|)
return|;
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Scorer#skipTo(int) */
DECL|method|skipTo
specifier|public
name|boolean
name|skipTo
parameter_list|(
name|int
name|target
parameter_list|)
throws|throws
name|IOException
block|{
name|boolean
name|hasNext
init|=
name|subQueryScorer
operator|.
name|skipTo
argument_list|(
name|target
argument_list|)
decl_stmt|;
if|if
condition|(
name|valSrcScorer
operator|!=
literal|null
operator|&&
name|hasNext
condition|)
block|{
name|valSrcScorer
operator|.
name|skipTo
argument_list|(
name|subQueryScorer
operator|.
name|doc
argument_list|()
argument_list|)
expr_stmt|;
block|}
return|return
name|hasNext
return|;
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Scorer#explain(int) */
DECL|method|explain
specifier|public
name|Explanation
name|explain
parameter_list|(
name|int
name|doc
parameter_list|)
throws|throws
name|IOException
block|{
name|Explanation
name|subQueryExpl
init|=
name|weight
operator|.
name|subQueryWeight
operator|.
name|explain
argument_list|(
name|reader
argument_list|,
name|doc
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|subQueryExpl
operator|.
name|isMatch
argument_list|()
condition|)
block|{
return|return
name|subQueryExpl
return|;
block|}
comment|// match
name|Explanation
name|valSrcExpl
init|=
name|valSrcScorer
operator|==
literal|null
condition|?
literal|null
else|:
name|valSrcScorer
operator|.
name|explain
argument_list|(
name|doc
argument_list|)
decl_stmt|;
name|Explanation
name|customExp
init|=
name|customExplain
argument_list|(
name|doc
argument_list|,
name|subQueryExpl
argument_list|,
name|valSrcExpl
argument_list|)
decl_stmt|;
name|float
name|sc
init|=
name|qWeight
operator|*
name|customExp
operator|.
name|getValue
argument_list|()
decl_stmt|;
name|Explanation
name|res
init|=
operator|new
name|ComplexExplanation
argument_list|(
literal|true
argument_list|,
name|sc
argument_list|,
name|CustomScoreQuery
operator|.
name|this
operator|.
name|toString
argument_list|()
operator|+
literal|", product of:"
argument_list|)
decl_stmt|;
name|res
operator|.
name|addDetail
argument_list|(
name|customExp
argument_list|)
expr_stmt|;
name|res
operator|.
name|addDetail
argument_list|(
operator|new
name|Explanation
argument_list|(
name|qWeight
argument_list|,
literal|"queryBoost"
argument_list|)
argument_list|)
expr_stmt|;
comment|// actually using the q boost as q weight (== weight value)
return|return
name|res
return|;
block|}
block|}
comment|/*(non-Javadoc) @see org.apache.lucene.search.Query#createWeight(org.apache.lucene.search.Searcher) */
DECL|method|createWeight
specifier|protected
name|Weight
name|createWeight
parameter_list|(
name|Searcher
name|searcher
parameter_list|)
throws|throws
name|IOException
block|{
return|return
operator|new
name|CustomWeight
argument_list|(
name|searcher
argument_list|)
return|;
block|}
comment|/**    * Checks if this is strict custom scoring.    * In strict custom scoring, the ValueSource part of does not participate in weight normalization.    * This may be useful when one wants full control over how scores are modified, and does     * not care about normalizing by the ValueSource part.    * One particular case where this is useful if for testing this query.       *<P>    * Note: only has effect when the ValueSource part is not null.    */
DECL|method|isStrict
specifier|public
name|boolean
name|isStrict
parameter_list|()
block|{
return|return
name|strict
return|;
block|}
comment|/**    * Set the strict mode of this query.     * @param strict The strict mode to set.    * @see #isStrict()    */
DECL|method|setStrict
specifier|public
name|void
name|setStrict
parameter_list|(
name|boolean
name|strict
parameter_list|)
block|{
name|this
operator|.
name|strict
operator|=
name|strict
expr_stmt|;
block|}
comment|/**    * A short name of this query, used in {@link #toString(String)}.    */
DECL|method|name
specifier|public
name|String
name|name
parameter_list|()
block|{
return|return
literal|"custom"
return|;
block|}
block|}
end_class
end_unit
