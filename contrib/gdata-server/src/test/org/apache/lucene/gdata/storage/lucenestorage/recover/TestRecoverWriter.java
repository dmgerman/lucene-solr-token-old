begin_unit
begin_package
DECL|package|org.apache.lucene.gdata.storage.lucenestorage.recover
package|package
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|gdata
operator|.
name|storage
operator|.
name|lucenestorage
operator|.
name|recover
package|;
end_package
begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import
begin_import
import|import
name|java
operator|.
name|io
operator|.
name|StringWriter
import|;
end_import
begin_import
import|import
name|junit
operator|.
name|framework
operator|.
name|TestCase
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|gdata
operator|.
name|data
operator|.
name|ServerBaseEntry
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|gdata
operator|.
name|server
operator|.
name|registry
operator|.
name|ProvidedService
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|gdata
operator|.
name|storage
operator|.
name|lucenestorage
operator|.
name|StorageEntryWrapper
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|gdata
operator|.
name|storage
operator|.
name|lucenestorage
operator|.
name|StorageEntryWrapper
operator|.
name|StorageOperation
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|gdata
operator|.
name|utils
operator|.
name|ProvidedServiceStub
import|;
end_import
begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gdata
operator|.
name|data
operator|.
name|DateTime
import|;
end_import
begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gdata
operator|.
name|data
operator|.
name|Entry
import|;
end_import
begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gdata
operator|.
name|data
operator|.
name|PlainTextConstruct
import|;
end_import
begin_class
DECL|class|TestRecoverWriter
specifier|public
class|class
name|TestRecoverWriter
extends|extends
name|TestCase
block|{
DECL|field|ENTRYID
specifier|private
specifier|static
specifier|final
name|String
name|ENTRYID
init|=
literal|"myID"
decl_stmt|;
DECL|field|TITLE
specifier|private
specifier|static
specifier|final
name|String
name|TITLE
init|=
literal|"title"
decl_stmt|;
DECL|field|FEEDID
specifier|private
specifier|static
specifier|final
name|String
name|FEEDID
init|=
literal|"myFeed"
decl_stmt|;
DECL|field|TIMESTAMP
specifier|private
specifier|static
specifier|final
name|Long
name|TIMESTAMP
init|=
literal|132326657L
decl_stmt|;
DECL|field|dateTime
specifier|private
name|DateTime
name|dateTime
init|=
operator|new
name|DateTime
argument_list|(
name|TIMESTAMP
argument_list|,
literal|0
argument_list|)
decl_stmt|;
DECL|field|compareEntry
name|String
name|compareEntry
init|=
literal|"I;"
operator|+
name|FEEDID
operator|+
literal|";"
operator|+
name|ENTRYID
operator|+
literal|";"
operator|+
name|TIMESTAMP
operator|+
literal|";"
operator|+
name|ProvidedServiceStub
operator|.
name|SERVICE_NAME
operator|+
literal|";"
operator|+
name|RecoverWriter
operator|.
name|META_DATA_ENTRY_SEPARATOR
operator|+
literal|"<atom:entry xmlns:atom='http://www.w3.org/2005/Atom'><atom:id>"
operator|+
name|ENTRYID
operator|+
literal|"</atom:id><atom:updated>"
operator|+
name|this
operator|.
name|dateTime
operator|.
name|toString
argument_list|()
operator|+
literal|"</atom:updated><atom:title type='text'>"
operator|+
name|TITLE
operator|+
literal|"</atom:title></atom:entry>"
operator|+
name|RecoverWriter
operator|.
name|META_DATA_ENTRY_SEPARATOR
operator|+
name|RecoverWriter
operator|.
name|STORAGE_OPERATION_SEPARATOR
operator|+
name|RecoverWriter
operator|.
name|META_DATA_ENTRY_SEPARATOR
decl_stmt|;
DECL|field|compareDelete
name|String
name|compareDelete
init|=
literal|"D;"
operator|+
name|FEEDID
operator|+
literal|";"
operator|+
name|ENTRYID
operator|+
literal|";"
operator|+
name|TIMESTAMP
operator|+
literal|";"
operator|+
name|RecoverWriter
operator|.
name|META_DATA_ENTRY_SEPARATOR
operator|+
name|RecoverWriter
operator|.
name|STORAGE_OPERATION_SEPARATOR
operator|+
name|RecoverWriter
operator|.
name|META_DATA_ENTRY_SEPARATOR
decl_stmt|;
DECL|field|wrapper
name|StorageEntryWrapper
name|wrapper
decl_stmt|;
DECL|field|deleteWrapper
name|StorageEntryWrapper
name|deleteWrapper
decl_stmt|;
DECL|method|setUp
specifier|protected
name|void
name|setUp
parameter_list|()
throws|throws
name|Exception
block|{
name|ServerBaseEntry
name|entry
init|=
operator|new
name|ServerBaseEntry
argument_list|(
operator|new
name|Entry
argument_list|()
argument_list|)
decl_stmt|;
name|entry
operator|.
name|setId
argument_list|(
name|ENTRYID
argument_list|)
expr_stmt|;
name|entry
operator|.
name|setUpdated
argument_list|(
operator|new
name|DateTime
argument_list|(
name|TIMESTAMP
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|entry
operator|.
name|setTitle
argument_list|(
operator|new
name|PlainTextConstruct
argument_list|(
name|TITLE
argument_list|)
argument_list|)
expr_stmt|;
name|ProvidedService
name|config
init|=
operator|new
name|ProvidedServiceStub
argument_list|()
decl_stmt|;
name|entry
operator|.
name|setFeedId
argument_list|(
name|FEEDID
argument_list|)
expr_stmt|;
name|entry
operator|.
name|setServiceConfig
argument_list|(
name|config
argument_list|)
expr_stmt|;
name|this
operator|.
name|wrapper
operator|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|entry
argument_list|,
name|StorageOperation
operator|.
name|INSERT
argument_list|)
expr_stmt|;
name|this
operator|.
name|deleteWrapper
operator|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|entry
argument_list|,
name|StorageOperation
operator|.
name|DELETE
argument_list|)
expr_stmt|;
block|}
DECL|method|tearDown
specifier|protected
name|void
name|tearDown
parameter_list|()
throws|throws
name|Exception
block|{
name|super
operator|.
name|tearDown
argument_list|()
expr_stmt|;
block|}
comment|/*      * Test method for 'org.apache.lucene.gdata.storage.lucenestorage.recover.RecoverWriter.writeEntry(StorageEntryWrapper, Writer)'      */
DECL|method|testWriteEntry
specifier|public
name|void
name|testWriteEntry
parameter_list|()
throws|throws
name|IOException
block|{
name|RecoverWriter
name|wr
init|=
operator|new
name|RecoverWriter
argument_list|()
decl_stmt|;
name|StringWriter
name|writer
init|=
operator|new
name|StringWriter
argument_list|()
decl_stmt|;
name|wr
operator|.
name|writeEntry
argument_list|(
name|this
operator|.
name|wrapper
argument_list|,
name|writer
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|compareEntry
argument_list|,
name|writer
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|writer
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
comment|/*      * Test method for 'org.apache.lucene.gdata.storage.lucenestorage.recover.RecoverWriter.writeDelete(String, String, Writer)'      */
DECL|method|testWriteDelete
specifier|public
name|void
name|testWriteDelete
parameter_list|()
throws|throws
name|IOException
block|{
name|RecoverWriter
name|wr
init|=
operator|new
name|RecoverWriter
argument_list|()
decl_stmt|;
name|StringWriter
name|writer
init|=
operator|new
name|StringWriter
argument_list|()
decl_stmt|;
name|wr
operator|.
name|writeEntry
argument_list|(
name|this
operator|.
name|deleteWrapper
argument_list|,
name|writer
argument_list|)
expr_stmt|;
name|System
operator|.
name|out
operator|.
name|println
argument_list|(
name|writer
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|compareDelete
argument_list|,
name|writer
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|writer
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
block|}
end_class
end_unit
