begin_unit
begin_package
DECL|package|org.apache.lucene.gdata.servlet.handler
package|package
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|gdata
operator|.
name|servlet
operator|.
name|handler
package|;
end_package
begin_import
import|import
name|javax
operator|.
name|servlet
operator|.
name|http
operator|.
name|Cookie
import|;
end_import
begin_import
import|import
name|javax
operator|.
name|servlet
operator|.
name|http
operator|.
name|HttpServletRequest
import|;
end_import
begin_import
import|import
name|junit
operator|.
name|framework
operator|.
name|TestCase
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|gdata
operator|.
name|server
operator|.
name|authentication
operator|.
name|AuthenticationController
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|gdata
operator|.
name|server
operator|.
name|registry
operator|.
name|GDataServerRegistry
import|;
end_import
begin_import
import|import
name|org
operator|.
name|easymock
operator|.
name|MockControl
import|;
end_import
begin_class
DECL|class|TestRequestAuthenticator
specifier|public
class|class
name|TestRequestAuthenticator
extends|extends
name|TestCase
block|{
DECL|field|requestMock
specifier|private
name|MockControl
name|requestMock
decl_stmt|;
DECL|field|request
specifier|private
name|HttpServletRequest
name|request
decl_stmt|;
DECL|field|authenticator
specifier|private
name|RequestAuthenticator
name|authenticator
decl_stmt|;
DECL|field|tokenHeader
specifier|private
name|String
name|tokenHeader
decl_stmt|;
DECL|field|token
specifier|private
name|String
name|token
decl_stmt|;
DECL|field|authCookie
specifier|private
name|Cookie
name|authCookie
decl_stmt|;
DECL|method|setUp
specifier|protected
name|void
name|setUp
parameter_list|()
throws|throws
name|Exception
block|{
name|createMocks
argument_list|()
expr_stmt|;
name|this
operator|.
name|authenticator
operator|=
operator|new
name|RequestAuthenticator
argument_list|()
expr_stmt|;
name|this
operator|.
name|token
operator|=
literal|"myToken"
expr_stmt|;
name|this
operator|.
name|tokenHeader
operator|=
literal|"GoogleLogin auth="
operator|+
name|this
operator|.
name|token
expr_stmt|;
name|this
operator|.
name|authCookie
operator|=
operator|new
name|Cookie
argument_list|(
literal|"Auth"
argument_list|,
name|this
operator|.
name|token
argument_list|)
expr_stmt|;
block|}
DECL|method|createMocks
specifier|protected
name|void
name|createMocks
parameter_list|()
block|{
name|this
operator|.
name|requestMock
operator|=
name|MockControl
operator|.
name|createControl
argument_list|(
name|HttpServletRequest
operator|.
name|class
argument_list|)
expr_stmt|;
name|this
operator|.
name|request
operator|=
operator|(
name|HttpServletRequest
operator|)
name|this
operator|.
name|requestMock
operator|.
name|getMock
argument_list|()
expr_stmt|;
block|}
DECL|method|tearDown
specifier|protected
name|void
name|tearDown
parameter_list|()
throws|throws
name|Exception
block|{
name|GDataServerRegistry
operator|.
name|getRegistry
argument_list|()
operator|.
name|destroy
argument_list|()
expr_stmt|;
block|}
comment|/*      * Test method for 'org.apache.lucene.gdata.servlet.handler.RequestAuthenticator.authenticateAccount(GDataRequest, AccountRole)'      */
DECL|method|testGetTokenFromRequest
specifier|public
name|void
name|testGetTokenFromRequest
parameter_list|()
block|{
comment|// test token present
name|this
operator|.
name|requestMock
operator|.
name|expectAndDefaultReturn
argument_list|(
name|this
operator|.
name|request
operator|.
name|getHeader
argument_list|(
name|AuthenticationController
operator|.
name|AUTHORIZATION_HEADER
argument_list|)
argument_list|,
name|this
operator|.
name|tokenHeader
argument_list|)
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|replay
argument_list|()
expr_stmt|;
name|assertEquals
argument_list|(
name|this
operator|.
name|token
argument_list|,
name|this
operator|.
name|authenticator
operator|.
name|getTokenFromRequest
argument_list|(
name|this
operator|.
name|request
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|verify
argument_list|()
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|reset
argument_list|()
expr_stmt|;
comment|// test token null / cookie present
name|this
operator|.
name|requestMock
operator|.
name|expectAndDefaultReturn
argument_list|(
name|this
operator|.
name|request
operator|.
name|getHeader
argument_list|(
name|AuthenticationController
operator|.
name|AUTHORIZATION_HEADER
argument_list|)
argument_list|,
literal|null
argument_list|)
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|expectAndDefaultReturn
argument_list|(
name|this
operator|.
name|request
operator|.
name|getCookies
argument_list|()
argument_list|,
operator|new
name|Cookie
index|[]
block|{
name|this
operator|.
name|authCookie
block|}
argument_list|)
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|replay
argument_list|()
expr_stmt|;
name|assertEquals
argument_list|(
name|this
operator|.
name|token
argument_list|,
name|this
operator|.
name|authenticator
operator|.
name|getTokenFromRequest
argument_list|(
name|this
operator|.
name|request
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|verify
argument_list|()
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|reset
argument_list|()
expr_stmt|;
comment|// test token null / cookie not present
name|this
operator|.
name|requestMock
operator|.
name|expectAndDefaultReturn
argument_list|(
name|this
operator|.
name|request
operator|.
name|getHeader
argument_list|(
name|AuthenticationController
operator|.
name|AUTHORIZATION_HEADER
argument_list|)
argument_list|,
literal|null
argument_list|)
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|expectAndDefaultReturn
argument_list|(
name|this
operator|.
name|request
operator|.
name|getCookies
argument_list|()
argument_list|,
operator|new
name|Cookie
index|[]
block|{
operator|new
name|Cookie
argument_list|(
literal|"somekey"
argument_list|,
literal|"someValue"
argument_list|)
block|}
argument_list|)
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|replay
argument_list|()
expr_stmt|;
name|assertNull
argument_list|(
name|this
operator|.
name|authenticator
operator|.
name|getTokenFromRequest
argument_list|(
name|this
operator|.
name|request
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|verify
argument_list|()
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|reset
argument_list|()
expr_stmt|;
comment|//      test token null / cookie array emtpy
name|this
operator|.
name|requestMock
operator|.
name|expectAndDefaultReturn
argument_list|(
name|this
operator|.
name|request
operator|.
name|getHeader
argument_list|(
name|AuthenticationController
operator|.
name|AUTHORIZATION_HEADER
argument_list|)
argument_list|,
literal|null
argument_list|)
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|expectAndDefaultReturn
argument_list|(
name|this
operator|.
name|request
operator|.
name|getCookies
argument_list|()
argument_list|,
operator|new
name|Cookie
index|[]
block|{}
argument_list|)
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|replay
argument_list|()
expr_stmt|;
name|assertNull
argument_list|(
name|this
operator|.
name|authenticator
operator|.
name|getTokenFromRequest
argument_list|(
name|this
operator|.
name|request
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|verify
argument_list|()
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|reset
argument_list|()
expr_stmt|;
comment|//      test token null / cookie array null
name|this
operator|.
name|requestMock
operator|.
name|expectAndDefaultReturn
argument_list|(
name|this
operator|.
name|request
operator|.
name|getHeader
argument_list|(
name|AuthenticationController
operator|.
name|AUTHORIZATION_HEADER
argument_list|)
argument_list|,
literal|null
argument_list|)
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|expectAndDefaultReturn
argument_list|(
name|this
operator|.
name|request
operator|.
name|getCookies
argument_list|()
argument_list|,
literal|null
argument_list|)
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|replay
argument_list|()
expr_stmt|;
name|assertNull
argument_list|(
name|this
operator|.
name|authenticator
operator|.
name|getTokenFromRequest
argument_list|(
name|this
operator|.
name|request
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|verify
argument_list|()
expr_stmt|;
name|this
operator|.
name|requestMock
operator|.
name|reset
argument_list|()
expr_stmt|;
block|}
block|}
end_class
end_unit
