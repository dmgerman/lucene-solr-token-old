begin_unit
begin_package
DECL|package|org.apache.lucene.gdata.storage.lucenestorage
package|package
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|gdata
operator|.
name|storage
operator|.
name|lucenestorage
package|;
end_package
begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import
begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import
begin_import
import|import
name|junit
operator|.
name|framework
operator|.
name|TestCase
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|gdata
operator|.
name|data
operator|.
name|ServerBaseEntry
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|gdata
operator|.
name|storage
operator|.
name|lucenestorage
operator|.
name|StorageEntryWrapper
operator|.
name|StorageOperation
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|lucene
operator|.
name|gdata
operator|.
name|utils
operator|.
name|ProvidedServiceStub
import|;
end_import
begin_import
import|import
name|com
operator|.
name|google
operator|.
name|gdata
operator|.
name|data
operator|.
name|DateTime
import|;
end_import
begin_class
DECL|class|TestStorageBuffer
specifier|public
class|class
name|TestStorageBuffer
extends|extends
name|TestCase
block|{
DECL|field|FEEDID
specifier|private
specifier|static
specifier|final
name|String
name|FEEDID
init|=
literal|"feed"
decl_stmt|;
DECL|field|ENTRYID
specifier|private
specifier|static
specifier|final
name|String
name|ENTRYID
init|=
literal|"someID"
decl_stmt|;
DECL|field|buffer
specifier|private
name|StorageBuffer
name|buffer
decl_stmt|;
DECL|method|setUp
specifier|protected
name|void
name|setUp
parameter_list|()
throws|throws
name|Exception
block|{
name|super
operator|.
name|setUp
argument_list|()
expr_stmt|;
name|this
operator|.
name|buffer
operator|=
operator|new
name|StorageBuffer
argument_list|(
literal|10
argument_list|)
expr_stmt|;
block|}
DECL|method|tearDown
specifier|protected
name|void
name|tearDown
parameter_list|()
throws|throws
name|Exception
block|{
name|this
operator|.
name|buffer
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
comment|/*      * Test method for 'org.apache.lucene.gdata.storage.lucenestorage.StorageBuffer.StorageBuffer(int)'      */
DECL|method|testStorageBuffer
specifier|public
name|void
name|testStorageBuffer
parameter_list|()
block|{
name|assertEquals
argument_list|(
name|StorageBuffer
operator|.
name|DEFAULT_BUFFER_COUNT
argument_list|,
operator|new
name|StorageBuffer
argument_list|(
name|StorageBuffer
operator|.
name|DEFAULT_BUFFER_COUNT
operator|-
literal|1
argument_list|)
operator|.
name|getBufferSize
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|StorageBuffer
operator|.
name|DEFAULT_BUFFER_COUNT
argument_list|,
operator|new
name|StorageBuffer
argument_list|(
name|StorageBuffer
operator|.
name|DEFAULT_BUFFER_COUNT
argument_list|)
operator|.
name|getBufferSize
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|StorageBuffer
operator|.
name|DEFAULT_BUFFER_COUNT
operator|+
literal|1
argument_list|,
operator|new
name|StorageBuffer
argument_list|(
name|StorageBuffer
operator|.
name|DEFAULT_BUFFER_COUNT
operator|+
literal|1
argument_list|)
operator|.
name|getBufferSize
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|/*      * Test method for 'org.apache.lucene.gdata.storage.lucenestorage.StorageBuffer.addEntry(StorageEntryWrapper)'      */
DECL|method|testAddEntry
specifier|public
name|void
name|testAddEntry
parameter_list|()
throws|throws
name|IOException
block|{
name|ServerBaseEntry
name|e
init|=
name|createServerBaseEntry
argument_list|(
name|ENTRYID
argument_list|,
name|FEEDID
argument_list|)
decl_stmt|;
name|StorageEntryWrapper
name|wrapper
init|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|INSERT
argument_list|)
decl_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getSortedEntries
argument_list|(
name|FEEDID
argument_list|)
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getSortedEntries
argument_list|(
name|FEEDID
argument_list|)
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|e
operator|.
name|setId
argument_list|(
literal|"someotherID"
argument_list|)
expr_stmt|;
name|e
operator|.
name|setFeedId
argument_list|(
name|FEEDID
argument_list|)
expr_stmt|;
name|e
operator|.
name|setServiceConfig
argument_list|(
operator|new
name|ProvidedServiceStub
argument_list|()
argument_list|)
expr_stmt|;
name|wrapper
operator|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|INSERT
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getSortedEntries
argument_list|(
name|FEEDID
argument_list|)
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|e
operator|.
name|setId
argument_list|(
literal|"someotherID"
argument_list|)
expr_stmt|;
name|e
operator|.
name|setFeedId
argument_list|(
literal|"someOtherFeed"
argument_list|)
expr_stmt|;
name|e
operator|.
name|setServiceConfig
argument_list|(
operator|new
name|ProvidedServiceStub
argument_list|()
argument_list|)
expr_stmt|;
name|wrapper
operator|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|UPDATE
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|wrapper
operator|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|DELETE
argument_list|)
expr_stmt|;
name|e
operator|.
name|setId
argument_list|(
literal|"deleted and ingnored"
argument_list|)
expr_stmt|;
name|e
operator|.
name|setFeedId
argument_list|(
literal|"someOtherFeed"
argument_list|)
expr_stmt|;
name|e
operator|.
name|setServiceConfig
argument_list|(
operator|new
name|ProvidedServiceStub
argument_list|()
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getSortedEntries
argument_list|(
name|FEEDID
argument_list|)
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getSortedEntries
argument_list|(
literal|"someOtherFeed"
argument_list|)
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"Contains 2 different IDs"
argument_list|,
literal|2
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getExculdList
argument_list|()
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
comment|/*      * Test method for 'org.apache.lucene.gdata.storage.lucenestorage.StorageBuffer.addDeleted(String, String)'      */
DECL|method|testAddDeleted
specifier|public
name|void
name|testAddDeleted
parameter_list|()
throws|throws
name|IOException
block|{
name|this
operator|.
name|buffer
operator|.
name|addDeleted
argument_list|(
name|ENTRYID
argument_list|,
name|FEEDID
argument_list|)
expr_stmt|;
name|assertNull
argument_list|(
name|this
operator|.
name|buffer
operator|.
name|getSortedEntries
argument_list|(
name|FEEDID
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getExculdList
argument_list|()
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|ENTRYID
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getExculdList
argument_list|()
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addDeleted
argument_list|(
name|ENTRYID
argument_list|,
name|FEEDID
argument_list|)
expr_stmt|;
name|assertNull
argument_list|(
name|this
operator|.
name|buffer
operator|.
name|getSortedEntries
argument_list|(
name|FEEDID
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getExculdList
argument_list|()
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|ENTRYID
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getExculdList
argument_list|()
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
block|}
comment|/*      * Test method for 'org.apache.lucene.gdata.storage.lucenestorage.StorageBuffer.getFeedLastModified(String)'      */
DECL|method|testGetFeedLastModified
specifier|public
name|void
name|testGetFeedLastModified
parameter_list|()
throws|throws
name|IOException
throws|,
name|InterruptedException
block|{
name|ServerBaseEntry
name|e
init|=
name|createServerBaseEntry
argument_list|(
name|ENTRYID
argument_list|,
name|FEEDID
argument_list|)
decl_stmt|;
name|e
operator|.
name|setUpdated
argument_list|(
operator|new
name|DateTime
argument_list|(
name|System
operator|.
name|currentTimeMillis
argument_list|()
operator|-
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|StorageEntryWrapper
name|wrapper
init|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|INSERT
argument_list|)
decl_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Long
argument_list|(
name|e
operator|.
name|getUpdated
argument_list|()
operator|.
name|getValue
argument_list|()
argument_list|)
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getFeedLastModified
argument_list|(
name|FEEDID
argument_list|)
argument_list|)
expr_stmt|;
comment|//test update
comment|//      force timestamp
name|e
operator|.
name|setUpdated
argument_list|(
operator|new
name|DateTime
argument_list|(
name|System
operator|.
name|currentTimeMillis
argument_list|()
operator|-
literal|180
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|wrapper
operator|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|UPDATE
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|Long
name|firstAddTimestamp
init|=
operator|new
name|Long
argument_list|(
name|e
operator|.
name|getUpdated
argument_list|()
operator|.
name|getValue
argument_list|()
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|firstAddTimestamp
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getFeedLastModified
argument_list|(
name|FEEDID
argument_list|)
argument_list|)
expr_stmt|;
comment|//      force timestamp
name|e
operator|.
name|setUpdated
argument_list|(
operator|new
name|DateTime
argument_list|(
name|System
operator|.
name|currentTimeMillis
argument_list|()
operator|-
literal|160
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|assertFalse
argument_list|(
literal|"updated after add"
argument_list|,
name|e
operator|.
name|getUpdated
argument_list|()
operator|.
name|equals
argument_list|(
name|this
operator|.
name|buffer
operator|.
name|getFeedLastModified
argument_list|(
name|FEEDID
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|//insert for other feed
name|String
name|otherID
init|=
literal|"someOtherFeedID"
decl_stmt|;
name|e
operator|.
name|setFeedId
argument_list|(
name|otherID
argument_list|)
expr_stmt|;
comment|//      force timestamp
name|e
operator|.
name|setUpdated
argument_list|(
operator|new
name|DateTime
argument_list|(
name|System
operator|.
name|currentTimeMillis
argument_list|()
operator|-
literal|140
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|wrapper
operator|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|INSERT
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Long
argument_list|(
name|e
operator|.
name|getUpdated
argument_list|()
operator|.
name|getValue
argument_list|()
argument_list|)
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getFeedLastModified
argument_list|(
name|otherID
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|firstAddTimestamp
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getFeedLastModified
argument_list|(
name|FEEDID
argument_list|)
argument_list|)
expr_stmt|;
name|assertTrue
argument_list|(
name|firstAddTimestamp
operator|.
name|equals
argument_list|(
name|this
operator|.
name|buffer
operator|.
name|getFeedLastModified
argument_list|(
name|FEEDID
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addDeleted
argument_list|(
name|e
operator|.
name|getId
argument_list|()
argument_list|,
name|FEEDID
argument_list|)
expr_stmt|;
comment|// time will be set inside the buffer
name|assertTrue
argument_list|(
name|firstAddTimestamp
operator|<
name|this
operator|.
name|buffer
operator|.
name|getFeedLastModified
argument_list|(
name|FEEDID
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/*      * Test method for 'org.apache.lucene.gdata.storage.lucenestorage.StorageBuffer.getSortedEntries(String)'      */
DECL|method|testGetSortedEntries
specifier|public
name|void
name|testGetSortedEntries
parameter_list|()
throws|throws
name|IOException
throws|,
name|InterruptedException
block|{
name|assertNull
argument_list|(
name|this
operator|.
name|buffer
operator|.
name|getSortedEntries
argument_list|(
name|FEEDID
argument_list|)
argument_list|)
expr_stmt|;
name|ServerBaseEntry
name|e
init|=
name|createServerBaseEntry
argument_list|(
literal|"2"
argument_list|,
name|FEEDID
argument_list|)
decl_stmt|;
name|e
operator|.
name|setUpdated
argument_list|(
operator|new
name|DateTime
argument_list|(
name|System
operator|.
name|currentTimeMillis
argument_list|()
operator|-
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|StorageEntryWrapper
name|wrapper
init|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|INSERT
argument_list|)
decl_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|e
operator|.
name|setId
argument_list|(
literal|"0"
argument_list|)
expr_stmt|;
comment|//      force timestamp
name|e
operator|.
name|setUpdated
argument_list|(
operator|new
name|DateTime
argument_list|(
name|System
operator|.
name|currentTimeMillis
argument_list|()
operator|-
literal|180
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|wrapper
operator|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|INSERT
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|e
operator|.
name|setId
argument_list|(
literal|"1"
argument_list|)
expr_stmt|;
comment|//      force timestamp
name|e
operator|.
name|setUpdated
argument_list|(
operator|new
name|DateTime
argument_list|(
name|System
operator|.
name|currentTimeMillis
argument_list|()
operator|-
literal|160
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|wrapper
operator|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|INSERT
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|e
operator|.
name|setId
argument_list|(
literal|"0"
argument_list|)
expr_stmt|;
comment|//      force timestamp
name|e
operator|.
name|setUpdated
argument_list|(
operator|new
name|DateTime
argument_list|(
name|System
operator|.
name|currentTimeMillis
argument_list|()
operator|-
literal|140
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|wrapper
operator|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|UPDATE
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
comment|//      force timestamp
name|e
operator|.
name|setUpdated
argument_list|(
operator|new
name|DateTime
argument_list|(
name|System
operator|.
name|currentTimeMillis
argument_list|()
operator|-
literal|120
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|wrapper
operator|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|DELETE
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|StorageEntryWrapper
argument_list|>
name|list
init|=
name|this
operator|.
name|buffer
operator|.
name|getSortedEntries
argument_list|(
name|FEEDID
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|3
argument_list|,
name|list
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
name|i
operator|++
control|)
block|{
name|assertEquals
argument_list|(
literal|""
operator|+
name|i
argument_list|,
name|list
operator|.
name|get
argument_list|(
name|i
argument_list|)
operator|.
name|getEntryId
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
comment|/*      * Test method for 'org.apache.lucene.gdata.storage.lucenestorage.StorageBuffer.getEntry(String, String)'      */
DECL|method|testGetEntry
specifier|public
name|void
name|testGetEntry
parameter_list|()
throws|throws
name|IOException
block|{
name|assertNull
argument_list|(
name|this
operator|.
name|buffer
operator|.
name|getEntry
argument_list|(
name|ENTRYID
argument_list|,
name|FEEDID
argument_list|)
argument_list|)
expr_stmt|;
name|ServerBaseEntry
name|e
init|=
name|createServerBaseEntry
argument_list|(
name|ENTRYID
argument_list|,
name|FEEDID
argument_list|)
decl_stmt|;
name|StorageEntryWrapper
name|wrapper
init|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|INSERT
argument_list|)
decl_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|assertSame
argument_list|(
name|wrapper
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getEntry
argument_list|(
name|ENTRYID
argument_list|,
name|FEEDID
argument_list|)
argument_list|)
expr_stmt|;
name|e
operator|=
name|createServerBaseEntry
argument_list|(
literal|"0"
argument_list|,
name|FEEDID
argument_list|)
expr_stmt|;
name|wrapper
operator|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|UPDATE
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|assertSame
argument_list|(
name|wrapper
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getEntry
argument_list|(
literal|"0"
argument_list|,
name|FEEDID
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/*      * Test method for 'org.apache.lucene.gdata.storage.lucenestorage.StorageBuffer.getExculdList()'      */
DECL|method|testGetExculdList
specifier|public
name|void
name|testGetExculdList
parameter_list|()
throws|throws
name|IOException
block|{
name|ServerBaseEntry
name|e
init|=
name|createServerBaseEntry
argument_list|(
name|ENTRYID
argument_list|,
name|FEEDID
argument_list|)
decl_stmt|;
name|StorageEntryWrapper
name|wrapper
init|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|INSERT
argument_list|)
decl_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getExculdList
argument_list|()
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|wrapper
operator|.
name|getEntryId
argument_list|()
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getExculdList
argument_list|()
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|wrapper
operator|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|UPDATE
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getExculdList
argument_list|()
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|wrapper
operator|.
name|getEntryId
argument_list|()
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getExculdList
argument_list|()
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addDeleted
argument_list|(
name|ENTRYID
argument_list|,
name|FEEDID
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getExculdList
argument_list|()
operator|.
name|length
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|wrapper
operator|.
name|getEntryId
argument_list|()
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getExculdList
argument_list|()
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|e
operator|=
name|createServerBaseEntry
argument_list|(
literal|"someOtherEntry"
argument_list|,
literal|"someOtherFeed"
argument_list|)
expr_stmt|;
name|wrapper
operator|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|INSERT
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|2
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getExculdList
argument_list|()
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
comment|/*      * Test method for 'org.apache.lucene.gdata.storage.lucenestorage.StorageBuffer.close()'      */
DECL|method|testClose
specifier|public
name|void
name|testClose
parameter_list|()
throws|throws
name|IOException
block|{
name|ServerBaseEntry
name|e
init|=
name|createServerBaseEntry
argument_list|(
name|ENTRYID
argument_list|,
name|FEEDID
argument_list|)
decl_stmt|;
name|StorageEntryWrapper
name|wrapper
init|=
operator|new
name|StorageEntryWrapper
argument_list|(
name|e
argument_list|,
name|StorageOperation
operator|.
name|INSERT
argument_list|)
decl_stmt|;
name|this
operator|.
name|buffer
operator|.
name|addEntry
argument_list|(
name|wrapper
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|this
operator|.
name|buffer
operator|.
name|getSortedEntries
argument_list|(
name|FEEDID
argument_list|)
argument_list|)
expr_stmt|;
name|assertNotNull
argument_list|(
name|this
operator|.
name|buffer
operator|.
name|getEntry
argument_list|(
name|ENTRYID
argument_list|,
name|FEEDID
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|1
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getExculdList
argument_list|()
operator|.
name|length
argument_list|)
expr_stmt|;
name|this
operator|.
name|buffer
operator|.
name|close
argument_list|()
expr_stmt|;
name|assertNull
argument_list|(
name|this
operator|.
name|buffer
operator|.
name|getSortedEntries
argument_list|(
name|FEEDID
argument_list|)
argument_list|)
expr_stmt|;
name|assertNull
argument_list|(
name|this
operator|.
name|buffer
operator|.
name|getEntry
argument_list|(
name|ENTRYID
argument_list|,
name|FEEDID
argument_list|)
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|0
argument_list|,
name|this
operator|.
name|buffer
operator|.
name|getExculdList
argument_list|()
operator|.
name|length
argument_list|)
expr_stmt|;
block|}
DECL|method|createServerBaseEntry
specifier|public
name|ServerBaseEntry
name|createServerBaseEntry
parameter_list|(
name|String
name|entryID
parameter_list|,
name|String
name|feedId
parameter_list|)
throws|throws
name|IOException
block|{
name|ServerBaseEntry
name|e
init|=
operator|new
name|ServerBaseEntry
argument_list|()
decl_stmt|;
name|e
operator|.
name|setId
argument_list|(
name|entryID
argument_list|)
expr_stmt|;
name|e
operator|.
name|setFeedId
argument_list|(
name|feedId
argument_list|)
expr_stmt|;
name|e
operator|.
name|setServiceConfig
argument_list|(
operator|new
name|ProvidedServiceStub
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|e
return|;
block|}
block|}
end_class
end_unit
