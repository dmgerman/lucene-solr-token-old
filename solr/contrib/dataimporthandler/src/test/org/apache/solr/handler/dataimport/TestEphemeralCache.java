begin_unit
begin_package
DECL|package|org.apache.solr.handler.dataimport
package|package
name|org
operator|.
name|apache
operator|.
name|solr
operator|.
name|handler
operator|.
name|dataimport
package|;
end_package
begin_import
import|import
name|java
operator|.
name|math
operator|.
name|BigDecimal
import|;
end_import
begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import
begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import
begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|BeforeClass
import|;
end_import
begin_class
DECL|class|TestEphemeralCache
specifier|public
class|class
name|TestEphemeralCache
extends|extends
name|AbstractDataImportHandlerTestCase
block|{
annotation|@
name|BeforeClass
DECL|method|beforeClass
specifier|public
specifier|static
name|void
name|beforeClass
parameter_list|()
throws|throws
name|Exception
block|{
name|initCore
argument_list|(
literal|"dataimport-solrconfig.xml"
argument_list|,
literal|"dataimport-schema.xml"
argument_list|)
expr_stmt|;
block|}
DECL|method|testEphemeralCache
specifier|public
name|void
name|testEphemeralCache
parameter_list|()
throws|throws
name|Exception
block|{
name|List
name|parentRows
init|=
operator|new
name|ArrayList
argument_list|()
decl_stmt|;
name|parentRows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"1"
argument_list|)
argument_list|,
literal|"parent_s"
argument_list|,
literal|"one"
argument_list|)
argument_list|)
expr_stmt|;
name|parentRows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"2"
argument_list|)
argument_list|,
literal|"parent_s"
argument_list|,
literal|"two"
argument_list|)
argument_list|)
expr_stmt|;
name|parentRows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"3"
argument_list|)
argument_list|,
literal|"parent_s"
argument_list|,
literal|"three"
argument_list|)
argument_list|)
expr_stmt|;
name|parentRows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"4"
argument_list|)
argument_list|,
literal|"parent_s"
argument_list|,
literal|"four"
argument_list|)
argument_list|)
expr_stmt|;
name|parentRows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"5"
argument_list|)
argument_list|,
literal|"parent_s"
argument_list|,
literal|"five"
argument_list|)
argument_list|)
expr_stmt|;
name|List
name|child1Rows
init|=
operator|new
name|ArrayList
argument_list|()
decl_stmt|;
name|child1Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"6"
argument_list|)
argument_list|,
literal|"child1a_mult_s"
argument_list|,
literal|"this is the number six."
argument_list|)
argument_list|)
expr_stmt|;
name|child1Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"5"
argument_list|)
argument_list|,
literal|"child1a_mult_s"
argument_list|,
literal|"this is the number five."
argument_list|)
argument_list|)
expr_stmt|;
name|child1Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"6"
argument_list|)
argument_list|,
literal|"child1a_mult_s"
argument_list|,
literal|"let's sing a song of six."
argument_list|)
argument_list|)
expr_stmt|;
name|child1Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"3"
argument_list|)
argument_list|,
literal|"child1a_mult_s"
argument_list|,
literal|"three"
argument_list|)
argument_list|)
expr_stmt|;
name|child1Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"3"
argument_list|)
argument_list|,
literal|"child1a_mult_s"
argument_list|,
literal|"III"
argument_list|)
argument_list|)
expr_stmt|;
name|child1Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"3"
argument_list|)
argument_list|,
literal|"child1a_mult_s"
argument_list|,
literal|"3"
argument_list|)
argument_list|)
expr_stmt|;
name|child1Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"3"
argument_list|)
argument_list|,
literal|"child1a_mult_s"
argument_list|,
literal|"|||"
argument_list|)
argument_list|)
expr_stmt|;
name|child1Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"1"
argument_list|)
argument_list|,
literal|"child1a_mult_s"
argument_list|,
literal|"one"
argument_list|)
argument_list|)
expr_stmt|;
name|child1Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"1"
argument_list|)
argument_list|,
literal|"child1a_mult_s"
argument_list|,
literal|"uno"
argument_list|)
argument_list|)
expr_stmt|;
name|child1Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"2"
argument_list|)
argument_list|,
literal|"child1b_s"
argument_list|,
literal|"CHILD1B"
argument_list|,
literal|"child1a_mult_s"
argument_list|,
literal|"this is the number two."
argument_list|)
argument_list|)
expr_stmt|;
name|List
name|child2Rows
init|=
operator|new
name|ArrayList
argument_list|()
decl_stmt|;
name|child2Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"6"
argument_list|)
argument_list|,
literal|"child2a_mult_s"
argument_list|,
literal|"Child 2 says, 'this is the number six.'"
argument_list|)
argument_list|)
expr_stmt|;
name|child2Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"5"
argument_list|)
argument_list|,
literal|"child2a_mult_s"
argument_list|,
literal|"Child 2 says, 'this is the number five.'"
argument_list|)
argument_list|)
expr_stmt|;
name|child2Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"6"
argument_list|)
argument_list|,
literal|"child2a_mult_s"
argument_list|,
literal|"Child 2 says, 'let's sing a song of six.'"
argument_list|)
argument_list|)
expr_stmt|;
name|child2Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"3"
argument_list|)
argument_list|,
literal|"child2a_mult_s"
argument_list|,
literal|"Child 2 says, 'three'"
argument_list|)
argument_list|)
expr_stmt|;
name|child2Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"3"
argument_list|)
argument_list|,
literal|"child2a_mult_s"
argument_list|,
literal|"Child 2 says, 'III'"
argument_list|)
argument_list|)
expr_stmt|;
name|child2Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"3"
argument_list|)
argument_list|,
literal|"child2b_s"
argument_list|,
literal|"CHILD2B"
argument_list|,
literal|"child2a_mult_s"
argument_list|,
literal|"Child 2 says, '3'"
argument_list|)
argument_list|)
expr_stmt|;
name|child2Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"3"
argument_list|)
argument_list|,
literal|"child2a_mult_s"
argument_list|,
literal|"Child 2 says, '|||'"
argument_list|)
argument_list|)
expr_stmt|;
name|child2Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"1"
argument_list|)
argument_list|,
literal|"child2a_mult_s"
argument_list|,
literal|"Child 2 says, 'one'"
argument_list|)
argument_list|)
expr_stmt|;
name|child2Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"1"
argument_list|)
argument_list|,
literal|"child2a_mult_s"
argument_list|,
literal|"Child 2 says, 'uno'"
argument_list|)
argument_list|)
expr_stmt|;
name|child2Rows
operator|.
name|add
argument_list|(
name|createMap
argument_list|(
literal|"id"
argument_list|,
operator|new
name|BigDecimal
argument_list|(
literal|"2"
argument_list|)
argument_list|,
literal|"child2a_mult_s"
argument_list|,
literal|"Child 2 says, 'this is the number two.'"
argument_list|)
argument_list|)
expr_stmt|;
name|MockDataSource
operator|.
name|setIterator
argument_list|(
literal|"SELECT * FROM PARENT"
argument_list|,
name|parentRows
operator|.
name|iterator
argument_list|()
argument_list|)
expr_stmt|;
name|MockDataSource
operator|.
name|setIterator
argument_list|(
literal|"SELECT * FROM CHILD_1"
argument_list|,
name|child1Rows
operator|.
name|iterator
argument_list|()
argument_list|)
expr_stmt|;
name|MockDataSource
operator|.
name|setIterator
argument_list|(
literal|"SELECT * FROM CHILD_2"
argument_list|,
name|child2Rows
operator|.
name|iterator
argument_list|()
argument_list|)
expr_stmt|;
name|runFullImport
argument_list|(
name|loadDataConfig
argument_list|(
literal|"dataimport-cache-ephemeral.xml"
argument_list|)
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"*:*"
argument_list|)
argument_list|,
literal|"//*[@numFound='5']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"id:1"
argument_list|)
argument_list|,
literal|"//*[@numFound='1']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"id:6"
argument_list|)
argument_list|,
literal|"//*[@numFound='0']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"parent_s:four"
argument_list|)
argument_list|,
literal|"//*[@numFound='1']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"child1a_mult_s:this\\ is\\ the\\ numbe*"
argument_list|)
argument_list|,
literal|"//*[@numFound='2']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"child2a_mult_s:Child\\ 2\\ say*"
argument_list|)
argument_list|,
literal|"//*[@numFound='4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"child1b_s:CHILD1B"
argument_list|)
argument_list|,
literal|"//*[@numFound='1']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"child2b_s:CHILD2B"
argument_list|)
argument_list|,
literal|"//*[@numFound='1']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"child1a_mult_s:one"
argument_list|)
argument_list|,
literal|"//*[@numFound='1']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"child1a_mult_s:uno"
argument_list|)
argument_list|,
literal|"//*[@numFound='1']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"child1a_mult_s:(uno OR one)"
argument_list|)
argument_list|,
literal|"//*[@numFound='1']"
argument_list|)
expr_stmt|;
block|}
block|}
end_class
end_unit
