begin_unit
begin_comment
comment|/*  * Licensed to the Apache Software Foundation (ASF) under one or more  * contributor license agreements.  See the NOTICE file distributed with  * this work for additional information regarding copyright ownership.  * The ASF licenses this file to You under the Apache License, Version 2.0  * (the "License"); you may not use this file except in compliance with  * the License.  You may obtain a copy of the License at  *  *     http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment
begin_package
DECL|package|org.apache.solr.update.processor
package|package
name|org
operator|.
name|apache
operator|.
name|solr
operator|.
name|update
operator|.
name|processor
package|;
end_package
begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import
begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Date
import|;
end_import
begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import
begin_import
import|import
name|com
operator|.
name|google
operator|.
name|common
operator|.
name|collect
operator|.
name|ImmutableMap
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|solr
operator|.
name|SolrTestCaseJ4
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|solr
operator|.
name|common
operator|.
name|SolrInputDocument
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|solr
operator|.
name|schema
operator|.
name|TrieDateField
import|;
end_import
begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|solr
operator|.
name|util
operator|.
name|DateMathParser
import|;
end_import
begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Before
import|;
end_import
begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|BeforeClass
import|;
end_import
begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Ignore
import|;
end_import
begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Test
import|;
end_import
begin_class
DECL|class|AtomicUpdatesTest
specifier|public
class|class
name|AtomicUpdatesTest
extends|extends
name|SolrTestCaseJ4
block|{
annotation|@
name|BeforeClass
DECL|method|beforeTests
specifier|public
specifier|static
name|void
name|beforeTests
parameter_list|()
throws|throws
name|Exception
block|{
name|System
operator|.
name|setProperty
argument_list|(
literal|"enable.update.log"
argument_list|,
literal|"true"
argument_list|)
expr_stmt|;
name|initCore
argument_list|(
literal|"solrconfig.xml"
argument_list|,
literal|"schema.xml"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Before
DECL|method|before
specifier|public
name|void
name|before
parameter_list|()
block|{
name|h
operator|.
name|update
argument_list|(
literal|"<delete><query>*:*</query></delete>"
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRemove
specifier|public
name|void
name|testRemove
parameter_list|()
throws|throws
name|Exception
block|{
name|SolrInputDocument
name|doc
decl_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"aaa"
block|,
literal|"bbb"
block|,
literal|"ccc"
block|,
literal|"ccc"
block|,
literal|"ddd"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"2"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"aaa"
block|,
literal|"bbb"
block|,
literal|"bbb"
block|,
literal|"ccc"
block|,
literal|"ddd"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"20"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"aaa"
block|,
literal|"ccc"
block|,
literal|"ddd"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"21"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"aaa"
block|,
literal|"bbb"
block|,
literal|"ddd"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:bbb"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1"
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|String
argument_list|>
name|removeList
init|=
operator|new
name|ArrayList
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"bbb"
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"ccc"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:bbb"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"21"
argument_list|)
expr_stmt|;
name|removeList
operator|=
operator|new
name|ArrayList
argument_list|<
name|String
argument_list|>
argument_list|()
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"bbb"
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"ccc"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:bbb"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
literal|"aaa"
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr directly
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:aaa"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRemoveInteger
specifier|public
name|void
name|testRemoveInteger
parameter_list|()
throws|throws
name|Exception
block|{
name|SolrInputDocument
name|doc
decl_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111"
block|,
literal|"222"
block|,
literal|"333"
block|,
literal|"333"
block|,
literal|"444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1002"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111"
block|,
literal|"222"
block|,
literal|"222"
block|,
literal|"333"
block|,
literal|"444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1020"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111"
block|,
literal|"333"
block|,
literal|"444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1021"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111"
block|,
literal|"222"
block|,
literal|"444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|Long
argument_list|>
name|removeList
init|=
operator|new
name|ArrayList
argument_list|<
name|Long
argument_list|>
argument_list|()
decl_stmt|;
name|removeList
operator|.
name|add
argument_list|(
operator|new
name|Long
argument_list|(
literal|222
argument_list|)
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
operator|new
name|Long
argument_list|(
literal|333
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1021"
argument_list|)
expr_stmt|;
name|removeList
operator|=
operator|new
name|ArrayList
argument_list|<
name|Long
argument_list|>
argument_list|()
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
operator|new
name|Long
argument_list|(
literal|222
argument_list|)
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
operator|new
name|Long
argument_list|(
literal|333
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
literal|111
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr directly
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:111"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRemoveIntegerInDocSavedWithInteger
specifier|public
name|void
name|testRemoveIntegerInDocSavedWithInteger
parameter_list|()
throws|throws
name|Exception
block|{
name|SolrInputDocument
name|doc
decl_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|Integer
index|[]
block|{
literal|111
block|,
literal|222
block|,
literal|333
block|,
literal|333
block|,
literal|444
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1002"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|Integer
index|[]
block|{
literal|111
block|,
literal|222
block|,
literal|222
block|,
literal|333
block|,
literal|444
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1020"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|Integer
index|[]
block|{
literal|111
block|,
literal|333
block|,
literal|444
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1021"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|Integer
index|[]
block|{
literal|111
block|,
literal|222
block|,
literal|444
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|Long
argument_list|>
name|removeList
init|=
operator|new
name|ArrayList
argument_list|<
name|Long
argument_list|>
argument_list|()
decl_stmt|;
name|removeList
operator|.
name|add
argument_list|(
operator|new
name|Long
argument_list|(
literal|222
argument_list|)
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
operator|new
name|Long
argument_list|(
literal|333
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1021"
argument_list|)
expr_stmt|;
name|removeList
operator|=
operator|new
name|ArrayList
argument_list|<
name|Long
argument_list|>
argument_list|()
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
operator|new
name|Long
argument_list|(
literal|222
argument_list|)
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
operator|new
name|Long
argument_list|(
literal|333
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
literal|111
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr directly
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:111"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRemoveIntegerUsingStringType
specifier|public
name|void
name|testRemoveIntegerUsingStringType
parameter_list|()
throws|throws
name|Exception
block|{
name|SolrInputDocument
name|doc
decl_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111"
block|,
literal|"222"
block|,
literal|"333"
block|,
literal|"333"
block|,
literal|"444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1002"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111"
block|,
literal|"222"
block|,
literal|"222"
block|,
literal|"333"
block|,
literal|"444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1020"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111"
block|,
literal|"333"
block|,
literal|"444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1021"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111"
block|,
literal|"222"
block|,
literal|"444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|String
argument_list|>
name|removeList
init|=
operator|new
name|ArrayList
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"222"
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"333"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1021"
argument_list|)
expr_stmt|;
name|removeList
operator|=
operator|new
name|ArrayList
argument_list|<
name|String
argument_list|>
argument_list|()
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"222"
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"333"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
literal|"111"
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr directly
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:111"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRemoveIntegerUsingLongType
specifier|public
name|void
name|testRemoveIntegerUsingLongType
parameter_list|()
throws|throws
name|Exception
block|{
name|SolrInputDocument
name|doc
decl_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|Long
index|[]
block|{
literal|111L
block|,
literal|222L
block|,
literal|333L
block|,
literal|333L
block|,
literal|444L
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1002"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|Long
index|[]
block|{
literal|111L
block|,
literal|222L
block|,
literal|222L
block|,
literal|333L
block|,
literal|444L
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1020"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|Long
index|[]
block|{
literal|111L
block|,
literal|333L
block|,
literal|444L
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1021"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|Long
index|[]
block|{
literal|111L
block|,
literal|222L
block|,
literal|444L
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|Long
argument_list|>
name|removeList
init|=
operator|new
name|ArrayList
argument_list|<
name|Long
argument_list|>
argument_list|()
decl_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|222L
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|333L
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1021"
argument_list|)
expr_stmt|;
name|removeList
operator|=
operator|new
name|ArrayList
argument_list|<
name|Long
argument_list|>
argument_list|()
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|222L
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|333L
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
literal|111L
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr directly
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:111"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRemoveIntegerUsingFloatType
specifier|public
name|void
name|testRemoveIntegerUsingFloatType
parameter_list|()
throws|throws
name|Exception
block|{
name|SolrInputDocument
name|doc
decl_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
comment|//    add with float in integer field
comment|//    doc.setField("id", "1001");
comment|//    doc.setField("intRemove", new Float[]{111.10F, 222.20F, 333.30F, 333.30F, 444.40F});
comment|//    assertU(adoc(doc));
comment|//
comment|//    doc = new SolrInputDocument();
comment|//    doc.setField("id", "1002");
comment|//    doc.setField("intRemove", new Float[]{111.10F, 222.20F, 222.20F, 333.30F, 444.40F});
comment|//    assertU(adoc(doc));
comment|//
comment|//    doc = new SolrInputDocument();
comment|//    doc.setField("id", "1020");
comment|//    doc.setField("intRemove", new Float[]{111.10F, 333.30F, 444.40F});
comment|//    assertU(adoc(doc));
comment|//
comment|//    doc = new SolrInputDocument();
comment|//    doc.setField("id", "1021");
comment|//    doc.setField("intRemove", new Float[]{111.10F, 222.20F, 444.40F});
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111"
block|,
literal|"222"
block|,
literal|"333"
block|,
literal|"333"
block|,
literal|"444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1002"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111"
block|,
literal|"222"
block|,
literal|"222"
block|,
literal|"333"
block|,
literal|"444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1020"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111"
block|,
literal|"333"
block|,
literal|"444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1021"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111"
block|,
literal|"222"
block|,
literal|"444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|Float
argument_list|>
name|removeList
init|=
operator|new
name|ArrayList
argument_list|<
name|Float
argument_list|>
argument_list|()
decl_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|222.20F
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|333.30F
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1021"
argument_list|)
expr_stmt|;
name|removeList
operator|=
operator|new
name|ArrayList
argument_list|<
name|Float
argument_list|>
argument_list|()
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|222.20F
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|333.30F
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
literal|111L
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr directly
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:111"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRemoveIntegerUsingDoubleType
specifier|public
name|void
name|testRemoveIntegerUsingDoubleType
parameter_list|()
throws|throws
name|Exception
block|{
name|SolrInputDocument
name|doc
decl_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"11111111"
block|,
literal|"22222222"
block|,
literal|"33333333"
block|,
literal|"33333333"
block|,
literal|"44444444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1002"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"11111111"
block|,
literal|"22222222"
block|,
literal|"22222222"
block|,
literal|"33333333"
block|,
literal|"44444444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1020"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"11111111"
block|,
literal|"33333333"
block|,
literal|"44444444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1021"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"11111111"
block|,
literal|"22222222"
block|,
literal|"44444444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:22222222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|Double
argument_list|>
name|removeList
init|=
operator|new
name|ArrayList
argument_list|<
name|Double
argument_list|>
argument_list|()
decl_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|22222222D
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|33333333D
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:22222222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1021"
argument_list|)
expr_stmt|;
name|removeList
operator|=
operator|new
name|ArrayList
argument_list|<
name|Double
argument_list|>
argument_list|()
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|22222222D
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|33333333D
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:22222222"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"intRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
literal|11111111D
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr directly
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"intRemove:11111111"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRemoveDateUsingStringType
specifier|public
name|void
name|testRemoveDateUsingStringType
parameter_list|()
throws|throws
name|Exception
block|{
name|SolrInputDocument
name|doc
decl_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"dateRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"2014-09-01T12:00:00Z"
block|,
literal|"2014-09-02T12:00:00Z"
block|,
literal|"2014-09-03T12:00:00Z"
block|,
literal|"2014-09-03T12:00:00Z"
block|,
literal|"2014-09-04T12:00:00Z"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10002"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"dateRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"2014-09-01T12:00:00Z"
block|,
literal|"2014-09-02T12:00:00Z"
block|,
literal|"2014-09-02T12:00:00Z"
block|,
literal|"2014-09-03T12:00:00Z"
block|,
literal|"2014-09-04T12:00:00Z"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10020"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"dateRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"2014-09-01T12:00:00Z"
block|,
literal|"2014-09-03T12:00:00Z"
block|,
literal|"2014-09-04T12:00:00Z"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10021"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"dateRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"2014-09-01T12:00:00Z"
block|,
literal|"2014-09-02T12:00:00Z"
block|,
literal|"2014-09-04T12:00:00Z"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:\"2014-09-02T12:00:00Z\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10001"
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|String
argument_list|>
name|removeList
init|=
operator|new
name|ArrayList
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"2014-09-02T12:00:00Z"
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"2014-09-03T12:00:00Z"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"dateRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:\"2014-09-02T12:00:00Z\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10021"
argument_list|)
expr_stmt|;
name|removeList
operator|=
operator|new
name|ArrayList
argument_list|<
name|String
argument_list|>
argument_list|()
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"2014-09-02T12:00:00Z"
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"2014-09-03T12:00:00Z"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"dateRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:\"2014-09-02T12:00:00Z\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"dateRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
literal|"2014-09-01T12:00:00Z"
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr directly
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:\"2014-09-01T12:00:00Z\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Ignore
argument_list|(
literal|"Remove Date is not supported in other formats than UTC"
argument_list|)
annotation|@
name|Test
DECL|method|testRemoveDateUsingDateType
specifier|public
name|void
name|testRemoveDateUsingDateType
parameter_list|()
throws|throws
name|Exception
block|{
name|SolrInputDocument
name|doc
decl_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10001"
argument_list|)
expr_stmt|;
name|TrieDateField
name|trieDF
init|=
operator|new
name|TrieDateField
argument_list|()
decl_stmt|;
name|Date
name|tempDate
init|=
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-01T12:00:00Z"
argument_list|)
decl_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"dateRemove"
argument_list|,
operator|new
name|Date
index|[]
block|{
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-01T12:00:00Z"
argument_list|)
block|,
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-07-02T12:00:00Z"
argument_list|)
block|,
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-03T12:00:00Z"
argument_list|)
block|,
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-03T12:00:00Z"
argument_list|)
block|,
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-04T12:00:00Z"
argument_list|)
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10002"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"dateRemove"
argument_list|,
operator|new
name|Date
index|[]
block|{
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-01T12:00:00Z"
argument_list|)
block|,
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-07-02T12:00:00Z"
argument_list|)
block|,
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-02T12:00:00Z"
argument_list|)
block|,
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-03T12:00:00Z"
argument_list|)
block|,
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-04T12:00:00Z"
argument_list|)
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10020"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"dateRemove"
argument_list|,
operator|new
name|Date
index|[]
block|{
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-01T12:00:00Z"
argument_list|)
block|,
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-03T12:00:00Z"
argument_list|)
block|,
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-04T12:00:00Z"
argument_list|)
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10021"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"dateRemove"
argument_list|,
operator|new
name|Date
index|[]
block|{
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-01T12:00:00Z"
argument_list|)
block|,
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-02T12:00:00Z"
argument_list|)
block|,
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-04T12:00:00Z"
argument_list|)
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|String
name|dateString
init|=
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-02-02T12:00:00Z"
argument_list|)
operator|.
name|toString
argument_list|()
decl_stmt|;
comment|//    assertQ(req("q", "dateRemove:"+URLEncoder.encode(dateString, "UTF-8"), "indent", "true"), "//result[@numFound = '3']");
comment|//    assertQ(req("q", "dateRemove:\"2014-09-02T12:00:00Z\"", "indent", "true"), "//result[@numFound = '3']");
comment|//    assertQ(req("q", "dateRemove:"+dateString, "indent", "true"), "//result[@numFound = '3']"); //Sun Feb 02 10:00:00 FNT 2014
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:\"Sun Feb 02 10:00:00 FNT 2014\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
comment|//Sun Feb 02 10:00:00 FNT 2014
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10001"
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|Date
argument_list|>
name|removeList
init|=
operator|new
name|ArrayList
argument_list|<
name|Date
argument_list|>
argument_list|()
decl_stmt|;
name|removeList
operator|.
name|add
argument_list|(
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-09-02T12:00:00Z"
argument_list|)
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-09-03T12:00:00Z"
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"dateRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:\"2014-09-02T12:00:00Z\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10021"
argument_list|)
expr_stmt|;
name|removeList
operator|=
operator|new
name|ArrayList
argument_list|<
name|Date
argument_list|>
argument_list|()
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-09-02T12:00:00Z"
argument_list|)
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-09-03T12:00:00Z"
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"dateRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:\"2014-09-02T12:00:00Z\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"dateRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|DateMathParser
operator|.
name|parseMath
argument_list|(
literal|null
argument_list|,
literal|"2014-09-01T12:00:00Z"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr directly
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"dateRemove:\"2014-09-01T12:00:00Z\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRemoveFloatUsingFloatType
specifier|public
name|void
name|testRemoveFloatUsingFloatType
parameter_list|()
throws|throws
name|Exception
block|{
name|SolrInputDocument
name|doc
decl_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"floatRemove"
argument_list|,
operator|new
name|Float
index|[]
block|{
literal|111.111F
block|,
literal|222.222F
block|,
literal|333.333F
block|,
literal|333.333F
block|,
literal|444.444F
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10002"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"floatRemove"
argument_list|,
operator|new
name|Float
index|[]
block|{
literal|111.111F
block|,
literal|222.222F
block|,
literal|222.222F
block|,
literal|333.333F
block|,
literal|444.444F
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10020"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"floatRemove"
argument_list|,
operator|new
name|Float
index|[]
block|{
literal|111.111F
block|,
literal|333.333F
block|,
literal|444.444F
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10021"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"floatRemove"
argument_list|,
operator|new
name|Float
index|[]
block|{
literal|111.111F
block|,
literal|222.222F
block|,
literal|444.444F
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:\"222.222\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10001"
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|Float
argument_list|>
name|removeList
init|=
operator|new
name|ArrayList
argument_list|<
name|Float
argument_list|>
argument_list|()
decl_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|222.222F
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|333.333F
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"floatRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:\"222.222\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10021"
argument_list|)
expr_stmt|;
name|removeList
operator|=
operator|new
name|ArrayList
argument_list|<
name|Float
argument_list|>
argument_list|()
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|222.222F
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|333.333F
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"floatRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:\"222.222\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"floatRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
literal|"111.111"
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr directly
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:\"111.111\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRemoveFloatUsingStringType
specifier|public
name|void
name|testRemoveFloatUsingStringType
parameter_list|()
throws|throws
name|Exception
block|{
name|SolrInputDocument
name|doc
decl_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"floatRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111.111"
block|,
literal|"222.222"
block|,
literal|"333.333"
block|,
literal|"333.333"
block|,
literal|"444.444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10002"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"floatRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111.111"
block|,
literal|"222.222"
block|,
literal|"222.222"
block|,
literal|"333.333"
block|,
literal|"444.444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10020"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"floatRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111.111"
block|,
literal|"333.333"
block|,
literal|"444.444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10021"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"floatRemove"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"111.111"
block|,
literal|"222.222"
block|,
literal|"444.444"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:\"222.222\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10001"
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|String
argument_list|>
name|removeList
init|=
operator|new
name|ArrayList
argument_list|<
name|String
argument_list|>
argument_list|()
decl_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"222.222"
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"333.333"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"floatRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:\"222.222\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10021"
argument_list|)
expr_stmt|;
name|removeList
operator|=
operator|new
name|ArrayList
argument_list|<
name|String
argument_list|>
argument_list|()
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"222.222"
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"333.333"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"floatRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:\"222.222\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"10001"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"floatRemove"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
literal|"111.111"
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr directly
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"floatRemove:\"111.111\""
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRemoveregex
specifier|public
name|void
name|testRemoveregex
parameter_list|()
throws|throws
name|Exception
block|{
name|SolrInputDocument
name|doc
decl_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"aaa"
block|,
literal|"bbb"
block|,
literal|"ccc"
block|,
literal|"ccc"
block|,
literal|"ddd"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"2"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"aaa"
block|,
literal|"bbb"
block|,
literal|"bbb"
block|,
literal|"ccc"
block|,
literal|"ddd"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"20"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"aaa"
block|,
literal|"ccc"
block|,
literal|"ddd"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"21"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"aaa"
block|,
literal|"bbb"
block|,
literal|"ddd"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:bbb"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1"
argument_list|)
expr_stmt|;
name|List
argument_list|<
name|String
argument_list|>
name|removeList
init|=
operator|new
name|ArrayList
argument_list|<>
argument_list|()
decl_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|".b."
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"c+c"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"removeregex"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:bbb"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"21"
argument_list|)
expr_stmt|;
name|removeList
operator|=
operator|new
name|ArrayList
argument_list|<>
argument_list|()
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"bb*"
argument_list|)
expr_stmt|;
name|removeList
operator|.
name|add
argument_list|(
literal|"cc+"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"removeregex"
argument_list|,
name|removeList
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr through ZK
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:bbb"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"1"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"removeregex"
argument_list|,
literal|"a.a"
argument_list|)
argument_list|)
expr_stmt|;
comment|//behavior when hitting Solr directly
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '4']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:aaa"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '3']"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAdd
specifier|public
name|void
name|testAdd
parameter_list|()
throws|throws
name|Exception
block|{
name|SolrInputDocument
name|doc
init|=
operator|new
name|SolrInputDocument
argument_list|()
decl_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"3"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"aaa"
block|,
literal|"ccc"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"4"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"aaa"
block|,
literal|"ccc"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:bbb"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '0']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"3"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"add"
argument_list|,
literal|"bbb"
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:bbb"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testSet
specifier|public
name|void
name|testSet
parameter_list|()
throws|throws
name|Exception
block|{
name|SolrInputDocument
name|doc
decl_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"5"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"aaa"
block|,
literal|"ccc"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"6"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"aaa"
block|,
literal|"ccc"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:aaa"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:bbb"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '0']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:ccc"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"5"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|"bbb"
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '2']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:aaa"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:bbb"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:ccc"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
block|}
DECL|method|testAtomicUpdatesOnDateFields
specifier|public
name|void
name|testAtomicUpdatesOnDateFields
parameter_list|()
throws|throws
name|Exception
block|{
name|String
index|[]
name|dateFieldNames
init|=
block|{
literal|"simple_tdt1"
block|,
literal|"simple_tdts"
block|,
literal|"simple_tdtdv1"
block|,
literal|"simple_tdtdvs"
block|}
decl_stmt|;
name|SolrInputDocument
name|doc
init|=
operator|new
name|SolrInputDocument
argument_list|()
decl_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"6"
argument_list|)
expr_stmt|;
comment|// Even adding a single value here for the multiValue field causes the update later on to fail
name|doc
operator|.
name|setField
argument_list|(
literal|"simple_tdt1"
argument_list|,
literal|"1986-01-01T00:00:00Z"
argument_list|)
expr_stmt|;
comment|// single-valued
name|doc
operator|.
name|setField
argument_list|(
literal|"simple_tdts"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"1986-01-01T00:00:00Z"
block|}
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"simple_tdtdv"
argument_list|,
literal|"1986-01-01T00:00:00Z"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"simple_tdtdvs"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"1986-01-01T00:00:00Z"
block|}
argument_list|)
expr_stmt|;
comment|// An independent field that we want to update later on
name|doc
operator|.
name|setField
argument_list|(
literal|"other_i"
argument_list|,
literal|"42"
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"id:6"
argument_list|)
argument_list|,
literal|"boolean(//result/doc/date[@name='simple_tdt1'])"
argument_list|)
expr_stmt|;
for|for
control|(
name|String
name|dateFieldName
range|:
name|dateFieldNames
control|)
block|{
comment|// none (this can fail with Invalid Date String exception)
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"6"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"other_i"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|"43"
argument_list|)
argument_list|)
expr_stmt|;
comment|// set the independent field to another value
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|dateFieldName
operator|.
name|endsWith
argument_list|(
literal|"s"
argument_list|)
condition|)
block|{
comment|// add
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"6"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"other_i"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|"43"
argument_list|)
argument_list|)
expr_stmt|;
comment|// set the independent field to another value
name|doc
operator|.
name|setField
argument_list|(
name|dateFieldName
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"add"
argument_list|,
literal|"1987-01-01T00:00:00Z"
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
comment|// remove
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"6"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"other_i"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|"43"
argument_list|)
argument_list|)
expr_stmt|;
comment|// set the independent field to another value
name|doc
operator|.
name|setField
argument_list|(
name|dateFieldName
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"remove"
argument_list|,
literal|"1987-01-01T00:00:00Z"
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|// set
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"6"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"other_i"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|"43"
argument_list|)
argument_list|)
expr_stmt|;
comment|// set the independent field to another value
name|doc
operator|.
name|setField
argument_list|(
name|dateFieldName
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|"1987-01-01T00:00:00Z"
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
comment|// unset
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"6"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"other_i"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|"43"
argument_list|)
argument_list|)
expr_stmt|;
comment|// set the independent field to another value
name|doc
operator|.
name|setField
argument_list|(
name|dateFieldName
argument_list|,
name|map
argument_list|(
literal|"set"
argument_list|,
literal|null
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|dateFieldName
operator|.
name|endsWith
argument_list|(
literal|"s"
argument_list|)
condition|)
block|{
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"id:6"
argument_list|)
argument_list|,
literal|"//result/doc[count(arr[@name='"
operator|+
name|dateFieldName
operator|+
literal|"'])=1]"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"id:6"
argument_list|)
argument_list|,
literal|"//result/doc/arr[@name='"
operator|+
name|dateFieldName
operator|+
literal|"'][count(date)=1]"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"id:6"
argument_list|)
argument_list|,
literal|"//result/doc[count(date[@name='"
operator|+
name|dateFieldName
operator|+
literal|"'])=0]"
argument_list|)
expr_stmt|;
block|}
block|}
block|}
annotation|@
name|Test
DECL|method|testAtomicUpdatesOnNonStoredDocValues
specifier|public
name|void
name|testAtomicUpdatesOnNonStoredDocValues
parameter_list|()
throws|throws
name|Exception
block|{
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|2
argument_list|,
literal|"title"
argument_list|,
literal|"title2"
argument_list|,
literal|"single_i_dvo"
argument_list|,
literal|100
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|3
argument_list|,
literal|"title"
argument_list|,
literal|"title3"
argument_list|,
literal|"single_d_dvo"
argument_list|,
literal|3.14
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|4
argument_list|,
literal|"single_s_dvo"
argument_list|,
literal|"abc"
argument_list|,
literal|"single_i_dvo"
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|2
argument_list|,
literal|"title"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|"newtitle2"
argument_list|)
argument_list|,
literal|"single_i_dvo"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"inc"
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|3
argument_list|,
literal|"title"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|"newtitle3"
argument_list|)
argument_list|,
literal|"single_d_dvo"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"inc"
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|4
argument_list|,
literal|"single_i_dvo"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"inc"
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertJQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"id:2"
argument_list|)
argument_list|,
literal|"/response/docs/[0]/id==2"
argument_list|,
literal|"/response/docs/[0]/title/[0]=='newtitle2'"
argument_list|,
literal|"/response/docs/[0]/single_i_dvo==101"
argument_list|)
expr_stmt|;
name|assertJQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"id:3"
argument_list|)
argument_list|,
literal|1e-4
argument_list|,
literal|"/response/docs/[0]/id==3"
argument_list|,
literal|"/response/docs/[0]/title/[0]=='newtitle3'"
argument_list|,
literal|"/response/docs/[0]/single_d_dvo==4.14"
argument_list|)
expr_stmt|;
name|assertJQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"id:4"
argument_list|)
argument_list|,
literal|1e-4
argument_list|,
literal|"/response/docs/[0]/id==4"
argument_list|,
literal|"/response/docs/[0]/single_s_dvo=='abc'"
argument_list|,
literal|"/response/docs/[0]/single_i_dvo==2"
argument_list|)
expr_stmt|;
comment|// test that non stored docvalues was carried forward for a non-docvalue update
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|3
argument_list|,
literal|"title"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|"newertitle3"
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertJQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"id:3"
argument_list|)
argument_list|,
literal|1e-4
argument_list|,
literal|"/response/docs/[0]/id==3"
argument_list|,
literal|"/response/docs/[0]/title/[0]=='newertitle3'"
argument_list|,
literal|"/response/docs/[0]/single_d_dvo==4.14"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAtomicUpdatesOnNonStoredDocValuesMulti
specifier|public
name|void
name|testAtomicUpdatesOnNonStoredDocValuesMulti
parameter_list|()
throws|throws
name|Exception
block|{
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|1
argument_list|,
literal|"title"
argument_list|,
literal|"title1"
argument_list|,
literal|"multi_ii_dvo"
argument_list|,
literal|100
argument_list|,
literal|"multi_ii_dvo"
argument_list|,
name|Integer
operator|.
name|MAX_VALUE
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|1
argument_list|,
literal|"title"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|"newtitle1"
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
comment|// test that non stored multivalued docvalues was carried forward for a non docvalues update
name|assertJQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"id:1"
argument_list|)
argument_list|,
literal|"/response/docs/[0]/id==1"
argument_list|,
literal|"/response/docs/[0]/title/[0]=='newtitle1'"
argument_list|,
literal|"/response/docs/[0]/multi_ii_dvo/[0]==100"
argument_list|,
literal|"/response/docs/[0]/multi_ii_dvo/[1]=="
operator|+
name|Integer
operator|.
name|MAX_VALUE
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAtomicUpdatesOnNonStoredDocValuesCopyField
specifier|public
name|void
name|testAtomicUpdatesOnNonStoredDocValuesCopyField
parameter_list|()
throws|throws
name|Exception
block|{
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|101
argument_list|,
literal|"title"
argument_list|,
literal|"title2"
argument_list|,
literal|"single_i_dvn"
argument_list|,
literal|100
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|102
argument_list|,
literal|"title"
argument_list|,
literal|"title3"
argument_list|,
literal|"single_d_dvn"
argument_list|,
literal|3.14
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|103
argument_list|,
literal|"single_s_dvn"
argument_list|,
literal|"abc"
argument_list|,
literal|"single_i_dvn"
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
comment|// Do each one twice... the first time it will be retrieved from the index, and the second time from the transaction log.
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|101
argument_list|,
literal|"title"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|"newtitle2"
argument_list|)
argument_list|,
literal|"single_i_dvn"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"inc"
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|102
argument_list|,
literal|"title"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|"newtitle3"
argument_list|)
argument_list|,
literal|"single_d_dvn"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"inc"
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|103
argument_list|,
literal|"single_i_dvn"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"inc"
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertJQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"id:101"
argument_list|)
argument_list|,
literal|"/response/docs/[0]/id==101"
argument_list|,
literal|"/response/docs/[0]/title/[0]=='newtitle2'"
argument_list|,
literal|"/response/docs/[0]/single_i_dvn==102"
argument_list|)
expr_stmt|;
name|assertJQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"id:102"
argument_list|)
argument_list|,
literal|1e-4
argument_list|,
literal|"/response/docs/[0]/id==102"
argument_list|,
literal|"/response/docs/[0]/title/[0]=='newtitle3'"
argument_list|,
literal|"/response/docs/[0]/single_d_dvn==5.14"
argument_list|)
expr_stmt|;
name|assertJQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"id:103"
argument_list|)
argument_list|,
literal|"/response/docs/[0]/id==103"
argument_list|,
literal|"/response/docs/[0]/single_s_dvn=='abc'"
argument_list|,
literal|"/response/docs/[0]/single_i_dvn==3"
argument_list|)
expr_stmt|;
comment|// test that non stored docvalues was carried forward for a non-docvalue update
name|assertU
argument_list|(
name|adoc
argument_list|(
name|sdoc
argument_list|(
literal|"id"
argument_list|,
literal|103
argument_list|,
literal|"single_s_dvn"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|"abcupdate"
argument_list|)
argument_list|,
literal|"single_i_dvn"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"set"
argument_list|,
literal|5
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertJQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"id:103"
argument_list|)
argument_list|,
literal|"/response/docs/[0]/id==103"
argument_list|,
literal|"/response/docs/[0]/single_s_dvn=='abcupdate'"
argument_list|,
literal|"/response/docs/[0]/single_i_dvn==5"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testInvalidOperation
specifier|public
name|void
name|testInvalidOperation
parameter_list|()
block|{
name|SolrInputDocument
name|doc
decl_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"7"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
operator|new
name|String
index|[]
block|{
literal|"aaa"
block|,
literal|"ccc"
block|}
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|doc
operator|=
operator|new
name|SolrInputDocument
argument_list|()
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"id"
argument_list|,
literal|"7"
argument_list|)
expr_stmt|;
name|doc
operator|.
name|setField
argument_list|(
literal|"cat"
argument_list|,
name|ImmutableMap
operator|.
name|of
argument_list|(
literal|"whatever"
argument_list|,
literal|"bbb"
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|adoc
argument_list|(
name|doc
argument_list|)
argument_list|)
expr_stmt|;
name|assertU
argument_list|(
name|commit
argument_list|()
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:*"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:aaa"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:bbb"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '0']"
argument_list|)
expr_stmt|;
name|assertQ
argument_list|(
name|req
argument_list|(
literal|"q"
argument_list|,
literal|"cat:ccc"
argument_list|,
literal|"indent"
argument_list|,
literal|"true"
argument_list|)
argument_list|,
literal|"//result[@numFound = '1']"
argument_list|)
expr_stmt|;
block|}
block|}
end_class
end_unit
