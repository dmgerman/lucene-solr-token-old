begin_unit
comment|'# Licensed to the Apache Software Foundation (ASF) under one or more'
nl|'\n'
comment|'# contributor license agreements.  See the NOTICE file distributed with'
nl|'\n'
comment|'# this work for additional information regarding copyright ownership.'
nl|'\n'
comment|'# The ASF licenses this file to You under the Apache License, Version 2.0'
nl|'\n'
comment|'# (the "License"); you may not use this file except in compliance with'
nl|'\n'
comment|'# the License.  You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#     http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'sys'
newline|'\n'
name|'sys'
op|'.'
name|'path'
op|'.'
name|'append'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'__file__'
op|')'
op|')'
newline|'\n'
name|'import'
name|'scriptutil'
newline|'\n'
nl|'\n'
name|'import'
name|'argparse'
newline|'\n'
name|'import'
name|'urllib'
op|'.'
name|'error'
newline|'\n'
name|'import'
name|'urllib'
op|'.'
name|'request'
newline|'\n'
name|'import'
name|'re'
newline|'\n'
name|'import'
name|'shutil'
newline|'\n'
nl|'\n'
DECL|function|create_and_add_index
name|'def'
name|'create_and_add_index'
op|'('
name|'source'
op|','
name|'indextype'
op|','
name|'version'
op|','
name|'temp_dir'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'if'
name|'indextype'
name|'in'
op|'('
string|"'cfs'"
op|','
string|"'nocfs'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'dirname'
op|'='
string|"'index.%s'"
op|'%'
name|'indextype'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'dirname'
op|'='
name|'indextype'
newline|'\n'
dedent|''
name|'filename'
op|'='
op|'{'
nl|'\n'
string|"'cfs'"
op|':'
string|"'index.%s-cfs.zip'"
op|','
nl|'\n'
string|"'nocfs'"
op|':'
string|"'index.%s-nocfs.zip'"
nl|'\n'
op|'}'
op|'['
name|'indextype'
op|']'
op|'%'
name|'version'
newline|'\n'
name|'print'
op|'('
string|"'  creating %s...'"
op|'%'
name|'filename'
op|','
name|'end'
op|'='
string|"''"
op|','
name|'flush'
op|'='
name|'True'
op|')'
newline|'\n'
name|'module'
op|'='
string|"'backward-codecs'"
newline|'\n'
name|'index_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
string|"'lucene'"
op|','
name|'module'
op|','
string|"'src/test/org/apache/lucene/index'"
op|')'
newline|'\n'
name|'test_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'index_dir'
op|','
name|'filename'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'index_dir'
op|','
name|'filename'
op|')'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'uptodate'"
op|')'
newline|'\n'
name|'return'
newline|'\n'
nl|'\n'
dedent|''
name|'test'
op|'='
op|'{'
nl|'\n'
string|"'cfs'"
op|':'
string|"'testCreateCFS'"
op|','
nl|'\n'
string|"'nocfs'"
op|':'
string|"'testCreateNoCFS'"
nl|'\n'
op|'}'
op|'['
name|'indextype'
op|']'
newline|'\n'
name|'ant_args'
op|'='
string|"' '"
op|'.'
name|'join'
op|'('
op|'['
nl|'\n'
string|"'-Dtests.bwcdir=%s'"
op|'%'
name|'temp_dir'
op|','
nl|'\n'
string|"'-Dtests.codec=default'"
op|','
nl|'\n'
string|"'-Dtests.useSecurityManager=false'"
op|','
nl|'\n'
string|"'-Dtestcase=TestBackwardsCompatibility'"
op|','
nl|'\n'
string|"'-Dtestmethod=%s'"
op|'%'
name|'test'
nl|'\n'
op|']'
op|')'
newline|'\n'
name|'base_dir'
op|'='
name|'os'
op|'.'
name|'getcwd'
op|'('
op|')'
newline|'\n'
name|'bc_index_dir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'temp_dir'
op|','
name|'dirname'
op|')'
newline|'\n'
name|'bc_index_file'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'bc_index_dir'
op|','
name|'filename'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'bc_index_file'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'alreadyexists'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'bc_index_dir'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'shutil'
op|'.'
name|'rmtree'
op|'('
name|'bc_index_dir'
op|')'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'chdir'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'source'
op|','
name|'module'
op|')'
op|')'
newline|'\n'
name|'scriptutil'
op|'.'
name|'run'
op|'('
string|"'ant test %s'"
op|'%'
name|'ant_args'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
name|'bc_index_dir'
op|')'
newline|'\n'
name|'scriptutil'
op|'.'
name|'run'
op|'('
string|"'zip %s *'"
op|'%'
name|'filename'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'done'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'print'
op|'('
string|"'  adding %s...'"
op|'%'
name|'filename'
op|','
name|'end'
op|'='
string|"''"
op|','
name|'flush'
op|'='
name|'True'
op|')'
newline|'\n'
name|'scriptutil'
op|'.'
name|'run'
op|'('
string|"'cp %s %s'"
op|'%'
op|'('
name|'bc_index_file'
op|','
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'base_dir'
op|','
name|'index_dir'
op|')'
op|')'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
name|'base_dir'
op|')'
newline|'\n'
name|'output'
op|'='
name|'scriptutil'
op|'.'
name|'run'
op|'('
string|"'svn status %s'"
op|'%'
name|'test_file'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'output'
op|'.'
name|'strip'
op|'('
op|')'
op|':'
newline|'\n'
comment|"# make sure to only add if the file isn't already in svn (we might be regenerating)"
nl|'\n'
indent|'    '
name|'scriptutil'
op|'.'
name|'run'
op|'('
string|"'svn add %s'"
op|'%'
name|'test_file'
op|')'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'chdir'
op|'('
name|'base_dir'
op|')'
newline|'\n'
name|'scriptutil'
op|'.'
name|'run'
op|'('
string|"'rm -rf %s'"
op|'%'
name|'bc_index_dir'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'done'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|update_backcompat_tests
dedent|''
name|'def'
name|'update_backcompat_tests'
op|'('
name|'types'
op|','
name|'version'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'print'
op|'('
string|"'  adding new indexes to backcompat tests...'"
op|','
name|'end'
op|'='
string|"''"
op|','
name|'flush'
op|'='
name|'True'
op|')'
newline|'\n'
name|'module'
op|'='
string|"'lucene/backward-codecs'"
newline|'\n'
name|'filename'
op|'='
string|"'%s/src/test/org/apache/lucene/index/TestBackwardsCompatibility.java'"
op|'%'
name|'module'
newline|'\n'
name|'matcher'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"r'final static String\\[\\] oldNames = {|};'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|find_version
name|'def'
name|'find_version'
op|'('
name|'x'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'x'
op|'='
name|'x'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'end'
op|'='
name|'x'
op|'.'
name|'index'
op|'('
string|'"-"'
op|')'
newline|'\n'
name|'return'
name|'scriptutil'
op|'.'
name|'Version'
op|'.'
name|'parse'
op|'('
name|'x'
op|'['
number|'1'
op|':'
name|'end'
op|']'
op|')'
newline|'\n'
nl|'\n'
DECL|class|Edit
dedent|''
name|'class'
name|'Edit'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|variable|start
indent|'    '
name|'start'
op|'='
name|'None'
newline|'\n'
DECL|member|__call__
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'buffer'
op|','
name|'match'
op|','
name|'line'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'self'
op|'.'
name|'start'
op|':'
newline|'\n'
comment|'# find where we this version should exist'
nl|'\n'
indent|'        '
name|'i'
op|'='
name|'len'
op|'('
name|'buffer'
op|')'
op|'-'
number|'1'
newline|'\n'
name|'v'
op|'='
name|'find_version'
op|'('
name|'buffer'
op|'['
name|'i'
op|']'
op|')'
newline|'\n'
name|'while'
name|'i'
op|'>='
name|'self'
op|'.'
name|'start'
name|'and'
name|'v'
op|'.'
name|'on_or_after'
op|'('
name|'version'
op|')'
op|':'
newline|'\n'
indent|'          '
name|'i'
op|'-='
number|'1'
newline|'\n'
name|'v'
op|'='
name|'find_version'
op|'('
name|'buffer'
op|'['
name|'i'
op|']'
op|')'
newline|'\n'
dedent|''
name|'i'
op|'+='
number|'1'
comment|'# readjust since we skipped past by 1'
newline|'\n'
nl|'\n'
comment|"# unfortunately python doesn't have a range remove from list..."
nl|'\n'
comment|'# here we want to remove any previous references to the version we are adding'
nl|'\n'
name|'while'
name|'i'
op|'<'
name|'len'
op|'('
name|'buffer'
op|')'
name|'and'
name|'version'
op|'.'
name|'on_or_after'
op|'('
name|'find_version'
op|'('
name|'buffer'
op|'['
name|'i'
op|']'
op|')'
op|')'
op|':'
newline|'\n'
indent|'          '
name|'buffer'
op|'.'
name|'pop'
op|'('
name|'i'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'i'
op|'=='
name|'len'
op|'('
name|'buffer'
op|')'
name|'and'
name|'not'
name|'buffer'
op|'['
op|'-'
number|'1'
op|']'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'endswith'
op|'('
string|'","'
op|')'
op|':'
newline|'\n'
comment|'# add comma'
nl|'\n'
indent|'          '
name|'buffer'
op|'['
op|'-'
number|'1'
op|']'
op|'='
name|'buffer'
op|'['
op|'-'
number|'1'
op|']'
op|'.'
name|'rstrip'
op|'('
op|')'
op|'+'
string|'",\\n"'
newline|'\n'
nl|'\n'
dedent|''
name|'last'
op|'='
name|'buffer'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'spaces'
op|'='
string|"' '"
op|'*'
op|'('
name|'len'
op|'('
name|'last'
op|')'
op|'-'
name|'len'
op|'('
name|'last'
op|'.'
name|'lstrip'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'for'
op|'('
name|'j'
op|','
name|'t'
op|')'
name|'in'
name|'enumerate'
op|'('
name|'types'
op|')'
op|':'
newline|'\n'
indent|'          '
name|'newline'
op|'='
name|'spaces'
op|'+'
op|'('
string|'\'"%s-%s"\''
op|'%'
op|'('
name|'version'
op|','
name|'t'
op|')'
op|')'
newline|'\n'
name|'if'
name|'j'
op|'<'
name|'len'
op|'('
name|'types'
op|')'
op|'-'
number|'1'
name|'or'
name|'i'
op|'<'
name|'len'
op|'('
name|'buffer'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'newline'
op|'+='
string|"','"
newline|'\n'
dedent|''
name|'buffer'
op|'.'
name|'insert'
op|'('
name|'i'
op|','
name|'newline'
op|'+'
string|"'\\n'"
op|')'
newline|'\n'
name|'i'
op|'+='
number|'1'
newline|'\n'
nl|'\n'
dedent|''
name|'buffer'
op|'.'
name|'append'
op|'('
name|'line'
op|')'
newline|'\n'
name|'return'
name|'True'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
string|"'oldNames'"
name|'in'
name|'line'
op|':'
newline|'\n'
indent|'        '
name|'self'
op|'.'
name|'start'
op|'='
name|'len'
op|'('
name|'buffer'
op|')'
comment|'# location of first index name'
newline|'\n'
dedent|''
name|'buffer'
op|'.'
name|'append'
op|'('
name|'line'
op|')'
newline|'\n'
name|'return'
name|'False'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'changed'
op|'='
name|'scriptutil'
op|'.'
name|'update_file'
op|'('
name|'filename'
op|','
name|'matcher'
op|','
name|'Edit'
op|'('
op|')'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'done'"
name|'if'
name|'changed'
name|'else'
string|"'uptodate'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|check_backcompat_tests
dedent|''
name|'def'
name|'check_backcompat_tests'
op|'('
op|')'
op|':'
newline|'\n'
indent|'  '
name|'print'
op|'('
string|"'  checking backcompat tests...'"
op|','
name|'end'
op|'='
string|"''"
op|','
name|'flush'
op|'='
name|'True'
op|')'
newline|'\n'
name|'olddir'
op|'='
name|'os'
op|'.'
name|'getcwd'
op|'('
op|')'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
string|"'lucene/backward-codecs'"
op|')'
newline|'\n'
name|'scriptutil'
op|'.'
name|'run'
op|'('
string|"'ant test -Dtestcase=TestBackwardsCompatibility'"
op|')'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
name|'olddir'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'ok'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|download_from_mirror
dedent|''
name|'def'
name|'download_from_mirror'
op|'('
name|'version'
op|','
name|'remotename'
op|','
name|'localname'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'url'
op|'='
string|"'http://apache.cs.utah.edu/lucene/java/%s/%s'"
op|'%'
op|'('
name|'version'
op|','
name|'remotename'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'urllib'
op|'.'
name|'request'
op|'.'
name|'urlretrieve'
op|'('
name|'url'
op|','
name|'localname'
op|')'
newline|'\n'
name|'return'
name|'True'
newline|'\n'
dedent|''
name|'except'
name|'urllib'
op|'.'
name|'error'
op|'.'
name|'URLError'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'e'
op|'.'
name|'code'
op|'=='
number|'404'
op|':'
newline|'\n'
indent|'      '
name|'return'
name|'False'
newline|'\n'
dedent|''
name|'raise'
name|'e'
newline|'\n'
nl|'\n'
DECL|function|download_from_archives
dedent|''
dedent|''
name|'def'
name|'download_from_archives'
op|'('
name|'version'
op|','
name|'remotename'
op|','
name|'localname'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'url'
op|'='
string|"'http://archive.apache.org/dist/lucene/java/%s/%s'"
op|'%'
op|'('
name|'version'
op|','
name|'remotename'
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'urllib'
op|'.'
name|'request'
op|'.'
name|'urlretrieve'
op|'('
name|'url'
op|','
name|'localname'
op|')'
newline|'\n'
name|'return'
name|'True'
newline|'\n'
dedent|''
name|'except'
name|'urllib'
op|'.'
name|'error'
op|'.'
name|'URLError'
name|'as'
name|'e'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'e'
op|'.'
name|'code'
op|'=='
number|'404'
op|':'
newline|'\n'
indent|'      '
name|'return'
name|'False'
newline|'\n'
dedent|''
name|'raise'
name|'e'
newline|'\n'
nl|'\n'
DECL|function|download_release
dedent|''
dedent|''
name|'def'
name|'download_release'
op|'('
name|'version'
op|','
name|'temp_dir'
op|','
name|'force'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'print'
op|'('
string|"'  downloading %s source release...'"
op|'%'
name|'version'
op|','
name|'end'
op|'='
string|"''"
op|','
name|'flush'
op|'='
name|'True'
op|')'
newline|'\n'
name|'source'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'temp_dir'
op|','
string|"'lucene-%s'"
op|'%'
name|'version'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'source'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'force'
op|':'
newline|'\n'
indent|'      '
name|'shutil'
op|'.'
name|'rmtree'
op|'('
name|'source'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'print'
op|'('
string|"'uptodate'"
op|')'
newline|'\n'
name|'return'
name|'source'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'filename'
op|'='
string|"'lucene-%s-src.tgz'"
op|'%'
name|'version'
newline|'\n'
name|'source_tgz'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'temp_dir'
op|','
name|'filename'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'download_from_mirror'
op|'('
name|'version'
op|','
name|'filename'
op|','
name|'source_tgz'
op|')'
name|'and'
name|'not'
name|'download_from_archives'
op|'('
name|'version'
op|','
name|'filename'
op|','
name|'source_tgz'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'Exception'
op|'('
string|"'Could not find version %s in apache mirror or archives'"
op|'%'
name|'version'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'olddir'
op|'='
name|'os'
op|'.'
name|'getcwd'
op|'('
op|')'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
name|'temp_dir'
op|')'
newline|'\n'
name|'scriptutil'
op|'.'
name|'run'
op|'('
string|"'tar -xvzf %s'"
op|'%'
name|'source_tgz'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
name|'olddir'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'done'"
op|')'
newline|'\n'
name|'return'
name|'source'
newline|'\n'
nl|'\n'
DECL|function|read_config
dedent|''
name|'def'
name|'read_config'
op|'('
op|')'
op|':'
newline|'\n'
indent|'  '
name|'parser'
op|'='
name|'argparse'
op|'.'
name|'ArgumentParser'
op|'('
name|'description'
op|'='
string|"'Add backcompat index and test for new version'"
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'add_argument'
op|'('
string|"'--force'"
op|','
name|'action'
op|'='
string|"'store_true'"
op|','
name|'default'
op|'='
name|'False'
op|','
nl|'\n'
name|'help'
op|'='
string|"'Redownload the version and rebuild, even if it already exists'"
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'add_argument'
op|'('
string|"'--no-cleanup'"
op|','
name|'dest'
op|'='
string|"'cleanup'"
op|','
name|'action'
op|'='
string|"'store_false'"
op|','
name|'default'
op|'='
name|'True'
op|','
nl|'\n'
name|'help'
op|'='
string|"'Do not cleanup the built indexes, so that they can be reused '"
op|'+'
nl|'\n'
string|"'for adding to another branch'"
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'add_argument'
op|'('
string|"'--temp-dir'"
op|','
name|'metavar'
op|'='
string|"'DIR'"
op|','
name|'default'
op|'='
string|"'/tmp/lucenebwc'"
op|','
nl|'\n'
name|'help'
op|'='
string|"'Temp directory to build backcompat indexes within'"
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'add_argument'
op|'('
string|"'version'"
op|','
name|'type'
op|'='
name|'scriptutil'
op|'.'
name|'Version'
op|'.'
name|'parse'
op|','
nl|'\n'
name|'help'
op|'='
string|"'Version to add, of the form X.Y.Z'"
op|')'
newline|'\n'
name|'c'
op|'='
name|'parser'
op|'.'
name|'parse_args'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'return'
name|'c'
newline|'\n'
nl|'\n'
DECL|function|main
dedent|''
name|'def'
name|'main'
op|'('
op|')'
op|':'
newline|'\n'
indent|'  '
name|'c'
op|'='
name|'read_config'
op|'('
op|')'
newline|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'c'
op|'.'
name|'temp_dir'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'c'
op|'.'
name|'temp_dir'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'print'
op|'('
string|"'\\nCreating backwards compatibility indexes'"
op|')'
newline|'\n'
name|'source'
op|'='
name|'download_release'
op|'('
name|'c'
op|'.'
name|'version'
op|','
name|'c'
op|'.'
name|'temp_dir'
op|','
name|'c'
op|'.'
name|'force'
op|')'
newline|'\n'
name|'create_and_add_index'
op|'('
name|'source'
op|','
string|"'cfs'"
op|','
name|'c'
op|'.'
name|'version'
op|','
name|'c'
op|'.'
name|'temp_dir'
op|')'
newline|'\n'
name|'create_and_add_index'
op|'('
name|'source'
op|','
string|"'nocfs'"
op|','
name|'c'
op|'.'
name|'version'
op|','
name|'c'
op|'.'
name|'temp_dir'
op|')'
newline|'\n'
nl|'\n'
name|'print'
op|'('
string|"'\\nAdding backwards compatibility tests'"
op|')'
newline|'\n'
name|'update_backcompat_tests'
op|'('
op|'['
string|"'cfs'"
op|','
string|"'nocfs'"
op|']'
op|','
name|'c'
op|'.'
name|'version'
op|')'
newline|'\n'
nl|'\n'
name|'print'
op|'('
string|"'\\nTesting changes'"
op|')'
newline|'\n'
name|'check_backcompat_tests'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'c'
op|'.'
name|'cleanup'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'\\nCleaning up'"
op|')'
newline|'\n'
name|'print'
op|'('
string|"'  deleting %s...'"
op|'%'
name|'c'
op|'.'
name|'temp_dir'
op|','
name|'end'
op|'='
string|"''"
op|','
name|'flush'
op|'='
name|'True'
op|')'
newline|'\n'
name|'shutil'
op|'.'
name|'rmtree'
op|'('
name|'c'
op|'.'
name|'temp_dir'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'done'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'print'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'  '
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'KeyboardInterrupt'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'\\nRecieved Ctrl-C, exiting early'"
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
