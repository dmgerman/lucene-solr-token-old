begin_unit
comment|'# Licensed to the Apache Software Foundation (ASF) under one or more'
nl|'\n'
comment|'# contributor license agreements.  See the NOTICE file distributed with'
nl|'\n'
comment|'# this work for additional information regarding copyright ownership.'
nl|'\n'
comment|'# The ASF licenses this file to You under the Apache License, Version 2.0'
nl|'\n'
comment|'# (the "License"); you may not use this file except in compliance with'
nl|'\n'
comment|'# the License.  You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#     http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'tarfile'
newline|'\n'
name|'import'
name|'threading'
newline|'\n'
name|'import'
name|'subprocess'
newline|'\n'
name|'import'
name|'signal'
newline|'\n'
name|'import'
name|'shutil'
newline|'\n'
name|'import'
name|'hashlib'
newline|'\n'
name|'import'
name|'http'
op|'.'
name|'client'
newline|'\n'
name|'import'
name|'re'
newline|'\n'
name|'import'
name|'urllib'
op|'.'
name|'request'
op|','
name|'urllib'
op|'.'
name|'error'
op|','
name|'urllib'
op|'.'
name|'parse'
newline|'\n'
name|'import'
name|'urllib'
op|'.'
name|'parse'
newline|'\n'
name|'import'
name|'sys'
newline|'\n'
name|'import'
name|'html'
op|'.'
name|'parser'
newline|'\n'
name|'from'
name|'collections'
name|'import'
name|'defaultdict'
newline|'\n'
name|'import'
name|'xml'
op|'.'
name|'etree'
op|'.'
name|'ElementTree'
name|'as'
name|'ET'
newline|'\n'
name|'import'
name|'filecmp'
newline|'\n'
name|'import'
name|'platform'
newline|'\n'
name|'import'
name|'checkJavaDocs'
newline|'\n'
name|'import'
name|'checkJavadocLinks'
newline|'\n'
nl|'\n'
comment|'# This tool expects to find /lucene and /solr off the base URL.  You'
nl|'\n'
comment|'# must have a working gpg, tar, unzip in your path.  This has been'
nl|'\n'
comment|'# tested on Linux and on Cygwin under Windows 7.'
nl|'\n'
nl|'\n'
DECL|function|unshortenURL
name|'def'
name|'unshortenURL'
op|'('
name|'url'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'parsed'
op|'='
name|'urllib'
op|'.'
name|'parse'
op|'.'
name|'urlparse'
op|'('
name|'url'
op|')'
newline|'\n'
name|'if'
name|'parsed'
op|'['
number|'0'
op|']'
name|'in'
op|'('
string|"'http'"
op|','
string|"'https'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'h'
op|'='
name|'http'
op|'.'
name|'client'
op|'.'
name|'HTTPConnection'
op|'('
name|'parsed'
op|'.'
name|'netloc'
op|')'
newline|'\n'
name|'h'
op|'.'
name|'request'
op|'('
string|"'HEAD'"
op|','
name|'parsed'
op|'.'
name|'path'
op|')'
newline|'\n'
name|'response'
op|'='
name|'h'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'if'
name|'response'
op|'.'
name|'status'
op|'/'
number|'100'
op|'=='
number|'3'
name|'and'
name|'response'
op|'.'
name|'getheader'
op|'('
string|"'Location'"
op|')'
op|':'
newline|'\n'
indent|'      '
name|'return'
name|'response'
op|'.'
name|'getheader'
op|'('
string|"'Location'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'url'
newline|'\n'
nl|'\n'
DECL|function|javaExe
dedent|''
name|'def'
name|'javaExe'
op|'('
name|'version'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'if'
name|'version'
op|'=='
string|"'1.6'"
op|':'
newline|'\n'
indent|'    '
name|'path'
op|'='
name|'JAVA6_HOME'
newline|'\n'
dedent|''
name|'elif'
name|'version'
op|'=='
string|"'1.7'"
op|':'
newline|'\n'
indent|'    '
name|'path'
op|'='
name|'JAVA7_HOME'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|'"unknown Java version \'%s\'"'
op|'%'
name|'version'
op|')'
newline|'\n'
dedent|''
name|'return'
string|'\'export JAVA_HOME="%s" PATH="%s/bin:$PATH"\''
op|'%'
op|'('
name|'path'
op|','
name|'path'
op|')'
newline|'\n'
nl|'\n'
DECL|function|verifyJavaVersion
dedent|''
name|'def'
name|'verifyJavaVersion'
op|'('
name|'version'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'s'
op|'='
name|'os'
op|'.'
name|'popen'
op|'('
string|"'%s; java -version 2>&1'"
op|'%'
name|'javaExe'
op|'('
name|'version'
op|')'
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'if'
name|'s'
op|'.'
name|'find'
op|'('
string|'\' version "%s.\''
op|'%'
name|'version'
op|')'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'got wrong version for java %s:\\n%s'"
op|'%'
op|'('
name|'version'
op|','
name|'s'
op|')'
op|')'
newline|'\n'
nl|'\n'
comment|'# http://s.apache.org/lusolr32rc2'
nl|'\n'
DECL|variable|env
dedent|''
dedent|''
name|'env'
op|'='
name|'os'
op|'.'
name|'environ'
newline|'\n'
name|'try'
op|':'
newline|'\n'
DECL|variable|JAVA6_HOME
indent|'  '
name|'JAVA6_HOME'
op|'='
name|'env'
op|'['
string|"'JAVA6_HOME'"
op|']'
newline|'\n'
dedent|''
name|'except'
name|'KeyError'
op|':'
newline|'\n'
DECL|variable|JAVA6_HOME
indent|'  '
name|'JAVA6_HOME'
op|'='
string|"'/usr/local/jdk1.6.0_27'"
newline|'\n'
nl|'\n'
dedent|''
name|'try'
op|':'
newline|'\n'
DECL|variable|JAVA7_HOME
indent|'  '
name|'JAVA7_HOME'
op|'='
name|'env'
op|'['
string|"'JAVA7_HOME'"
op|']'
newline|'\n'
dedent|''
name|'except'
name|'KeyError'
op|':'
newline|'\n'
DECL|variable|JAVA7_HOME
indent|'  '
name|'JAVA7_HOME'
op|'='
string|"'/usr/local/jdk1.7.0_01'"
newline|'\n'
nl|'\n'
dedent|''
name|'verifyJavaVersion'
op|'('
string|"'1.6'"
op|')'
newline|'\n'
name|'verifyJavaVersion'
op|'('
string|"'1.7'"
op|')'
newline|'\n'
nl|'\n'
DECL|variable|cygwin
name|'cygwin'
op|'='
name|'platform'
op|'.'
name|'system'
op|'('
op|')'
op|'.'
name|'lower'
op|'('
op|')'
op|'.'
name|'startswith'
op|'('
string|"'cygwin'"
op|')'
newline|'\n'
DECL|variable|cygwinWindowsRoot
name|'cygwinWindowsRoot'
op|'='
name|'os'
op|'.'
name|'popen'
op|'('
string|"'cygpath -w /'"
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'replace'
op|'('
string|"'\\\\'"
op|','
string|"'/'"
op|')'
name|'if'
name|'cygwin'
name|'else'
string|"''"
newline|'\n'
nl|'\n'
comment|'# TODO'
nl|'\n'
comment|'#   + verify KEYS contains key that signed the release'
nl|'\n'
comment|'#   + make sure changes HTML looks ok'
nl|'\n'
comment|'#   - verify license/notice of all dep jars'
nl|'\n'
comment|'#   - check maven'
nl|'\n'
comment|'#   - check JAR manifest version'
nl|'\n'
comment|'#   - check license/notice exist'
nl|'\n'
comment|'#   - check no "extra" files'
nl|'\n'
comment|'#   - make sure jars exist inside bin release'
nl|'\n'
comment|'#   - run "ant test"'
nl|'\n'
comment|'#   - make sure docs exist'
nl|'\n'
comment|'#   - use java5 for lucene/modules'
nl|'\n'
nl|'\n'
DECL|variable|reHREF
name|'reHREF'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|'\'<a href="(.*?)">(.*?)</a>\''
op|')'
newline|'\n'
nl|'\n'
comment|'# Set to True to avoid re-downloading the packages...'
nl|'\n'
DECL|variable|DEBUG
name|'DEBUG'
op|'='
name|'False'
newline|'\n'
nl|'\n'
DECL|function|getHREFs
name|'def'
name|'getHREFs'
op|'('
name|'urlString'
op|')'
op|':'
newline|'\n'
nl|'\n'
comment|'# Deref any redirects'
nl|'\n'
indent|'  '
name|'while'
name|'True'
op|':'
newline|'\n'
indent|'    '
name|'url'
op|'='
name|'urllib'
op|'.'
name|'parse'
op|'.'
name|'urlparse'
op|'('
name|'urlString'
op|')'
newline|'\n'
name|'h'
op|'='
name|'http'
op|'.'
name|'client'
op|'.'
name|'HTTPConnection'
op|'('
name|'url'
op|'.'
name|'netloc'
op|')'
newline|'\n'
name|'h'
op|'.'
name|'request'
op|'('
string|"'GET'"
op|','
name|'url'
op|'.'
name|'path'
op|')'
newline|'\n'
name|'r'
op|'='
name|'h'
op|'.'
name|'getresponse'
op|'('
op|')'
newline|'\n'
name|'newLoc'
op|'='
name|'r'
op|'.'
name|'getheader'
op|'('
string|"'location'"
op|')'
newline|'\n'
name|'if'
name|'newLoc'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'      '
name|'urlString'
op|'='
name|'newLoc'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'break'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'links'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'subUrl'
op|','
name|'text'
name|'in'
name|'reHREF'
op|'.'
name|'findall'
op|'('
name|'urllib'
op|'.'
name|'request'
op|'.'
name|'urlopen'
op|'('
name|'urlString'
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|'.'
name|'decode'
op|'('
string|"'UTF-8'"
op|')'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'fullURL'
op|'='
name|'urllib'
op|'.'
name|'parse'
op|'.'
name|'urljoin'
op|'('
name|'urlString'
op|','
name|'subUrl'
op|')'
newline|'\n'
name|'links'
op|'.'
name|'append'
op|'('
op|'('
name|'text'
op|','
name|'fullURL'
op|')'
op|')'
newline|'\n'
dedent|''
name|'return'
name|'links'
newline|'\n'
nl|'\n'
DECL|function|download
dedent|''
name|'def'
name|'download'
op|'('
name|'name'
op|','
name|'urlString'
op|','
name|'tmpDir'
op|','
name|'quiet'
op|'='
name|'False'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'fileName'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'name'
op|')'
newline|'\n'
name|'if'
name|'DEBUG'
name|'and'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'fileName'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'not'
name|'quiet'
name|'and'
name|'fileName'
op|'.'
name|'find'
op|'('
string|"'.asc'"
op|')'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'      '
name|'print'
op|'('
string|"'    already done: %.1f MB'"
op|'%'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'getsize'
op|'('
name|'fileName'
op|')'
op|'/'
number|'1024.'
op|'/'
number|'1024.'
op|')'
op|')'
newline|'\n'
dedent|''
name|'return'
newline|'\n'
dedent|''
name|'fIn'
op|'='
name|'urllib'
op|'.'
name|'request'
op|'.'
name|'urlopen'
op|'('
name|'urlString'
op|')'
newline|'\n'
name|'fOut'
op|'='
name|'open'
op|'('
name|'fileName'
op|','
string|"'wb'"
op|')'
newline|'\n'
name|'success'
op|'='
name|'False'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'while'
name|'True'
op|':'
newline|'\n'
indent|'      '
name|'s'
op|'='
name|'fIn'
op|'.'
name|'read'
op|'('
number|'65536'
op|')'
newline|'\n'
name|'if'
name|'s'
op|'=='
string|"b''"
op|':'
newline|'\n'
indent|'        '
name|'break'
newline|'\n'
dedent|''
name|'fOut'
op|'.'
name|'write'
op|'('
name|'s'
op|')'
newline|'\n'
dedent|''
name|'fOut'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'fIn'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'success'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'    '
name|'fIn'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'fOut'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'if'
name|'not'
name|'success'
op|':'
newline|'\n'
indent|'      '
name|'os'
op|'.'
name|'remove'
op|'('
name|'fileName'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'not'
name|'quiet'
name|'and'
name|'fileName'
op|'.'
name|'find'
op|'('
string|"'.asc'"
op|')'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'    %.1f MB'"
op|'%'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'getsize'
op|'('
name|'fileName'
op|')'
op|'/'
number|'1024.'
op|'/'
number|'1024.'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|load
dedent|''
dedent|''
name|'def'
name|'load'
op|'('
name|'urlString'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'return'
name|'urllib'
op|'.'
name|'request'
op|'.'
name|'urlopen'
op|'('
name|'urlString'
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|'.'
name|'decode'
op|'('
string|"'utf-8'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|checkSigs
dedent|''
name|'def'
name|'checkSigs'
op|'('
name|'project'
op|','
name|'urlString'
op|','
name|'version'
op|','
name|'tmpDir'
op|','
name|'isSigned'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'  '
name|'print'
op|'('
string|"'  test basics...'"
op|')'
newline|'\n'
name|'ents'
op|'='
name|'getDirEntries'
op|'('
name|'urlString'
op|')'
newline|'\n'
name|'artifact'
op|'='
name|'None'
newline|'\n'
name|'keysURL'
op|'='
name|'None'
newline|'\n'
name|'changesURL'
op|'='
name|'None'
newline|'\n'
name|'mavenURL'
op|'='
name|'None'
newline|'\n'
name|'expectedSigs'
op|'='
op|'['
op|']'
newline|'\n'
name|'if'
name|'isSigned'
op|':'
newline|'\n'
indent|'    '
name|'expectedSigs'
op|'.'
name|'append'
op|'('
string|"'asc'"
op|')'
newline|'\n'
dedent|''
name|'expectedSigs'
op|'.'
name|'extend'
op|'('
op|'['
string|"'md5'"
op|','
string|"'sha1'"
op|']'
op|')'
newline|'\n'
nl|'\n'
name|'artifacts'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'text'
op|','
name|'subURL'
name|'in'
name|'ents'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'text'
op|'=='
string|"'KEYS'"
op|':'
newline|'\n'
indent|'      '
name|'keysURL'
op|'='
name|'subURL'
newline|'\n'
dedent|''
name|'elif'
name|'text'
op|'=='
string|"'maven/'"
op|':'
newline|'\n'
indent|'      '
name|'mavenURL'
op|'='
name|'subURL'
newline|'\n'
dedent|''
name|'elif'
name|'text'
op|'.'
name|'startswith'
op|'('
string|"'changes'"
op|')'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'text'
name|'not'
name|'in'
op|'('
string|"'changes/'"
op|','
string|"'changes-%s/'"
op|'%'
name|'version'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|"'%s: found %s vs expected changes-%s/'"
op|'%'
op|'('
name|'project'
op|','
name|'text'
op|','
name|'version'
op|')'
op|')'
newline|'\n'
dedent|''
name|'changesURL'
op|'='
name|'subURL'
newline|'\n'
dedent|''
name|'elif'
name|'artifact'
op|'=='
name|'None'
op|':'
newline|'\n'
indent|'      '
name|'artifact'
op|'='
name|'text'
newline|'\n'
name|'artifactURL'
op|'='
name|'subURL'
newline|'\n'
name|'if'
name|'project'
op|'=='
string|"'solr'"
op|':'
newline|'\n'
indent|'        '
name|'expected'
op|'='
string|"'apache-solr-%s'"
op|'%'
name|'version'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'expected'
op|'='
string|"'lucene-%s'"
op|'%'
name|'version'
newline|'\n'
dedent|''
name|'if'
name|'not'
name|'artifact'
op|'.'
name|'startswith'
op|'('
name|'expected'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|"'%s: unknown artifact %s: expected prefix %s'"
op|'%'
op|'('
name|'project'
op|','
name|'text'
op|','
name|'expected'
op|')'
op|')'
newline|'\n'
dedent|''
name|'sigs'
op|'='
op|'['
op|']'
newline|'\n'
dedent|''
name|'elif'
name|'text'
op|'.'
name|'startswith'
op|'('
name|'artifact'
op|'+'
string|"'.'"
op|')'
op|':'
newline|'\n'
indent|'      '
name|'sigs'
op|'.'
name|'append'
op|'('
name|'text'
op|'['
name|'len'
op|'('
name|'artifact'
op|')'
op|'+'
number|'1'
op|':'
op|']'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'sigs'
op|'!='
name|'expectedSigs'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|"'%s: artifact %s has wrong sigs: expected %s but got %s'"
op|'%'
op|'('
name|'project'
op|','
name|'artifact'
op|','
name|'expectedSigs'
op|','
name|'sigs'
op|')'
op|')'
newline|'\n'
dedent|''
name|'artifacts'
op|'.'
name|'append'
op|'('
op|'('
name|'artifact'
op|','
name|'artifactURL'
op|')'
op|')'
newline|'\n'
name|'artifact'
op|'='
name|'text'
newline|'\n'
name|'artifactURL'
op|'='
name|'subURL'
newline|'\n'
name|'sigs'
op|'='
op|'['
op|']'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'sigs'
op|'!='
op|'['
op|']'
op|':'
newline|'\n'
indent|'    '
name|'artifacts'
op|'.'
name|'append'
op|'('
op|'('
name|'artifact'
op|','
name|'artifactURL'
op|')'
op|')'
newline|'\n'
name|'if'
name|'sigs'
op|'!='
name|'expectedSigs'
op|':'
newline|'\n'
indent|'      '
name|'raise'
name|'RuntimeError'
op|'('
string|"'%s: artifact %s has wrong sigs: expected %s but got %s'"
op|'%'
op|'('
name|'project'
op|','
name|'artifact'
op|','
name|'expectedSigs'
op|','
name|'sigs'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'project'
op|'=='
string|"'lucene'"
op|':'
newline|'\n'
indent|'    '
name|'expected'
op|'='
op|'['
string|"'lucene-%s-src.tgz'"
op|'%'
name|'version'
op|','
nl|'\n'
string|"'lucene-%s.tgz'"
op|'%'
name|'version'
op|','
nl|'\n'
string|"'lucene-%s.zip'"
op|'%'
name|'version'
op|']'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'expected'
op|'='
op|'['
string|"'apache-solr-%s-src.tgz'"
op|'%'
name|'version'
op|','
nl|'\n'
string|"'apache-solr-%s.tgz'"
op|'%'
name|'version'
op|','
nl|'\n'
string|"'apache-solr-%s.zip'"
op|'%'
name|'version'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'actual'
op|'='
op|'['
name|'x'
op|'['
number|'0'
op|']'
name|'for'
name|'x'
name|'in'
name|'artifacts'
op|']'
newline|'\n'
name|'if'
name|'expected'
op|'!='
name|'actual'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'%s: wrong artifacts: expected %s but got %s'"
op|'%'
op|'('
name|'project'
op|','
name|'expected'
op|','
name|'actual'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'keysURL'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'%s is missing KEYS'"
op|'%'
name|'project'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'print'
op|'('
string|"'  get KEYS'"
op|')'
newline|'\n'
name|'download'
op|'('
string|"'%s.KEYS'"
op|'%'
name|'project'
op|','
name|'keysURL'
op|','
name|'tmpDir'
op|')'
newline|'\n'
nl|'\n'
name|'keysFile'
op|'='
string|"'%s/%s.KEYS'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|')'
newline|'\n'
nl|'\n'
comment|'# Set up clean gpg world; import keys file:'
nl|'\n'
name|'gpgHomeDir'
op|'='
string|"'%s/%s.gpg'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'gpgHomeDir'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'shutil'
op|'.'
name|'rmtree'
op|'('
name|'gpgHomeDir'
op|')'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'gpgHomeDir'
op|','
number|'0o700'
op|')'
newline|'\n'
name|'run'
op|'('
string|"'gpg --homedir %s --import %s'"
op|'%'
op|'('
name|'gpgHomeDir'
op|','
name|'keysFile'
op|')'
op|','
nl|'\n'
string|"'%s/%s.gpg.import.log 2>&1'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'mavenURL'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'%s is missing maven'"
op|'%'
name|'project'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'project'
op|'=='
string|"'lucene'"
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'changesURL'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'      '
name|'raise'
name|'RuntimeError'
op|'('
string|"'%s is missing changes-%s'"
op|'%'
op|'('
name|'project'
op|','
name|'version'
op|')'
op|')'
newline|'\n'
dedent|''
name|'testChanges'
op|'('
name|'project'
op|','
name|'version'
op|','
name|'changesURL'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'artifact'
op|','
name|'urlString'
name|'in'
name|'artifacts'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'  download %s...'"
op|'%'
name|'artifact'
op|')'
newline|'\n'
name|'download'
op|'('
name|'artifact'
op|','
name|'urlString'
op|','
name|'tmpDir'
op|')'
newline|'\n'
name|'verifyDigests'
op|'('
name|'artifact'
op|','
name|'urlString'
op|','
name|'tmpDir'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'isSigned'
op|':'
newline|'\n'
indent|'      '
name|'print'
op|'('
string|"'    verify sig'"
op|')'
newline|'\n'
comment|'# Test sig (this is done with a clean brand-new GPG world)'
nl|'\n'
name|'download'
op|'('
name|'artifact'
op|'+'
string|"'.asc'"
op|','
name|'urlString'
op|'+'
string|"'.asc'"
op|','
name|'tmpDir'
op|')'
newline|'\n'
name|'sigFile'
op|'='
string|"'%s/%s.asc'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'artifact'
op|')'
newline|'\n'
name|'artifactFile'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'artifact'
op|')'
newline|'\n'
name|'logFile'
op|'='
string|"'%s/%s.%s.gpg.verify.log'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|','
name|'artifact'
op|')'
newline|'\n'
name|'run'
op|'('
string|"'gpg --homedir %s --verify %s %s'"
op|'%'
op|'('
name|'gpgHomeDir'
op|','
name|'sigFile'
op|','
name|'artifactFile'
op|')'
op|','
nl|'\n'
name|'logFile'
op|')'
newline|'\n'
comment|'# Forward any GPG warnings, except the expected one (since its a clean world)'
nl|'\n'
name|'f'
op|'='
name|'open'
op|'('
name|'logFile'
op|','
name|'encoding'
op|'='
string|"'UTF-8'"
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'f'
op|'.'
name|'readlines'
op|'('
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'line'
op|'.'
name|'lower'
op|'('
op|')'
op|'.'
name|'find'
op|'('
string|"'warning'"
op|')'
op|'!='
op|'-'
number|'1'
name|'and'
name|'line'
op|'.'
name|'find'
op|'('
string|"'WARNING: This key is not certified with a trusted signature'"
op|')'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'          '
name|'print'
op|'('
string|"'      GPG: %s'"
op|'%'
name|'line'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# Test trust (this is done with the real users config)'
nl|'\n'
name|'run'
op|'('
string|"'gpg --import %s'"
op|'%'
op|'('
name|'keysFile'
op|')'
op|','
nl|'\n'
string|"'%s/%s.gpg.trust.import.log 2>&1'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|')'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'    verify trust'"
op|')'
newline|'\n'
name|'logFile'
op|'='
string|"'%s/%s.%s.gpg.trust.log'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|','
name|'artifact'
op|')'
newline|'\n'
name|'run'
op|'('
string|"'gpg --verify %s %s'"
op|'%'
op|'('
name|'sigFile'
op|','
name|'artifactFile'
op|')'
op|','
name|'logFile'
op|')'
newline|'\n'
comment|'# Forward any GPG warnings:'
nl|'\n'
name|'f'
op|'='
name|'open'
op|'('
name|'logFile'
op|','
name|'encoding'
op|'='
string|"'UTF-8'"
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'f'
op|'.'
name|'readlines'
op|'('
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'line'
op|'.'
name|'lower'
op|'('
op|')'
op|'.'
name|'find'
op|'('
string|"'warning'"
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'          '
name|'print'
op|'('
string|"'      GPG: %s'"
op|'%'
name|'line'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|testChanges
dedent|''
dedent|''
dedent|''
name|'def'
name|'testChanges'
op|'('
name|'project'
op|','
name|'version'
op|','
name|'changesURLString'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'print'
op|'('
string|"'  check changes HTML...'"
op|')'
newline|'\n'
name|'changesURL'
op|'='
name|'None'
newline|'\n'
name|'for'
name|'text'
op|','
name|'subURL'
name|'in'
name|'getDirEntries'
op|'('
name|'changesURLString'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'text'
op|'=='
string|"'Changes.html'"
op|':'
newline|'\n'
indent|'      '
name|'changesURL'
op|'='
name|'subURL'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'changesURL'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'did not see Changes.html link from %s'"
op|'%'
name|'changesURLString'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'s'
op|'='
name|'load'
op|'('
name|'changesURL'
op|')'
newline|'\n'
name|'checkChangesContent'
op|'('
name|'s'
op|','
name|'version'
op|','
name|'changesURL'
op|','
name|'project'
op|','
name|'True'
op|')'
newline|'\n'
nl|'\n'
DECL|function|testChangesText
dedent|''
name|'def'
name|'testChangesText'
op|'('
name|'dir'
op|','
name|'version'
op|','
name|'project'
op|')'
op|':'
newline|'\n'
indent|'  '
string|'"Checks all CHANGES.txt under this dir."'
newline|'\n'
name|'for'
name|'root'
op|','
name|'dirs'
op|','
name|'files'
name|'in'
name|'os'
op|'.'
name|'walk'
op|'('
name|'dir'
op|')'
op|':'
newline|'\n'
nl|'\n'
comment|'# NOTE: O(N) but N should be smallish:'
nl|'\n'
indent|'    '
name|'if'
string|"'CHANGES.txt'"
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'      '
name|'fullPath'
op|'='
string|"'%s/CHANGES.txt'"
op|'%'
name|'root'
newline|'\n'
comment|"#print 'CHECK %s' % fullPath"
nl|'\n'
name|'checkChangesContent'
op|'('
name|'open'
op|'('
name|'fullPath'
op|','
name|'encoding'
op|'='
string|"'UTF-8'"
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|','
name|'version'
op|','
name|'fullPath'
op|','
name|'project'
op|','
name|'False'
op|')'
newline|'\n'
nl|'\n'
DECL|function|checkChangesContent
dedent|''
dedent|''
dedent|''
name|'def'
name|'checkChangesContent'
op|'('
name|'s'
op|','
name|'version'
op|','
name|'name'
op|','
name|'project'
op|','
name|'isHTML'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'  '
name|'if'
name|'isHTML'
name|'and'
name|'s'
op|'.'
name|'find'
op|'('
string|"'Release %s'"
op|'%'
name|'version'
op|')'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|'\'did not see "Release %s" in %s\''
op|'%'
op|'('
name|'version'
op|','
name|'name'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'s'
op|'.'
name|'lower'
op|'('
op|')'
op|'.'
name|'find'
op|'('
string|"'not yet released'"
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|'\'saw "not yet released" in %s\''
op|'%'
name|'name'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'not'
name|'isHTML'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'project'
op|'=='
string|"'lucene'"
op|':'
newline|'\n'
indent|'      '
name|'sub'
op|'='
string|"'Lucene %s'"
op|'%'
name|'version'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'sub'
op|'='
name|'version'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'s'
op|'.'
name|'find'
op|'('
name|'sub'
op|')'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
comment|'# benchmark never seems to include release info:'
nl|'\n'
indent|'      '
name|'if'
name|'name'
op|'.'
name|'find'
op|'('
string|"'/benchmark/'"
op|')'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|'\'did not see "%s" in %s\''
op|'%'
op|'('
name|'sub'
op|','
name|'name'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
dedent|''
name|'reUnixPath'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|'r\'\\b[a-zA-Z_]+=(?:"(?:\\\\"|[^"])*"\''
op|'+'
string|'\'|(?:\\\\\\\\.|[^"\\\'\\\\s])*\''
op|'+'
string|'r"|\'(?:\\\\\'|[^\'])*\')"'
op|'+'
string|'r\'|(/(?:\\\\.|[^"\\\'\\s])*)\''
op|'+'
string|'r\'|("/(?:\\\\.|[^"])*")\''
DECL|variable|reUnixPath
op|'+'
string|'r"|(\'/(?:\\\\.|[^\'])*\')"'
op|')'
newline|'\n'
nl|'\n'
DECL|function|unix2win
name|'def'
name|'unix2win'
op|'('
name|'matchobj'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'if'
name|'matchobj'
op|'.'
name|'group'
op|'('
number|'1'
op|')'
name|'is'
name|'not'
name|'None'
op|':'
name|'return'
name|'cygwinWindowsRoot'
op|'+'
name|'matchobj'
op|'.'
name|'group'
op|'('
op|')'
newline|'\n'
name|'if'
name|'matchobj'
op|'.'
name|'group'
op|'('
number|'2'
op|')'
name|'is'
name|'not'
name|'None'
op|':'
name|'return'
string|'\'"%s%s\''
op|'%'
op|'('
name|'cygwinWindowsRoot'
op|','
name|'matchobj'
op|'.'
name|'group'
op|'('
op|')'
op|'.'
name|'lstrip'
op|'('
string|'\'"\''
op|')'
op|')'
newline|'\n'
name|'if'
name|'matchobj'
op|'.'
name|'group'
op|'('
number|'3'
op|')'
name|'is'
name|'not'
name|'None'
op|':'
name|'return'
string|'"\'%s%s"'
op|'%'
op|'('
name|'cygwinWindowsRoot'
op|','
name|'matchobj'
op|'.'
name|'group'
op|'('
op|')'
op|'.'
name|'lstrip'
op|'('
string|'"\'"'
op|')'
op|')'
newline|'\n'
name|'return'
name|'matchobj'
op|'.'
name|'group'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|cygwinifyPaths
dedent|''
name|'def'
name|'cygwinifyPaths'
op|'('
name|'command'
op|')'
op|':'
newline|'\n'
comment|'# The problem: Native Windows applications running under Cygwin'
nl|'\n'
comment|"# (e.g. Ant, which isn't available as a Cygwin package) can't"
nl|'\n'
comment|"# handle Cygwin's Unix-style paths.  However, environment variable"
nl|'\n'
comment|'# values are automatically converted, so only paths outside of'
nl|'\n'
comment|'# environment variable values should be converted to Windows paths.'
nl|'\n'
comment|'# Assumption: all paths will be absolute.'
nl|'\n'
indent|'  '
name|'if'
string|"'; ant '"
name|'in'
name|'command'
op|':'
name|'command'
op|'='
name|'reUnixPath'
op|'.'
name|'sub'
op|'('
name|'unix2win'
op|','
name|'command'
op|')'
newline|'\n'
name|'return'
name|'command'
newline|'\n'
nl|'\n'
DECL|function|run
dedent|''
name|'def'
name|'run'
op|'('
name|'command'
op|','
name|'logFile'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'if'
name|'cygwin'
op|':'
name|'command'
op|'='
name|'cygwinifyPaths'
op|'('
name|'command'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'system'
op|'('
string|"'%s > %s 2>&1'"
op|'%'
op|'('
name|'command'
op|','
name|'logFile'
op|')'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'logPath'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'abspath'
op|'('
name|'logFile'
op|')'
newline|'\n'
name|'raise'
name|'RuntimeError'
op|'('
string|'\'command "%s" failed; see log file %s\''
op|'%'
op|'('
name|'command'
op|','
name|'logPath'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|verifyDigests
dedent|''
dedent|''
name|'def'
name|'verifyDigests'
op|'('
name|'artifact'
op|','
name|'urlString'
op|','
name|'tmpDir'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'print'
op|'('
string|"'    verify md5/sha1 digests'"
op|')'
newline|'\n'
name|'md5Expected'
op|','
name|'t'
op|'='
name|'load'
op|'('
name|'urlString'
op|'+'
string|"'.md5'"
op|')'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'if'
name|'t'
op|'!='
string|"'*'"
op|'+'
name|'artifact'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'MD5 %s.md5 lists artifact %s but expected *%s'"
op|'%'
op|'('
name|'urlString'
op|','
name|'t'
op|','
name|'artifact'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'sha1Expected'
op|','
name|'t'
op|'='
name|'load'
op|'('
name|'urlString'
op|'+'
string|"'.sha1'"
op|')'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'split'
op|'('
op|')'
newline|'\n'
name|'if'
name|'t'
op|'!='
string|"'*'"
op|'+'
name|'artifact'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'SHA1 %s.sha1 lists artifact %s but expected *%s'"
op|'%'
op|'('
name|'urlString'
op|','
name|'t'
op|','
name|'artifact'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'m'
op|'='
name|'hashlib'
op|'.'
name|'md5'
op|'('
op|')'
newline|'\n'
name|'s'
op|'='
name|'hashlib'
op|'.'
name|'sha1'
op|'('
op|')'
newline|'\n'
name|'f'
op|'='
name|'open'
op|'('
string|"'%s/%s'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'artifact'
op|')'
op|','
string|"'rb'"
op|')'
newline|'\n'
name|'while'
name|'True'
op|':'
newline|'\n'
indent|'    '
name|'x'
op|'='
name|'f'
op|'.'
name|'read'
op|'('
number|'65536'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'x'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'      '
name|'break'
newline|'\n'
dedent|''
name|'m'
op|'.'
name|'update'
op|'('
name|'x'
op|')'
newline|'\n'
name|'s'
op|'.'
name|'update'
op|'('
name|'x'
op|')'
newline|'\n'
dedent|''
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'md5Actual'
op|'='
name|'m'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
name|'sha1Actual'
op|'='
name|'s'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
name|'if'
name|'md5Actual'
op|'!='
name|'md5Expected'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'MD5 digest mismatch for %s: expected %s but got %s'"
op|'%'
op|'('
name|'artifact'
op|','
name|'md5Expected'
op|','
name|'md5Actual'
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'sha1Actual'
op|'!='
name|'sha1Expected'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'SHA1 digest mismatch for %s: expected %s but got %s'"
op|'%'
op|'('
name|'artifact'
op|','
name|'sha1Expected'
op|','
name|'sha1Actual'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|getDirEntries
dedent|''
dedent|''
name|'def'
name|'getDirEntries'
op|'('
name|'urlString'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'if'
name|'urlString'
op|'.'
name|'startswith'
op|'('
string|"'file:/'"
op|')'
name|'and'
name|'not'
name|'urlString'
op|'.'
name|'startswith'
op|'('
string|"'file://'"
op|')'
op|':'
newline|'\n'
comment|'# stupid bogus ant URI'
nl|'\n'
indent|'    '
name|'urlString'
op|'='
string|'"file:///"'
op|'+'
name|'urlString'
op|'['
number|'6'
op|':'
op|']'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'urlString'
op|'.'
name|'startswith'
op|'('
string|"'file://'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'path'
op|'='
name|'urlString'
op|'['
number|'7'
op|':'
op|']'
newline|'\n'
name|'if'
name|'path'
op|'.'
name|'endswith'
op|'('
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'      '
name|'path'
op|'='
name|'path'
op|'['
op|':'
op|'-'
number|'1'
op|']'
newline|'\n'
dedent|''
name|'l'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'ent'
name|'in'
name|'os'
op|'.'
name|'listdir'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'entPath'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'path'
op|','
name|'ent'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'entPath'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'entPath'
op|'+='
string|"'/'"
newline|'\n'
name|'ent'
op|'+='
string|"'/'"
newline|'\n'
dedent|''
name|'l'
op|'.'
name|'append'
op|'('
op|'('
name|'ent'
op|','
string|"'file://%s'"
op|'%'
name|'entPath'
op|')'
op|')'
newline|'\n'
dedent|''
name|'l'
op|'.'
name|'sort'
op|'('
op|')'
newline|'\n'
name|'return'
name|'l'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'links'
op|'='
name|'getHREFs'
op|'('
name|'urlString'
op|')'
newline|'\n'
name|'for'
name|'i'
op|','
op|'('
name|'text'
op|','
name|'subURL'
op|')'
name|'in'
name|'enumerate'
op|'('
name|'links'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'text'
op|'=='
string|"'Parent Directory'"
name|'or'
name|'text'
op|'=='
string|"'..'"
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'links'
op|'['
op|'('
name|'i'
op|'+'
number|'1'
op|')'
op|':'
op|']'
newline|'\n'
nl|'\n'
DECL|function|unpack
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'unpack'
op|'('
name|'project'
op|','
name|'tmpDir'
op|','
name|'artifact'
op|','
name|'version'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'destDir'
op|'='
string|"'%s/unpack'"
op|'%'
name|'tmpDir'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'destDir'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'shutil'
op|'.'
name|'rmtree'
op|'('
name|'destDir'
op|')'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'destDir'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
name|'destDir'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'    unpack %s...'"
op|'%'
name|'artifact'
op|')'
newline|'\n'
name|'unpackLogFile'
op|'='
string|"'%s/%s-unpack-%s.log'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|','
name|'artifact'
op|')'
newline|'\n'
name|'if'
name|'artifact'
op|'.'
name|'endswith'
op|'('
string|"'.tar.gz'"
op|')'
name|'or'
name|'artifact'
op|'.'
name|'endswith'
op|'('
string|"'.tgz'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'run'
op|'('
string|"'tar xzf %s/%s'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'artifact'
op|')'
op|','
name|'unpackLogFile'
op|')'
newline|'\n'
dedent|''
name|'elif'
name|'artifact'
op|'.'
name|'endswith'
op|'('
string|"'.zip'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'run'
op|'('
string|"'unzip %s/%s'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'artifact'
op|')'
op|','
name|'unpackLogFile'
op|')'
newline|'\n'
nl|'\n'
comment|'# make sure it unpacks to proper subdir'
nl|'\n'
dedent|''
name|'l'
op|'='
name|'os'
op|'.'
name|'listdir'
op|'('
name|'destDir'
op|')'
newline|'\n'
name|'if'
name|'project'
op|'=='
string|"'solr'"
op|':'
newline|'\n'
indent|'    '
name|'expected'
op|'='
string|"'apache-%s-%s'"
op|'%'
op|'('
name|'project'
op|','
name|'version'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'expected'
op|'='
string|"'%s-%s'"
op|'%'
op|'('
name|'project'
op|','
name|'version'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'l'
op|'!='
op|'['
name|'expected'
op|']'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'unpack produced entries %s; expected only %s'"
op|'%'
op|'('
name|'l'
op|','
name|'expected'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'unpackPath'
op|'='
string|"'%s/%s'"
op|'%'
op|'('
name|'destDir'
op|','
name|'expected'
op|')'
newline|'\n'
name|'verifyUnpacked'
op|'('
name|'project'
op|','
name|'artifact'
op|','
name|'unpackPath'
op|','
name|'version'
op|','
name|'tmpDir'
op|')'
newline|'\n'
nl|'\n'
DECL|function|verifyUnpacked
dedent|''
name|'def'
name|'verifyUnpacked'
op|'('
name|'project'
op|','
name|'artifact'
op|','
name|'unpackPath'
op|','
name|'version'
op|','
name|'tmpDir'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'os'
op|'.'
name|'chdir'
op|'('
name|'unpackPath'
op|')'
newline|'\n'
name|'isSrc'
op|'='
name|'artifact'
op|'.'
name|'find'
op|'('
string|"'-src'"
op|')'
op|'!='
op|'-'
number|'1'
newline|'\n'
name|'l'
op|'='
name|'os'
op|'.'
name|'listdir'
op|'('
name|'unpackPath'
op|')'
newline|'\n'
name|'textFiles'
op|'='
op|'['
string|"'LICENSE'"
op|','
string|"'NOTICE'"
op|','
string|"'README'"
op|']'
newline|'\n'
name|'if'
name|'project'
op|'=='
string|"'lucene'"
op|':'
newline|'\n'
indent|'    '
name|'textFiles'
op|'.'
name|'extend'
op|'('
op|'('
string|"'JRE_VERSION_MIGRATION'"
op|','
string|"'CHANGES'"
op|','
string|"'MIGRATE'"
op|')'
op|')'
newline|'\n'
name|'if'
name|'isSrc'
op|':'
newline|'\n'
indent|'      '
name|'textFiles'
op|'.'
name|'append'
op|'('
string|"'BUILD'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'for'
name|'fileName'
name|'in'
name|'textFiles'
op|':'
newline|'\n'
indent|'    '
name|'fileName'
op|'+='
string|"'.txt'"
newline|'\n'
name|'if'
name|'fileName'
name|'not'
name|'in'
name|'l'
op|':'
newline|'\n'
indent|'      '
name|'raise'
name|'RuntimeError'
op|'('
string|'\'file "%s" is missing from artifact %s\''
op|'%'
op|'('
name|'fileName'
op|','
name|'artifact'
op|')'
op|')'
newline|'\n'
dedent|''
name|'l'
op|'.'
name|'remove'
op|'('
name|'fileName'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'not'
name|'isSrc'
op|':'
newline|'\n'
comment|'# TODO: we should add verifyModule/verifySubmodule (e.g. analysis) here and recurse through'
nl|'\n'
indent|'    '
name|'if'
name|'project'
op|'=='
string|"'lucene'"
op|':'
newline|'\n'
indent|'      '
name|'expectedJARs'
op|'='
op|'('
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'expectedJARs'
op|'='
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'fileName'
name|'in'
name|'expectedJARs'
op|':'
newline|'\n'
indent|'      '
name|'fileName'
op|'+='
string|"'.jar'"
newline|'\n'
name|'if'
name|'fileName'
name|'not'
name|'in'
name|'l'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|'\'%s: file "%s" is missing from artifact %s\''
op|'%'
op|'('
name|'project'
op|','
name|'fileName'
op|','
name|'artifact'
op|')'
op|')'
newline|'\n'
dedent|''
name|'l'
op|'.'
name|'remove'
op|'('
name|'fileName'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'project'
op|'=='
string|"'lucene'"
op|':'
newline|'\n'
comment|'# TODO: clean this up to not be a list of modules that we must maintain'
nl|'\n'
indent|'    '
name|'extras'
op|'='
op|'('
string|"'analysis'"
op|','
string|"'benchmark'"
op|','
string|"'classification'"
string|"'codecs'"
op|','
string|"'core'"
op|','
string|"'demo'"
op|','
string|"'docs'"
op|','
string|"'facet'"
op|','
string|"'grouping'"
op|','
string|"'highlighter'"
op|','
string|"'join'"
op|','
string|"'memory'"
op|','
string|"'misc'"
op|','
string|"'queries'"
op|','
string|"'queryparser'"
op|','
string|"'sandbox'"
op|','
string|"'spatial'"
op|','
string|"'suggest'"
op|','
string|"'test-framework'"
op|','
string|"'licenses'"
op|')'
newline|'\n'
name|'if'
name|'isSrc'
op|':'
newline|'\n'
indent|'      '
name|'extras'
op|'+='
op|'('
string|"'build.xml'"
op|','
string|"'common-build.xml'"
op|','
string|"'module-build.xml'"
op|','
string|"'ivy-settings.xml'"
op|','
string|"'backwards'"
op|','
string|"'tools'"
op|','
string|"'site'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'extras'
op|'='
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# TODO: if solr, verify lucene/licenses, solr/licenses are present'
nl|'\n'
nl|'\n'
dedent|''
name|'for'
name|'e'
name|'in'
name|'extras'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'e'
name|'not'
name|'in'
name|'l'
op|':'
newline|'\n'
indent|'      '
name|'raise'
name|'RuntimeError'
op|'('
string|"'%s: %s missing from artifact %s'"
op|'%'
op|'('
name|'project'
op|','
name|'e'
op|','
name|'artifact'
op|')'
op|')'
newline|'\n'
dedent|''
name|'l'
op|'.'
name|'remove'
op|'('
name|'e'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'project'
op|'=='
string|"'lucene'"
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'len'
op|'('
name|'l'
op|')'
op|'>'
number|'0'
op|':'
newline|'\n'
indent|'      '
name|'raise'
name|'RuntimeError'
op|'('
string|"'%s: unexpected files/dirs in artifact %s: %s'"
op|'%'
op|'('
name|'project'
op|','
name|'artifact'
op|','
name|'l'
op|')'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'isSrc'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'    make sure no JARs/WARs in src dist...'"
op|')'
newline|'\n'
name|'lines'
op|'='
name|'os'
op|'.'
name|'popen'
op|'('
string|"'find . -name \\\\*.jar'"
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'lines'
op|')'
op|'!='
number|'0'
op|':'
newline|'\n'
indent|'      '
name|'print'
op|'('
string|"'    FAILED:'"
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'lines'
op|':'
newline|'\n'
indent|'        '
name|'print'
op|'('
string|"'      %s'"
op|'%'
name|'line'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'raise'
name|'RuntimeError'
op|'('
string|"'source release has JARs...'"
op|')'
newline|'\n'
dedent|''
name|'lines'
op|'='
name|'os'
op|'.'
name|'popen'
op|'('
string|"'find . -name \\\\*.war'"
op|')'
op|'.'
name|'readlines'
op|'('
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'lines'
op|')'
op|'!='
number|'0'
op|':'
newline|'\n'
indent|'      '
name|'print'
op|'('
string|"'    FAILED:'"
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'lines'
op|':'
newline|'\n'
indent|'        '
name|'print'
op|'('
string|"'      %s'"
op|'%'
name|'line'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
name|'raise'
name|'RuntimeError'
op|'('
string|"'source release has WARs...'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'print'
op|'('
string|'\'    run "ant validate"\''
op|')'
newline|'\n'
name|'run'
op|'('
string|"'%s; ant validate'"
op|'%'
name|'javaExe'
op|'('
string|"'1.7'"
op|')'
op|','
string|"'%s/validate.log'"
op|'%'
name|'unpackPath'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'project'
op|'=='
string|"'lucene'"
op|':'
newline|'\n'
indent|'      '
name|'print'
op|'('
string|"'    run tests w/ Java 6...'"
op|')'
newline|'\n'
name|'run'
op|'('
string|"'%s; ant test'"
op|'%'
name|'javaExe'
op|'('
string|"'1.6'"
op|')'
op|','
string|"'%s/test.log'"
op|'%'
name|'unpackPath'
op|')'
newline|'\n'
name|'run'
op|'('
string|"'%s; ant jar'"
op|'%'
name|'javaExe'
op|'('
string|"'1.6'"
op|')'
op|','
string|"'%s/compile.log'"
op|'%'
name|'unpackPath'
op|')'
newline|'\n'
name|'testDemo'
op|'('
name|'isSrc'
op|','
name|'version'
op|')'
newline|'\n'
comment|'# test javadocs'
nl|'\n'
name|'print'
op|'('
string|"'    generate javadocs w/ Java 6...'"
op|')'
newline|'\n'
name|'run'
op|'('
string|"'%s; ant javadocs'"
op|'%'
name|'javaExe'
op|'('
string|"'1.6'"
op|')'
op|','
string|"'%s/javadocs.log'"
op|'%'
name|'unpackPath'
op|')'
newline|'\n'
name|'checkJavadocpath'
op|'('
string|"'%s/build/docs'"
op|'%'
name|'unpackPath'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'os'
op|'.'
name|'chdir'
op|'('
string|"'solr'"
op|')'
newline|'\n'
name|'print'
op|'('
string|"'    run tests w/ Java 6...'"
op|')'
newline|'\n'
name|'run'
op|'('
string|"'%s; ant test'"
op|'%'
name|'javaExe'
op|'('
string|"'1.6'"
op|')'
op|','
string|"'%s/test.log'"
op|'%'
name|'unpackPath'
op|')'
newline|'\n'
nl|'\n'
comment|'# test javadocs'
nl|'\n'
name|'print'
op|'('
string|"'    generate javadocs w/ Java 6...'"
op|')'
newline|'\n'
name|'run'
op|'('
string|"'%s; ant javadocs'"
op|'%'
name|'javaExe'
op|'('
string|"'1.6'"
op|')'
op|','
string|"'%s/javadocs.log'"
op|'%'
name|'unpackPath'
op|')'
newline|'\n'
name|'checkJavadocpath'
op|'('
string|"'%s/solr/build/docs'"
op|'%'
name|'unpackPath'
op|','
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'print'
op|'('
string|"'    run tests w/ Java 7...'"
op|')'
newline|'\n'
name|'run'
op|'('
string|"'%s; ant test'"
op|'%'
name|'javaExe'
op|'('
string|"'1.7'"
op|')'
op|','
string|"'%s/test.log'"
op|'%'
name|'unpackPath'
op|')'
newline|'\n'
nl|'\n'
comment|'# test javadocs'
nl|'\n'
name|'print'
op|'('
string|"'    generate javadocs w/ Java 7...'"
op|')'
newline|'\n'
name|'run'
op|'('
string|"'%s; ant javadocs'"
op|'%'
name|'javaExe'
op|'('
string|"'1.7'"
op|')'
op|','
string|"'%s/javadocs.log'"
op|'%'
name|'unpackPath'
op|')'
newline|'\n'
name|'checkJavadocpath'
op|'('
string|"'%s/solr/build/docs'"
op|'%'
name|'unpackPath'
op|','
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'print'
op|'('
string|"'    test solr example w/ Java 6...'"
op|')'
newline|'\n'
name|'run'
op|'('
string|"'%s; ant clean example'"
op|'%'
name|'javaExe'
op|'('
string|"'1.6'"
op|')'
op|','
string|"'%s/antexample.log'"
op|'%'
name|'unpackPath'
op|')'
newline|'\n'
name|'testSolrExample'
op|'('
name|'unpackPath'
op|','
name|'JAVA6_HOME'
op|','
name|'True'
op|')'
newline|'\n'
nl|'\n'
name|'print'
op|'('
string|"'    test solr example w/ Java 7...'"
op|')'
newline|'\n'
name|'run'
op|'('
string|"'%s; ant clean example'"
op|'%'
name|'javaExe'
op|'('
string|"'1.7'"
op|')'
op|','
string|"'%s/antexample.log'"
op|'%'
name|'unpackPath'
op|')'
newline|'\n'
name|'testSolrExample'
op|'('
name|'unpackPath'
op|','
name|'JAVA7_HOME'
op|','
name|'True'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
string|"'..'"
op|')'
newline|'\n'
nl|'\n'
name|'print'
op|'('
string|"'    check NOTICE'"
op|')'
newline|'\n'
name|'testNotice'
op|'('
name|'unpackPath'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'project'
op|'=='
string|"'lucene'"
op|':'
newline|'\n'
indent|'      '
name|'testDemo'
op|'('
name|'isSrc'
op|','
name|'version'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'      '
name|'print'
op|'('
string|"'    test solr example w/ Java 6...'"
op|')'
newline|'\n'
name|'testSolrExample'
op|'('
name|'unpackPath'
op|','
name|'JAVA6_HOME'
op|','
name|'False'
op|')'
newline|'\n'
nl|'\n'
name|'print'
op|'('
string|"'    test solr example w/ Java 7...'"
op|')'
newline|'\n'
name|'testSolrExample'
op|'('
name|'unpackPath'
op|','
name|'JAVA7_HOME'
op|','
name|'False'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'testChangesText'
op|'('
string|"'.'"
op|','
name|'version'
op|','
name|'project'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'project'
op|'=='
string|"'lucene'"
name|'and'
name|'not'
name|'isSrc'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'    check Lucene\\'s javadoc JAR'"
op|')'
newline|'\n'
name|'checkJavadocpath'
op|'('
string|"'%s/docs'"
op|'%'
name|'unpackPath'
op|')'
newline|'\n'
nl|'\n'
DECL|function|testNotice
dedent|''
dedent|''
name|'def'
name|'testNotice'
op|'('
name|'unpackPath'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'solrNotice'
op|'='
name|'open'
op|'('
string|"'%s/NOTICE.txt'"
op|'%'
name|'unpackPath'
op|','
name|'encoding'
op|'='
string|"'UTF-8'"
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
name|'luceneNotice'
op|'='
name|'open'
op|'('
string|"'%s/lucene/NOTICE.txt'"
op|'%'
name|'unpackPath'
op|','
name|'encoding'
op|'='
string|"'UTF-8'"
op|')'
op|'.'
name|'read'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'expected'
op|'='
string|'"""\n=========================================================================\n==  Apache Lucene Notice                                               ==\n=========================================================================\n\n"""'
op|'+'
name|'luceneNotice'
op|'+'
string|'"""---\n"""'
newline|'\n'
nl|'\n'
name|'if'
name|'solrNotice'
op|'.'
name|'find'
op|'('
name|'expected'
op|')'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'Solr\\'s NOTICE.txt does not have the verbatim copy, plus header/footer, of Lucene\\'s NOTICE.txt'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|readSolrOutput
dedent|''
dedent|''
name|'def'
name|'readSolrOutput'
op|'('
name|'p'
op|','
name|'startupEvent'
op|','
name|'failureEvent'
op|','
name|'logFile'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'f'
op|'='
name|'open'
op|'('
name|'logFile'
op|','
string|"'wb'"
op|')'
newline|'\n'
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'while'
name|'True'
op|':'
newline|'\n'
indent|'      '
name|'line'
op|'='
name|'p'
op|'.'
name|'readline'
op|'('
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'line'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'        '
name|'break'
newline|'\n'
dedent|''
name|'f'
op|'.'
name|'write'
op|'('
name|'line'
op|')'
newline|'\n'
name|'f'
op|'.'
name|'flush'
op|'('
op|')'
newline|'\n'
comment|"# print 'SOLR: %s' % line.strip()"
nl|'\n'
name|'if'
name|'not'
name|'startupEvent'
op|'.'
name|'isSet'
op|'('
op|')'
name|'and'
name|'line'
op|'.'
name|'find'
op|'('
string|"b'Started SocketConnector@0.0.0.0:8983'"
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'        '
name|'startupEvent'
op|'.'
name|'set'
op|'('
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
op|')'
newline|'\n'
name|'print'
op|'('
string|"'Exception reading Solr output:'"
op|')'
newline|'\n'
name|'traceback'
op|'.'
name|'print_exc'
op|'('
op|')'
newline|'\n'
name|'failureEvent'
op|'.'
name|'set'
op|'('
op|')'
newline|'\n'
dedent|''
name|'finally'
op|':'
newline|'\n'
indent|'    '
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|testSolrExample
dedent|''
dedent|''
name|'def'
name|'testSolrExample'
op|'('
name|'unpackPath'
op|','
name|'javaPath'
op|','
name|'isSrc'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'logFile'
op|'='
string|"'%s/solr-example.log'"
op|'%'
name|'unpackPath'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
string|"'example'"
op|')'
newline|'\n'
name|'print'
op|'('
string|"'      start Solr instance (log=%s)...'"
op|'%'
name|'logFile'
op|')'
newline|'\n'
name|'env'
op|'='
op|'{'
op|'}'
newline|'\n'
name|'env'
op|'.'
name|'update'
op|'('
name|'os'
op|'.'
name|'environ'
op|')'
newline|'\n'
name|'env'
op|'['
string|"'JAVA_HOME'"
op|']'
op|'='
name|'javaPath'
newline|'\n'
name|'env'
op|'['
string|"'PATH'"
op|']'
op|'='
string|"'%s/bin:%s'"
op|'%'
op|'('
name|'javaPath'
op|','
name|'env'
op|'['
string|"'PATH'"
op|']'
op|')'
newline|'\n'
name|'server'
op|'='
name|'subprocess'
op|'.'
name|'Popen'
op|'('
op|'['
string|"'java'"
op|','
string|"'-jar'"
op|','
string|"'start.jar'"
op|']'
op|','
name|'stdout'
op|'='
name|'subprocess'
op|'.'
name|'PIPE'
op|','
name|'stderr'
op|'='
name|'subprocess'
op|'.'
name|'PIPE'
op|','
name|'env'
op|'='
name|'env'
op|')'
newline|'\n'
nl|'\n'
name|'startupEvent'
op|'='
name|'threading'
op|'.'
name|'Event'
op|'('
op|')'
newline|'\n'
name|'failureEvent'
op|'='
name|'threading'
op|'.'
name|'Event'
op|'('
op|')'
newline|'\n'
name|'serverThread'
op|'='
name|'threading'
op|'.'
name|'Thread'
op|'('
name|'target'
op|'='
name|'readSolrOutput'
op|','
name|'args'
op|'='
op|'('
name|'server'
op|'.'
name|'stderr'
op|','
name|'startupEvent'
op|','
name|'failureEvent'
op|','
name|'logFile'
op|')'
op|')'
newline|'\n'
name|'serverThread'
op|'.'
name|'setDaemon'
op|'('
name|'True'
op|')'
newline|'\n'
name|'serverThread'
op|'.'
name|'start'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# Make sure Solr finishes startup:'
nl|'\n'
name|'startupEvent'
op|'.'
name|'wait'
op|'('
op|')'
newline|'\n'
name|'print'
op|'('
string|"'      startup done'"
op|')'
newline|'\n'
nl|'\n'
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'      test utf8...'"
op|')'
newline|'\n'
name|'run'
op|'('
string|"'sh ./exampledocs/test_utf8.sh'"
op|','
string|"'utf8.log'"
op|')'
newline|'\n'
name|'print'
op|'('
string|"'      index example docs...'"
op|')'
newline|'\n'
name|'run'
op|'('
string|"'sh ./exampledocs/post.sh ./exampledocs/*.xml'"
op|','
string|"'post-example-docs.log'"
op|')'
newline|'\n'
name|'print'
op|'('
string|"'      run query...'"
op|')'
newline|'\n'
name|'s'
op|'='
name|'urllib'
op|'.'
name|'request'
op|'.'
name|'urlopen'
op|'('
string|"'http://localhost:8983/solr/select/?q=video'"
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|'.'
name|'decode'
op|'('
string|"'UTF-8'"
op|')'
newline|'\n'
name|'if'
name|'s'
op|'.'
name|'find'
op|'('
string|'\'<result name="response" numFound="3" start="0">\''
op|')'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'      '
name|'print'
op|'('
string|"'FAILED: response is:\\n%s'"
op|'%'
name|'s'
op|')'
newline|'\n'
name|'raise'
name|'RuntimeError'
op|'('
string|"'query on solr example instance failed'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'finally'
op|':'
newline|'\n'
comment|'# Stop server:'
nl|'\n'
indent|'    '
name|'print'
op|'('
string|"'      stop server (SIGINT)...'"
op|')'
newline|'\n'
name|'os'
op|'.'
name|'kill'
op|'('
name|'server'
op|'.'
name|'pid'
op|','
name|'signal'
op|'.'
name|'SIGINT'
op|')'
newline|'\n'
nl|'\n'
comment|'# Give it 10 seconds to gracefully shut down'
nl|'\n'
name|'serverThread'
op|'.'
name|'join'
op|'('
number|'10.0'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'serverThread'
op|'.'
name|'isAlive'
op|'('
op|')'
op|':'
newline|'\n'
comment|'# Kill server:'
nl|'\n'
indent|'      '
name|'print'
op|'('
string|"'***WARNING***: Solr instance didn\\'t respond to SIGINT; using SIGKILL now...'"
op|')'
newline|'\n'
name|'os'
op|'.'
name|'kill'
op|'('
name|'server'
op|'.'
name|'pid'
op|','
name|'signal'
op|'.'
name|'SIGKILL'
op|')'
newline|'\n'
nl|'\n'
name|'serverThread'
op|'.'
name|'join'
op|'('
number|'10.0'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'serverThread'
op|'.'
name|'isAlive'
op|'('
op|')'
op|':'
newline|'\n'
comment|"# Shouldn't happen unless something is seriously wrong..."
nl|'\n'
indent|'        '
name|'print'
op|'('
string|"'***WARNING***: Solr instance didn\\'t respond to SIGKILL; ignoring...'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'failureEvent'
op|'.'
name|'isSet'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'exception while reading Solr output'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'os'
op|'.'
name|'chdir'
op|'('
string|"'..'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|checkJavadocpath
dedent|''
name|'def'
name|'checkJavadocpath'
op|'('
name|'path'
op|','
name|'failOnMissing'
op|'='
name|'True'
op|')'
op|':'
newline|'\n'
comment|"# check for level='package'"
nl|'\n'
comment|'# we fail here if its screwed up'
nl|'\n'
indent|'  '
name|'if'
name|'failOnMissing'
name|'and'
name|'checkJavaDocs'
op|'.'
name|'checkPackageSummaries'
op|'('
name|'path'
op|','
string|"'package'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'missing javadocs package summaries!'"
op|')'
newline|'\n'
nl|'\n'
comment|"# now check for level='class'"
nl|'\n'
dedent|''
name|'if'
name|'checkJavaDocs'
op|'.'
name|'checkPackageSummaries'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
comment|'# disabled: RM cannot fix all this, see LUCENE-3887'
nl|'\n'
comment|"# raise RuntimeError('javadoc problems')"
nl|'\n'
indent|'    '
name|'print'
op|'('
string|"'\\n***WARNING***: javadocs want to fail!\\n'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'checkJavadocLinks'
op|'.'
name|'checkAll'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'broken javadocs links found!'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|testDemo
dedent|''
dedent|''
name|'def'
name|'testDemo'
op|'('
name|'isSrc'
op|','
name|'version'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'print'
op|'('
string|"'    test demo...'"
op|')'
newline|'\n'
name|'sep'
op|'='
string|"';'"
name|'if'
name|'cygwin'
name|'else'
string|"':'"
newline|'\n'
name|'if'
name|'isSrc'
op|':'
newline|'\n'
indent|'    '
name|'cp'
op|'='
string|"'build/core/classes/java{0}build/demo/classes/java{0}build/analysis/common/classes/java{0}build/queryparser/classes/java'"
op|'.'
name|'format'
op|'('
name|'sep'
op|')'
newline|'\n'
name|'docsDir'
op|'='
string|"'core/src'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'cp'
op|'='
string|"'core/lucene-core-{0}.jar{1}demo/lucene-demo-{0}.jar{1}analysis/common/lucene-analyzers-common-{0}.jar{1}queryparser/lucene-queryparser-{0}.jar'"
op|'.'
name|'format'
op|'('
name|'version'
op|','
name|'sep'
op|')'
newline|'\n'
name|'docsDir'
op|'='
string|"'docs'"
newline|'\n'
dedent|''
name|'run'
op|'('
string|'\'%s; java -cp "%s" org.apache.lucene.demo.IndexFiles -index index -docs %s\''
op|'%'
op|'('
name|'javaExe'
op|'('
string|"'1.6'"
op|')'
op|','
name|'cp'
op|','
name|'docsDir'
op|')'
op|','
string|"'index.log'"
op|')'
newline|'\n'
name|'run'
op|'('
string|'\'%s; java -cp "%s" org.apache.lucene.demo.SearchFiles -index index -query lucene\''
op|'%'
op|'('
name|'javaExe'
op|'('
string|"'1.6'"
op|')'
op|','
name|'cp'
op|')'
op|','
string|"'search.log'"
op|')'
newline|'\n'
name|'reMatchingDocs'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"'(\\d+) total matching documents'"
op|')'
newline|'\n'
name|'m'
op|'='
name|'reMatchingDocs'
op|'.'
name|'search'
op|'('
name|'open'
op|'('
string|"'search.log'"
op|','
name|'encoding'
op|'='
string|"'UTF-8'"
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'if'
name|'m'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'lucene demo\\'s SearchFiles found no results'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'numHits'
op|'='
name|'int'
op|'('
name|'m'
op|'.'
name|'group'
op|'('
number|'1'
op|')'
op|')'
newline|'\n'
name|'if'
name|'numHits'
op|'<'
number|'100'
op|':'
newline|'\n'
indent|'      '
name|'raise'
name|'RuntimeError'
op|'('
string|"'lucene demo\\'s SearchFiles found too few results: %s'"
op|'%'
name|'numHits'
op|')'
newline|'\n'
dedent|''
name|'print'
op|'('
string|'\'      got %d hits for query "lucene"\''
op|'%'
name|'numHits'
op|')'
newline|'\n'
nl|'\n'
DECL|function|checkMaven
dedent|''
dedent|''
name|'def'
name|'checkMaven'
op|'('
name|'baseURL'
op|','
name|'tmpDir'
op|','
name|'version'
op|','
name|'isSigned'
op|')'
op|':'
newline|'\n'
comment|'# Locate the release branch in subversion'
nl|'\n'
indent|'  '
name|'m'
op|'='
name|'re'
op|'.'
name|'match'
op|'('
string|"'(\\d+)\\.(\\d+)'"
op|','
name|'version'
op|')'
comment|'# Get Major.minor version components'
newline|'\n'
name|'releaseBranchText'
op|'='
string|"'lucene_solr_%s_%s/'"
op|'%'
op|'('
name|'m'
op|'.'
name|'group'
op|'('
number|'1'
op|')'
op|','
name|'m'
op|'.'
name|'group'
op|'('
number|'2'
op|')'
op|')'
newline|'\n'
name|'branchesURL'
op|'='
string|"'http://svn.apache.org/repos/asf/lucene/dev/branches/'"
newline|'\n'
name|'releaseBranchSvnURL'
op|'='
name|'None'
newline|'\n'
name|'branches'
op|'='
name|'getDirEntries'
op|'('
name|'branchesURL'
op|')'
newline|'\n'
name|'for'
name|'text'
op|','
name|'subURL'
name|'in'
name|'branches'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'text'
op|'=='
name|'releaseBranchText'
op|':'
newline|'\n'
indent|'      '
name|'releaseBranchSvnURL'
op|'='
name|'subURL'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'print'
op|'('
string|"'    get POM templates'"
op|','
name|'end'
op|'='
string|"' '"
op|')'
newline|'\n'
name|'POMtemplates'
op|'='
name|'defaultdict'
op|'('
op|')'
newline|'\n'
name|'getPOMtemplates'
op|'('
name|'POMtemplates'
op|','
name|'tmpDir'
op|','
name|'releaseBranchSvnURL'
op|')'
newline|'\n'
name|'print'
op|'('
op|')'
newline|'\n'
name|'print'
op|'('
string|"'    download artifacts'"
op|','
name|'end'
op|'='
string|"' '"
op|')'
newline|'\n'
name|'artifacts'
op|'='
op|'{'
string|"'lucene'"
op|':'
op|'['
op|']'
op|','
string|"'solr'"
op|':'
op|'['
op|']'
op|'}'
newline|'\n'
name|'for'
name|'project'
name|'in'
op|'('
string|"'lucene'"
op|','
string|"'solr'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'artifactsURL'
op|'='
string|"'%s/%s/maven/org/apache/%s'"
op|'%'
op|'('
name|'baseURL'
op|','
name|'project'
op|','
name|'project'
op|')'
newline|'\n'
name|'targetDir'
op|'='
string|"'%s/maven/org/apache/%s'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'targetDir'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'targetDir'
op|')'
newline|'\n'
dedent|''
name|'crawl'
op|'('
name|'artifacts'
op|'['
name|'project'
op|']'
op|','
name|'artifactsURL'
op|','
name|'targetDir'
op|')'
newline|'\n'
dedent|''
name|'print'
op|'('
op|')'
newline|'\n'
name|'print'
op|'('
string|"'    verify that each binary artifact has a deployed POM...'"
op|')'
newline|'\n'
name|'verifyPOMperBinaryArtifact'
op|'('
name|'artifacts'
op|','
name|'version'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'    verify that there is an artifact for each POM template...'"
op|')'
newline|'\n'
name|'verifyArtifactPerPOMtemplate'
op|'('
name|'POMtemplates'
op|','
name|'artifacts'
op|','
name|'tmpDir'
op|','
name|'version'
op|')'
newline|'\n'
name|'print'
op|'('
string|'"    verify Maven artifacts\' md5/sha1 digests..."'
op|')'
newline|'\n'
name|'verifyMavenDigests'
op|'('
name|'artifacts'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'    verify that all non-Mavenized deps are deployed...'"
op|')'
newline|'\n'
name|'nonMavenizedDeps'
op|'='
name|'dict'
op|'('
op|')'
newline|'\n'
name|'checkNonMavenizedDeps'
op|'('
name|'nonMavenizedDeps'
op|','
name|'POMtemplates'
op|','
name|'artifacts'
op|','
name|'tmpDir'
op|','
nl|'\n'
name|'version'
op|','
name|'releaseBranchSvnURL'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'    check for javadoc and sources artifacts...'"
op|')'
newline|'\n'
name|'checkJavadocAndSourceArtifacts'
op|'('
name|'nonMavenizedDeps'
op|','
name|'artifacts'
op|','
name|'version'
op|')'
newline|'\n'
name|'print'
op|'('
string|'"    verify deployed POMs\' coordinates..."'
op|')'
newline|'\n'
name|'verifyDeployedPOMsCoordinates'
op|'('
name|'artifacts'
op|','
name|'version'
op|')'
newline|'\n'
name|'if'
name|'isSigned'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'    verify maven artifact sigs'"
op|','
name|'end'
op|'='
string|"' '"
op|')'
newline|'\n'
name|'verifyMavenSigs'
op|'('
name|'baseURL'
op|','
name|'tmpDir'
op|','
name|'artifacts'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'distributionFiles'
op|'='
name|'getDistributionsForMavenChecks'
op|'('
name|'tmpDir'
op|','
name|'version'
op|','
name|'baseURL'
op|')'
newline|'\n'
nl|'\n'
name|'print'
op|'('
string|"'    verify that non-Mavenized deps are same as in the binary distribution...'"
op|')'
newline|'\n'
name|'checkIdenticalNonMavenizedDeps'
op|'('
name|'distributionFiles'
op|','
name|'nonMavenizedDeps'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'    verify that Maven artifacts are same as in the binary distribution...'"
op|')'
newline|'\n'
name|'checkIdenticalMavenArtifacts'
op|'('
name|'distributionFiles'
op|','
name|'nonMavenizedDeps'
op|','
name|'artifacts'
op|','
name|'version'
op|')'
newline|'\n'
nl|'\n'
DECL|function|getDistributionsForMavenChecks
dedent|''
name|'def'
name|'getDistributionsForMavenChecks'
op|'('
name|'tmpDir'
op|','
name|'version'
op|','
name|'baseURL'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'distributionFiles'
op|'='
name|'defaultdict'
op|'('
op|')'
newline|'\n'
name|'for'
name|'project'
name|'in'
op|'('
string|"'lucene'"
op|','
string|"'solr'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'distribution'
op|'='
string|"'%s-%s.tgz'"
op|'%'
op|'('
name|'project'
op|','
name|'version'
op|')'
newline|'\n'
name|'if'
name|'project'
op|'=='
string|"'solr'"
op|':'
name|'distribution'
op|'='
string|"'apache-'"
op|'+'
name|'distribution'
newline|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
string|"'%s/%s'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'distribution'
op|')'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'distURL'
op|'='
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'baseURL'
op|','
name|'project'
op|','
name|'distribution'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'    download %s...'"
op|'%'
name|'distribution'
op|','
name|'end'
op|'='
string|"' '"
op|')'
newline|'\n'
name|'download'
op|'('
name|'distribution'
op|','
name|'distURL'
op|','
name|'tmpDir'
op|')'
newline|'\n'
dedent|''
name|'destDir'
op|'='
string|"'%s/unpack-%s-maven'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'destDir'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'shutil'
op|'.'
name|'rmtree'
op|'('
name|'destDir'
op|')'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'destDir'
op|')'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
name|'destDir'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'    unpack %s...'"
op|'%'
name|'distribution'
op|')'
newline|'\n'
name|'unpackLogFile'
op|'='
string|"'%s/unpack-%s-maven-checks.log'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'distribution'
op|')'
newline|'\n'
name|'run'
op|'('
string|"'tar xzf %s/%s'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'distribution'
op|')'
op|','
name|'unpackLogFile'
op|')'
newline|'\n'
name|'if'
name|'project'
op|'=='
string|"'solr'"
op|':'
comment|'# unpack the Solr war'
newline|'\n'
indent|'      '
name|'unpackLogFile'
op|'='
string|"'%s/unpack-solr-war-maven-checks.log'"
op|'%'
name|'tmpDir'
newline|'\n'
name|'print'
op|'('
string|"'        unpack Solr war...'"
op|')'
newline|'\n'
name|'run'
op|'('
string|"'jar xvf */dist/*.war'"
op|','
name|'unpackLogFile'
op|')'
newline|'\n'
dedent|''
name|'distributionFiles'
op|'['
name|'project'
op|']'
op|'='
op|'['
op|']'
newline|'\n'
name|'for'
name|'root'
op|','
name|'dirs'
op|','
name|'files'
name|'in'
name|'os'
op|'.'
name|'walk'
op|'('
name|'destDir'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'distributionFiles'
op|'['
name|'project'
op|']'
op|'.'
name|'extend'
op|'('
op|'['
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'root'
op|','
name|'file'
op|')'
name|'for'
name|'file'
name|'in'
name|'files'
op|']'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'return'
name|'distributionFiles'
newline|'\n'
nl|'\n'
DECL|function|checkJavadocAndSourceArtifacts
dedent|''
name|'def'
name|'checkJavadocAndSourceArtifacts'
op|'('
name|'nonMavenizedDeps'
op|','
name|'artifacts'
op|','
name|'version'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'for'
name|'project'
name|'in'
op|'('
string|"'lucene'"
op|','
string|"'solr'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'for'
name|'artifact'
name|'in'
name|'artifacts'
op|'['
name|'project'
op|']'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'artifact'
op|'.'
name|'endswith'
op|'('
name|'version'
op|'+'
string|"'.jar'"
op|')'
name|'and'
name|'artifact'
name|'not'
name|'in'
name|'list'
op|'('
name|'nonMavenizedDeps'
op|'.'
name|'keys'
op|'('
op|')'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'javadocJar'
op|'='
name|'artifact'
op|'['
op|':'
op|'-'
number|'4'
op|']'
op|'+'
string|"'-javadoc.jar'"
newline|'\n'
name|'if'
name|'javadocJar'
name|'not'
name|'in'
name|'artifacts'
op|'['
name|'project'
op|']'
op|':'
newline|'\n'
indent|'          '
name|'raise'
name|'RuntimeError'
op|'('
string|"'missing: %s'"
op|'%'
name|'javadocJar'
op|')'
newline|'\n'
dedent|''
name|'sourcesJar'
op|'='
name|'artifact'
op|'['
op|':'
op|'-'
number|'4'
op|']'
op|'+'
string|"'-sources.jar'"
newline|'\n'
name|'if'
name|'sourcesJar'
name|'not'
name|'in'
name|'artifacts'
op|'['
name|'project'
op|']'
op|':'
newline|'\n'
indent|'          '
name|'raise'
name|'RuntimeError'
op|'('
string|"'missing: %s'"
op|'%'
name|'sourcesJar'
op|')'
newline|'\n'
nl|'\n'
DECL|function|checkIdenticalNonMavenizedDeps
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'checkIdenticalNonMavenizedDeps'
op|'('
name|'distributionFiles'
op|','
name|'nonMavenizedDeps'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'for'
name|'project'
name|'in'
op|'('
string|"'lucene'"
op|','
string|"'solr'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'distFilenames'
op|'='
name|'dict'
op|'('
op|')'
newline|'\n'
name|'for'
name|'file'
name|'in'
name|'distributionFiles'
op|'['
name|'project'
op|']'
op|':'
newline|'\n'
indent|'      '
name|'distFilenames'
op|'['
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'file'
op|')'
op|']'
op|'='
name|'file'
newline|'\n'
dedent|''
name|'for'
name|'dep'
name|'in'
name|'list'
op|'('
name|'nonMavenizedDeps'
op|'.'
name|'keys'
op|'('
op|')'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'if'
op|'('
string|"'/%s/'"
op|'%'
name|'project'
op|')'
name|'in'
name|'dep'
op|':'
newline|'\n'
indent|'        '
name|'depOrigFilename'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'nonMavenizedDeps'
op|'['
name|'dep'
op|']'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'depOrigFilename'
name|'in'
name|'distFilenames'
op|':'
newline|'\n'
indent|'          '
name|'raise'
name|'RuntimeError'
op|'('
string|"'missing: non-mavenized dependency %s'"
op|'%'
name|'nonMavenizedDeps'
op|'['
name|'dep'
op|']'
op|')'
newline|'\n'
dedent|''
name|'identical'
op|'='
name|'filecmp'
op|'.'
name|'cmp'
op|'('
name|'dep'
op|','
name|'distFilenames'
op|'['
name|'depOrigFilename'
op|']'
op|','
name|'shallow'
op|'='
name|'False'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'identical'
op|':'
newline|'\n'
indent|'          '
name|'raise'
name|'RuntimeError'
op|'('
string|"'Deployed non-mavenized dep %s differs from distribution dep %s'"
nl|'\n'
op|'%'
op|'('
name|'dep'
op|','
name|'distFilenames'
op|'['
name|'depOrigFilename'
op|']'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|checkIdenticalMavenArtifacts
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'checkIdenticalMavenArtifacts'
op|'('
name|'distributionFiles'
op|','
name|'nonMavenizedDeps'
op|','
name|'artifacts'
op|','
name|'version'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'reJarWar'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"r'%s\\.[wj]ar$'"
op|'%'
name|'version'
op|')'
comment|'# exclude *-javadoc.jar and *-sources.jar'
newline|'\n'
name|'for'
name|'project'
name|'in'
op|'('
string|"'lucene'"
op|','
string|"'solr'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'distFilenames'
op|'='
name|'dict'
op|'('
op|')'
newline|'\n'
name|'for'
name|'file'
name|'in'
name|'distributionFiles'
op|'['
name|'project'
op|']'
op|':'
newline|'\n'
indent|'      '
name|'baseName'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'file'
op|')'
newline|'\n'
name|'if'
name|'project'
op|'=='
string|"'solr'"
op|':'
comment|"# Remove 'apache-' prefix to allow comparison to Maven artifacts"
newline|'\n'
indent|'        '
name|'baseName'
op|'='
name|'baseName'
op|'.'
name|'replace'
op|'('
string|"'apache-'"
op|','
string|"''"
op|')'
newline|'\n'
dedent|''
name|'distFilenames'
op|'['
name|'baseName'
op|']'
op|'='
name|'file'
newline|'\n'
dedent|''
name|'for'
name|'artifact'
name|'in'
name|'artifacts'
op|'['
name|'project'
op|']'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'reJarWar'
op|'.'
name|'search'
op|'('
name|'artifact'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'artifact'
name|'not'
name|'in'
name|'list'
op|'('
name|'nonMavenizedDeps'
op|'.'
name|'keys'
op|'('
op|')'
op|')'
op|':'
newline|'\n'
indent|'          '
name|'artifactFilename'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'artifact'
op|')'
newline|'\n'
name|'if'
name|'artifactFilename'
name|'not'
name|'in'
name|'list'
op|'('
name|'distFilenames'
op|'.'
name|'keys'
op|'('
op|')'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'raise'
name|'RuntimeError'
op|'('
string|"'Maven artifact %s is not present in %s binary distribution'"
nl|'\n'
op|'%'
op|'('
name|'artifact'
op|','
name|'project'
op|')'
op|')'
newline|'\n'
comment|'# TODO: Either fix the build to ensure that maven artifacts *are* identical, or recursively compare contents'
nl|'\n'
comment|'# identical = filecmp.cmp(artifact, distFilenames[artifactFilename], shallow=False)'
nl|'\n'
comment|'# if not identical:'
nl|'\n'
comment|"#   raise RuntimeError('Maven artifact %s is not identical to %s in %s binary distribution'"
nl|'\n'
comment|'#                     % (artifact, distFilenames[artifactFilename], project))'
nl|'\n'
nl|'\n'
DECL|function|verifyMavenDigests
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'verifyMavenDigests'
op|'('
name|'artifacts'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'reJarWarPom'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"r'\\.(?:[wj]ar|pom)$'"
op|')'
newline|'\n'
name|'for'
name|'project'
name|'in'
op|'('
string|"'lucene'"
op|','
string|"'solr'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'for'
name|'artifactFile'
name|'in'
op|'['
name|'a'
name|'for'
name|'a'
name|'in'
name|'artifacts'
op|'['
name|'project'
op|']'
name|'if'
name|'reJarWarPom'
op|'.'
name|'search'
op|'('
name|'a'
op|')'
op|']'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'artifactFile'
op|'+'
string|"'.md5'"
name|'not'
name|'in'
name|'artifacts'
op|'['
name|'project'
op|']'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|"'missing: MD5 digest for %s'"
op|'%'
name|'artifactFile'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'artifactFile'
op|'+'
string|"'.sha1'"
name|'not'
name|'in'
name|'artifacts'
op|'['
name|'project'
op|']'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|"'missing: SHA1 digest for %s'"
op|'%'
name|'artifactFile'
op|')'
newline|'\n'
dedent|''
name|'with'
name|'open'
op|'('
name|'artifactFile'
op|'+'
string|"'.md5'"
op|','
name|'encoding'
op|'='
string|"'UTF-8'"
op|')'
name|'as'
name|'md5File'
op|':'
newline|'\n'
indent|'        '
name|'md5Expected'
op|'='
name|'md5File'
op|'.'
name|'read'
op|'('
op|')'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
dedent|''
name|'with'
name|'open'
op|'('
name|'artifactFile'
op|'+'
string|"'.sha1'"
op|','
name|'encoding'
op|'='
string|"'UTF-8'"
op|')'
name|'as'
name|'sha1File'
op|':'
newline|'\n'
indent|'        '
name|'sha1Expected'
op|'='
name|'sha1File'
op|'.'
name|'read'
op|'('
op|')'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
dedent|''
name|'md5'
op|'='
name|'hashlib'
op|'.'
name|'md5'
op|'('
op|')'
newline|'\n'
name|'sha1'
op|'='
name|'hashlib'
op|'.'
name|'sha1'
op|'('
op|')'
newline|'\n'
name|'inputFile'
op|'='
name|'open'
op|'('
name|'artifactFile'
op|','
string|"'rb'"
op|')'
newline|'\n'
name|'while'
name|'True'
op|':'
newline|'\n'
indent|'        '
name|'bytes'
op|'='
name|'inputFile'
op|'.'
name|'read'
op|'('
number|'65536'
op|')'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'bytes'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'          '
name|'break'
newline|'\n'
dedent|''
name|'md5'
op|'.'
name|'update'
op|'('
name|'bytes'
op|')'
newline|'\n'
name|'sha1'
op|'.'
name|'update'
op|'('
name|'bytes'
op|')'
newline|'\n'
dedent|''
name|'inputFile'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'md5Actual'
op|'='
name|'md5'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
name|'sha1Actual'
op|'='
name|'sha1'
op|'.'
name|'hexdigest'
op|'('
op|')'
newline|'\n'
name|'if'
name|'md5Actual'
op|'!='
name|'md5Expected'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|"'MD5 digest mismatch for %s: expected %s but got %s'"
nl|'\n'
op|'%'
op|'('
name|'artifactFile'
op|','
name|'md5Expected'
op|','
name|'md5Actual'
op|')'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'sha1Actual'
op|'!='
name|'sha1Expected'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|"'SHA1 digest mismatch for %s: expected %s but got %s'"
nl|'\n'
op|'%'
op|'('
name|'artifactFile'
op|','
name|'sha1Expected'
op|','
name|'sha1Actual'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|checkNonMavenizedDeps
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'checkNonMavenizedDeps'
op|'('
name|'nonMavenizedDependencies'
op|','
name|'POMtemplates'
op|','
name|'artifacts'
op|','
nl|'\n'
name|'tmpDir'
op|','
name|'version'
op|','
name|'releaseBranchSvnURL'
op|')'
op|':'
newline|'\n'
indent|'  '
string|'"""\n  - check for non-mavenized dependencies listed in the grandfather POM template\n  - nonMavenizedDependencies is populated with a map from non-mavenized dependency\n    artifact path to the original jar path\n  """'
newline|'\n'
name|'namespace'
op|'='
string|"'{http://maven.apache.org/POM/4.0.0}'"
newline|'\n'
name|'xpathProfile'
op|'='
string|"'{0}profiles/{0}profile'"
op|'.'
name|'format'
op|'('
name|'namespace'
op|')'
newline|'\n'
name|'xpathPlugin'
op|'='
string|"'{0}build/{0}plugins/{0}plugin'"
op|'.'
name|'format'
op|'('
name|'namespace'
op|')'
newline|'\n'
name|'xpathExecution'
op|'='
string|"'{0}executions/{0}execution'"
op|'.'
name|'format'
op|'('
name|'namespace'
op|')'
newline|'\n'
name|'xpathResourceDir'
op|'='
string|"'{0}configuration/{0}resources/{0}resource/{0}directory'"
op|'.'
name|'format'
op|'('
name|'namespace'
op|')'
newline|'\n'
nl|'\n'
name|'treeRoot'
op|'='
name|'ET'
op|'.'
name|'parse'
op|'('
name|'POMtemplates'
op|'['
string|"'grandfather'"
op|']'
op|'['
number|'0'
op|']'
op|')'
op|'.'
name|'getroot'
op|'('
op|')'
newline|'\n'
name|'for'
name|'profile'
name|'in'
name|'treeRoot'
op|'.'
name|'findall'
op|'('
name|'xpathProfile'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'pomDirs'
op|'='
op|'['
op|']'
newline|'\n'
name|'profileId'
op|'='
name|'profile'
op|'.'
name|'find'
op|'('
string|"'%sid'"
op|'%'
name|'namespace'
op|')'
newline|'\n'
name|'if'
name|'profileId'
name|'is'
name|'not'
name|'None'
name|'and'
name|'profileId'
op|'.'
name|'text'
op|'=='
string|"'bootstrap'"
op|':'
newline|'\n'
indent|'      '
name|'plugins'
op|'='
name|'profile'
op|'.'
name|'findall'
op|'('
name|'xpathPlugin'
op|')'
newline|'\n'
name|'for'
name|'plugin'
name|'in'
name|'plugins'
op|':'
newline|'\n'
indent|'        '
name|'artifactId'
op|'='
name|'plugin'
op|'.'
name|'find'
op|'('
string|"'%sartifactId'"
op|'%'
name|'namespace'
op|')'
op|'.'
name|'text'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'if'
name|'artifactId'
op|'=='
string|"'maven-resources-plugin'"
op|':'
newline|'\n'
indent|'          '
name|'for'
name|'config'
name|'in'
name|'plugin'
op|'.'
name|'findall'
op|'('
name|'xpathExecution'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'pomDirs'
op|'.'
name|'append'
op|'('
name|'config'
op|'.'
name|'find'
op|'('
name|'xpathResourceDir'
op|')'
op|'.'
name|'text'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
dedent|''
name|'for'
name|'plugin'
name|'in'
name|'plugins'
op|':'
newline|'\n'
indent|'        '
name|'artifactId'
op|'='
name|'plugin'
op|'.'
name|'find'
op|'('
string|"'%sartifactId'"
op|'%'
name|'namespace'
op|')'
op|'.'
name|'text'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'if'
name|'artifactId'
op|'=='
string|"'maven-install-plugin'"
op|':'
newline|'\n'
indent|'          '
name|'for'
name|'execution'
name|'in'
name|'plugin'
op|'.'
name|'findall'
op|'('
name|'xpathExecution'
op|')'
op|':'
newline|'\n'
indent|'            '
name|'groupId'
op|','
name|'artifactId'
op|','
name|'file'
op|','
name|'pomFile'
op|'='
string|"''"
op|','
string|"''"
op|','
string|"''"
op|','
string|"''"
newline|'\n'
name|'for'
name|'child'
name|'in'
name|'execution'
op|'.'
name|'find'
op|'('
string|"'%sconfiguration'"
op|'%'
name|'namespace'
op|')'
op|'.'
name|'getchildren'
op|'('
op|')'
op|':'
newline|'\n'
indent|'              '
name|'text'
op|'='
name|'child'
op|'.'
name|'text'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'if'
name|'child'
op|'.'
name|'tag'
op|'=='
string|"'%sgroupId'"
op|'%'
name|'namespace'
op|':'
newline|'\n'
indent|'                '
name|'groupId'
op|'='
name|'text'
name|'if'
name|'text'
op|'!='
string|"'${project.groupId}'"
name|'else'
string|"'org.apache.lucene'"
newline|'\n'
dedent|''
name|'elif'
name|'child'
op|'.'
name|'tag'
op|'=='
string|"'%sartifactId'"
op|'%'
name|'namespace'
op|':'
name|'artifactId'
op|'='
name|'text'
newline|'\n'
name|'elif'
name|'child'
op|'.'
name|'tag'
op|'=='
string|"'%sfile'"
op|'%'
name|'namespace'
op|':'
name|'file'
op|'='
name|'text'
newline|'\n'
name|'elif'
name|'child'
op|'.'
name|'tag'
op|'=='
string|"'%spomFile'"
op|'%'
name|'namespace'
op|':'
name|'pomFile'
op|'='
name|'text'
newline|'\n'
dedent|''
name|'if'
name|'groupId'
name|'in'
op|'('
string|"'org.apache.lucene'"
op|','
string|"'org.apache.solr'"
op|')'
op|':'
newline|'\n'
indent|'              '
name|'depJar'
op|'='
string|"'%s/maven/%s/%s/%s/%s-%s.jar'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'groupId'
op|'.'
name|'replace'
op|'('
string|"'.'"
op|','
string|"'/'"
op|')'
op|','
nl|'\n'
name|'artifactId'
op|','
name|'version'
op|','
name|'artifactId'
op|','
name|'version'
op|')'
newline|'\n'
name|'if'
name|'depJar'
name|'not'
name|'in'
name|'artifacts'
op|'['
string|"'lucene'"
op|']'
name|'and'
name|'depJar'
name|'not'
name|'in'
name|'artifacts'
op|'['
string|"'solr'"
op|']'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'RuntimeError'
op|'('
string|"'Missing non-mavenized dependency %s'"
op|'%'
name|'depJar'
op|')'
newline|'\n'
dedent|''
name|'nonMavenizedDependencies'
op|'['
name|'depJar'
op|']'
op|'='
name|'file'
newline|'\n'
dedent|''
name|'elif'
name|'pomFile'
op|':'
comment|'# Find non-Mavenized deps with associated POMs'
newline|'\n'
indent|'              '
name|'pomFile'
op|'='
name|'pomFile'
op|'.'
name|'split'
op|'('
string|"'/'"
op|')'
op|'['
op|'-'
number|'1'
op|']'
comment|'# remove path'
newline|'\n'
name|'doc2'
op|'='
name|'None'
newline|'\n'
name|'workingCopy'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'abspath'
op|'('
string|"'%s/../..'"
op|'%'
name|'sys'
op|'.'
name|'path'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'for'
name|'pomDir'
name|'in'
name|'pomDirs'
op|':'
newline|'\n'
indent|'                '
name|'if'
name|'releaseBranchSvnURL'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'                  '
name|'pomPath'
op|'='
string|"'%s/%s/%s'"
op|'%'
op|'('
name|'workingCopy'
op|','
name|'pomDir'
op|','
name|'pomFile'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'pomPath'
op|')'
op|':'
newline|'\n'
indent|'                    '
name|'doc2'
op|'='
name|'ET'
op|'.'
name|'XML'
op|'('
name|'open'
op|'('
name|'pomPath'
op|','
name|'encoding'
op|'='
string|"'UTF-8'"
op|')'
op|'.'
name|'read'
op|'('
op|')'
op|')'
newline|'\n'
name|'break'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'                  '
name|'entries'
op|'='
name|'getDirEntries'
op|'('
string|"'%s/%s'"
op|'%'
op|'('
name|'releaseBranchSvnURL'
op|','
name|'pomDir'
op|')'
op|')'
newline|'\n'
name|'for'
name|'text'
op|','
name|'subURL'
name|'in'
name|'entries'
op|':'
newline|'\n'
indent|'                    '
name|'if'
name|'text'
op|'=='
name|'pomFile'
op|':'
newline|'\n'
indent|'                      '
name|'doc2'
op|'='
name|'ET'
op|'.'
name|'XML'
op|'('
name|'load'
op|'('
name|'subURL'
op|')'
op|')'
newline|'\n'
name|'break'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'doc2'
name|'is'
name|'not'
name|'None'
op|':'
name|'break'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'groupId2'
op|','
name|'artifactId2'
op|','
name|'packaging2'
op|','
name|'POMversion'
op|'='
name|'getPOMcoordinate'
op|'('
name|'doc2'
op|')'
newline|'\n'
name|'depJar'
op|'='
string|"'%s/maven/%s/%s/%s/%s-%s.jar'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'groupId2'
op|'.'
name|'replace'
op|'('
string|"'.'"
op|','
string|"'/'"
op|')'
op|','
nl|'\n'
name|'artifactId2'
op|','
name|'version'
op|','
name|'artifactId2'
op|','
name|'version'
op|')'
newline|'\n'
name|'if'
name|'depJar'
name|'not'
name|'in'
name|'artifacts'
op|'['
string|"'lucene'"
op|']'
name|'and'
name|'depJar'
name|'not'
name|'in'
name|'artifacts'
op|'['
string|"'solr'"
op|']'
op|':'
newline|'\n'
indent|'                '
name|'raise'
name|'RuntimeError'
op|'('
string|"'Missing non-mavenized dependency %s'"
op|'%'
name|'depJar'
op|')'
newline|'\n'
dedent|''
name|'nonMavenizedDependencies'
op|'['
name|'depJar'
op|']'
op|'='
name|'file'
newline|'\n'
nl|'\n'
DECL|function|getPOMcoordinate
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'getPOMcoordinate'
op|'('
name|'treeRoot'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'namespace'
op|'='
string|"'{http://maven.apache.org/POM/4.0.0}'"
newline|'\n'
name|'groupId'
op|'='
name|'treeRoot'
op|'.'
name|'find'
op|'('
string|"'%sgroupId'"
op|'%'
name|'namespace'
op|')'
newline|'\n'
name|'if'
name|'groupId'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'    '
name|'groupId'
op|'='
name|'treeRoot'
op|'.'
name|'find'
op|'('
string|"'{0}parent/{0}groupId'"
op|'.'
name|'format'
op|'('
name|'namespace'
op|')'
op|')'
newline|'\n'
dedent|''
name|'groupId'
op|'='
name|'groupId'
op|'.'
name|'text'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'artifactId'
op|'='
name|'treeRoot'
op|'.'
name|'find'
op|'('
string|"'%sartifactId'"
op|'%'
name|'namespace'
op|')'
op|'.'
name|'text'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'version'
op|'='
name|'treeRoot'
op|'.'
name|'find'
op|'('
string|"'%sversion'"
op|'%'
name|'namespace'
op|')'
newline|'\n'
name|'if'
name|'version'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'    '
name|'version'
op|'='
name|'treeRoot'
op|'.'
name|'find'
op|'('
string|"'{0}parent/{0}version'"
op|'.'
name|'format'
op|'('
name|'namespace'
op|')'
op|')'
newline|'\n'
dedent|''
name|'version'
op|'='
name|'version'
op|'.'
name|'text'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'packaging'
op|'='
name|'treeRoot'
op|'.'
name|'find'
op|'('
string|"'%spackaging'"
op|'%'
name|'namespace'
op|')'
newline|'\n'
name|'packaging'
op|'='
string|"'jar'"
name|'if'
name|'packaging'
name|'is'
name|'None'
name|'else'
name|'packaging'
op|'.'
name|'text'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'return'
name|'groupId'
op|','
name|'artifactId'
op|','
name|'packaging'
op|','
name|'version'
newline|'\n'
nl|'\n'
DECL|function|verifyMavenSigs
dedent|''
name|'def'
name|'verifyMavenSigs'
op|'('
name|'baseURL'
op|','
name|'tmpDir'
op|','
name|'artifacts'
op|')'
op|':'
newline|'\n'
indent|'  '
string|'"""Verify Maven artifact signatures"""'
newline|'\n'
name|'for'
name|'project'
name|'in'
op|'('
string|"'lucene'"
op|','
string|"'solr'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'keysFile'
op|'='
string|"'%s/%s.KEYS'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'keysFile'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'keysURL'
op|'='
string|"'%s/%s/KEYS'"
op|'%'
op|'('
name|'baseURL'
op|','
name|'project'
op|')'
newline|'\n'
name|'download'
op|'('
string|"'%s.KEYS'"
op|'%'
name|'project'
op|','
name|'keysURL'
op|','
name|'tmpDir'
op|','
name|'quiet'
op|'='
name|'True'
op|')'
newline|'\n'
nl|'\n'
comment|'# Set up clean gpg world; import keys file:'
nl|'\n'
dedent|''
name|'gpgHomeDir'
op|'='
string|"'%s/%s.gpg'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|')'
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'gpgHomeDir'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'shutil'
op|'.'
name|'rmtree'
op|'('
name|'gpgHomeDir'
op|')'
newline|'\n'
dedent|''
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'gpgHomeDir'
op|','
number|'0o700'
op|')'
newline|'\n'
name|'run'
op|'('
string|"'gpg --homedir %s --import %s'"
op|'%'
op|'('
name|'gpgHomeDir'
op|','
name|'keysFile'
op|')'
op|','
nl|'\n'
string|"'%s/%s.gpg.import.log'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|')'
op|')'
newline|'\n'
nl|'\n'
name|'reArtifacts'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"r'\\.(?:pom|[jw]ar)$'"
op|')'
newline|'\n'
name|'for'
name|'artifactFile'
name|'in'
op|'['
name|'a'
name|'for'
name|'a'
name|'in'
name|'artifacts'
op|'['
name|'project'
op|']'
name|'if'
name|'reArtifacts'
op|'.'
name|'search'
op|'('
name|'a'
op|')'
op|']'
op|':'
newline|'\n'
indent|'      '
name|'artifact'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'basename'
op|'('
name|'artifactFile'
op|')'
newline|'\n'
name|'sigFile'
op|'='
string|"'%s.asc'"
op|'%'
name|'artifactFile'
newline|'\n'
comment|'# Test sig (this is done with a clean brand-new GPG world)'
nl|'\n'
name|'logFile'
op|'='
string|"'%s/%s.%s.gpg.verify.log'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|','
name|'artifact'
op|')'
newline|'\n'
name|'run'
op|'('
string|"'gpg --homedir %s --verify %s %s'"
op|'%'
op|'('
name|'gpgHomeDir'
op|','
name|'sigFile'
op|','
name|'artifactFile'
op|')'
op|','
nl|'\n'
name|'logFile'
op|')'
newline|'\n'
comment|'# Forward any GPG warnings, except the expected one (since its a clean world)'
nl|'\n'
name|'f'
op|'='
name|'open'
op|'('
name|'logFile'
op|','
name|'encoding'
op|'='
string|"'UTF-8'"
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'f'
op|'.'
name|'readlines'
op|'('
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'line'
op|'.'
name|'lower'
op|'('
op|')'
op|'.'
name|'find'
op|'('
string|"'warning'"
op|')'
op|'!='
op|'-'
number|'1'
name|'and'
name|'line'
op|'.'
name|'find'
op|'('
string|"'WARNING: This key is not certified with a trusted signature'"
op|')'
op|'=='
op|'-'
number|'1'
name|'and'
name|'line'
op|'.'
name|'find'
op|'('
string|"'WARNING: using insecure memory'"
op|')'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'          '
name|'print'
op|'('
string|"'      GPG: %s'"
op|'%'
name|'line'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
comment|'# Test trust (this is done with the real users config)'
nl|'\n'
name|'run'
op|'('
string|"'gpg --import %s'"
op|'%'
name|'keysFile'
op|','
nl|'\n'
string|"'%s/%s.gpg.trust.import.log'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|')'
op|')'
newline|'\n'
name|'logFile'
op|'='
string|"'%s/%s.%s.gpg.trust.log'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'project'
op|','
name|'artifact'
op|')'
newline|'\n'
name|'run'
op|'('
string|"'gpg --verify %s %s'"
op|'%'
op|'('
name|'sigFile'
op|','
name|'artifactFile'
op|')'
op|','
name|'logFile'
op|')'
newline|'\n'
comment|'# Forward any GPG warnings:'
nl|'\n'
name|'f'
op|'='
name|'open'
op|'('
name|'logFile'
op|','
name|'encoding'
op|'='
string|"'UTF-8'"
op|')'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'f'
op|'.'
name|'readlines'
op|'('
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'line'
op|'.'
name|'lower'
op|'('
op|')'
op|'.'
name|'find'
op|'('
string|"'warning'"
op|')'
op|'!='
op|'-'
number|'1'
name|'and'
name|'line'
op|'.'
name|'find'
op|'('
string|"'WARNING: This key is not certified with a trusted signature'"
op|')'
op|'=='
op|'-'
number|'1'
name|'and'
name|'line'
op|'.'
name|'find'
op|'('
string|"'WARNING: using insecure memory'"
op|')'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'          '
name|'print'
op|'('
string|"'      GPG: %s'"
op|'%'
name|'line'
op|'.'
name|'strip'
op|'('
op|')'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'sys'
op|'.'
name|'stdout'
op|'.'
name|'write'
op|'('
string|"'.'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'print'
op|'('
op|')'
newline|'\n'
nl|'\n'
DECL|function|verifyPOMperBinaryArtifact
dedent|''
name|'def'
name|'verifyPOMperBinaryArtifact'
op|'('
name|'artifacts'
op|','
name|'version'
op|')'
op|':'
newline|'\n'
indent|'  '
string|'"""verify that each binary jar and war has a corresponding POM file"""'
newline|'\n'
name|'reBinaryJarWar'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"r'%s\\.[jw]ar$'"
op|'%'
name|'re'
op|'.'
name|'escape'
op|'('
name|'version'
op|')'
op|')'
newline|'\n'
name|'for'
name|'project'
name|'in'
op|'('
string|"'lucene'"
op|','
string|"'solr'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'for'
name|'artifact'
name|'in'
op|'['
name|'a'
name|'for'
name|'a'
name|'in'
name|'artifacts'
op|'['
name|'project'
op|']'
name|'if'
name|'reBinaryJarWar'
op|'.'
name|'search'
op|'('
name|'a'
op|')'
op|']'
op|':'
newline|'\n'
indent|'      '
name|'POM'
op|'='
name|'artifact'
op|'['
op|':'
op|'-'
number|'4'
op|']'
op|'+'
string|"'.pom'"
newline|'\n'
name|'if'
name|'POM'
name|'not'
name|'in'
name|'artifacts'
op|'['
name|'project'
op|']'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|"'missing: POM for %s'"
op|'%'
name|'artifact'
op|')'
newline|'\n'
nl|'\n'
DECL|function|verifyDeployedPOMsCoordinates
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'verifyDeployedPOMsCoordinates'
op|'('
name|'artifacts'
op|','
name|'version'
op|')'
op|':'
newline|'\n'
indent|'  '
string|'"""\n  verify that each POM\'s coordinate (drawn from its content) matches\n  its filepath, and verify that the corresponding artifact exists.\n  """'
newline|'\n'
name|'for'
name|'project'
name|'in'
op|'('
string|"'lucene'"
op|','
string|"'solr'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'for'
name|'POM'
name|'in'
op|'['
name|'a'
name|'for'
name|'a'
name|'in'
name|'artifacts'
op|'['
name|'project'
op|']'
name|'if'
name|'a'
op|'.'
name|'endswith'
op|'('
string|"'.pom'"
op|')'
op|']'
op|':'
newline|'\n'
indent|'      '
name|'treeRoot'
op|'='
name|'ET'
op|'.'
name|'parse'
op|'('
name|'POM'
op|')'
op|'.'
name|'getroot'
op|'('
op|')'
newline|'\n'
name|'groupId'
op|','
name|'artifactId'
op|','
name|'packaging'
op|','
name|'POMversion'
op|'='
name|'getPOMcoordinate'
op|'('
name|'treeRoot'
op|')'
newline|'\n'
name|'POMpath'
op|'='
string|"'%s/%s/%s/%s-%s.pom'"
op|'%'
op|'('
name|'groupId'
op|'.'
name|'replace'
op|'('
string|"'.'"
op|','
string|"'/'"
op|')'
op|','
name|'artifactId'
op|','
name|'version'
op|','
name|'artifactId'
op|','
name|'version'
op|')'
newline|'\n'
name|'if'
name|'not'
name|'POM'
op|'.'
name|'endswith'
op|'('
name|'POMpath'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|'"Mismatch between POM coordinate %s:%s:%s and filepath: %s"'
nl|'\n'
op|'%'
op|'('
name|'groupId'
op|','
name|'artifactId'
op|','
name|'POMversion'
op|','
name|'POM'
op|')'
op|')'
newline|'\n'
comment|'# Verify that the corresponding artifact exists'
nl|'\n'
dedent|''
name|'artifact'
op|'='
name|'POM'
op|'['
op|':'
op|'-'
number|'3'
op|']'
op|'+'
name|'packaging'
newline|'\n'
name|'if'
name|'artifact'
name|'not'
name|'in'
name|'artifacts'
op|'['
name|'project'
op|']'
op|':'
newline|'\n'
indent|'        '
name|'raise'
name|'RuntimeError'
op|'('
string|"'Missing corresponding .%s artifact for POM %s'"
op|'%'
op|'('
name|'packaging'
op|','
name|'POM'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|function|verifyArtifactPerPOMtemplate
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'verifyArtifactPerPOMtemplate'
op|'('
name|'POMtemplates'
op|','
name|'artifacts'
op|','
name|'tmpDir'
op|','
name|'version'
op|')'
op|':'
newline|'\n'
indent|'  '
string|'"""verify that each POM template\'s artifact is present in artifacts"""'
newline|'\n'
name|'namespace'
op|'='
string|"'{http://maven.apache.org/POM/4.0.0}'"
newline|'\n'
name|'xpathPlugin'
op|'='
string|"'{0}build/{0}plugins/{0}plugin'"
op|'.'
name|'format'
op|'('
name|'namespace'
op|')'
newline|'\n'
name|'xpathSkipConfiguration'
op|'='
string|"'{0}configuration/{0}skip'"
op|'.'
name|'format'
op|'('
name|'namespace'
op|')'
newline|'\n'
name|'for'
name|'project'
name|'in'
op|'('
string|"'lucene'"
op|','
string|"'solr'"
op|')'
op|':'
newline|'\n'
indent|'    '
name|'for'
name|'POMtemplate'
name|'in'
name|'POMtemplates'
op|'['
name|'project'
op|']'
op|':'
newline|'\n'
indent|'      '
name|'treeRoot'
op|'='
name|'ET'
op|'.'
name|'parse'
op|'('
name|'POMtemplate'
op|')'
op|'.'
name|'getroot'
op|'('
op|')'
newline|'\n'
name|'skipDeploy'
op|'='
name|'False'
newline|'\n'
name|'for'
name|'plugin'
name|'in'
name|'treeRoot'
op|'.'
name|'findall'
op|'('
name|'xpathPlugin'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'artifactId'
op|'='
name|'plugin'
op|'.'
name|'find'
op|'('
string|"'%sartifactId'"
op|'%'
name|'namespace'
op|')'
op|'.'
name|'text'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'if'
name|'artifactId'
op|'=='
string|"'maven-deploy-plugin'"
op|':'
newline|'\n'
indent|'          '
name|'skip'
op|'='
name|'plugin'
op|'.'
name|'find'
op|'('
name|'xpathSkipConfiguration'
op|')'
newline|'\n'
name|'if'
name|'skip'
name|'is'
name|'not'
name|'None'
op|':'
name|'skipDeploy'
op|'='
op|'('
name|'skip'
op|'.'
name|'text'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'lower'
op|'('
op|')'
op|'=='
string|"'true'"
op|')'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'not'
name|'skipDeploy'
op|':'
newline|'\n'
indent|'        '
name|'groupId'
op|','
name|'artifactId'
op|','
name|'packaging'
op|','
name|'POMversion'
op|'='
name|'getPOMcoordinate'
op|'('
name|'treeRoot'
op|')'
newline|'\n'
comment|'# Ignore POMversion, since its value will not have been interpolated'
nl|'\n'
name|'artifact'
op|'='
string|"'%s/maven/%s/%s/%s/%s-%s.%s'"
op|'%'
op|'('
name|'tmpDir'
op|','
name|'groupId'
op|'.'
name|'replace'
op|'('
string|"'.'"
op|','
string|"'/'"
op|')'
op|','
name|'artifactId'
op|','
nl|'\n'
name|'version'
op|','
name|'artifactId'
op|','
name|'version'
op|','
name|'packaging'
op|')'
newline|'\n'
name|'if'
name|'artifact'
name|'not'
name|'in'
name|'artifacts'
op|'['
string|"'lucene'"
op|']'
name|'and'
name|'artifact'
name|'not'
name|'in'
name|'artifacts'
op|'['
string|"'solr'"
op|']'
op|':'
newline|'\n'
indent|'          '
name|'raise'
name|'RuntimeError'
op|'('
string|"'Missing artifact %s'"
op|'%'
name|'artifact'
op|')'
newline|'\n'
nl|'\n'
DECL|function|getPOMtemplates
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'getPOMtemplates'
op|'('
name|'POMtemplates'
op|','
name|'tmpDir'
op|','
name|'releaseBranchSvnURL'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'allPOMtemplates'
op|'='
op|'['
op|']'
newline|'\n'
name|'sourceLocation'
op|'='
name|'releaseBranchSvnURL'
newline|'\n'
name|'if'
name|'sourceLocation'
name|'is'
name|'None'
op|':'
newline|'\n'
comment|'# Use the POM templates under dev-tools/maven/ in the local working copy'
nl|'\n'
comment|'# sys.path[0] is the directory containing this script: dev-tools/scripts/'
nl|'\n'
indent|'    '
name|'sourceLocation'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'abspath'
op|'('
string|"'%s/../maven'"
op|'%'
name|'sys'
op|'.'
name|'path'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'rePOMtemplate'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"r'^pom.xml.template$'"
op|')'
newline|'\n'
name|'for'
name|'root'
op|','
name|'dirs'
op|','
name|'files'
name|'in'
name|'os'
op|'.'
name|'walk'
op|'('
name|'sourceLocation'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'allPOMtemplates'
op|'.'
name|'extend'
op|'('
op|'['
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'root'
op|','
name|'f'
op|')'
name|'for'
name|'f'
name|'in'
name|'files'
name|'if'
name|'rePOMtemplate'
op|'.'
name|'search'
op|'('
name|'f'
op|')'
op|']'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'sourceLocation'
op|'+='
string|"'dev-tools/maven/'"
newline|'\n'
name|'targetDir'
op|'='
string|"'%s/dev-tools/maven'"
op|'%'
name|'tmpDir'
newline|'\n'
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'targetDir'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'targetDir'
op|')'
newline|'\n'
dedent|''
name|'crawl'
op|'('
name|'allPOMtemplates'
op|','
name|'sourceLocation'
op|','
name|'targetDir'
op|','
name|'set'
op|'('
op|'['
string|"'Apache Subversion'"
op|']'
op|')'
op|')'
comment|'# Ignore "Apache Subversion" links'
newline|'\n'
nl|'\n'
dedent|''
name|'POMtemplates'
op|'['
string|"'lucene'"
op|']'
op|'='
op|'['
name|'p'
name|'for'
name|'p'
name|'in'
name|'allPOMtemplates'
name|'if'
string|"'/maven/lucene/'"
name|'in'
name|'p'
op|']'
newline|'\n'
name|'if'
name|'POMtemplates'
op|'['
string|"'lucene'"
op|']'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'No Lucene POMs found at %s'"
op|'%'
name|'sourceLocation'
op|')'
newline|'\n'
dedent|''
name|'POMtemplates'
op|'['
string|"'solr'"
op|']'
op|'='
op|'['
name|'p'
name|'for'
name|'p'
name|'in'
name|'allPOMtemplates'
name|'if'
string|"'/maven/solr/'"
name|'in'
name|'p'
op|']'
newline|'\n'
name|'if'
name|'POMtemplates'
op|'['
string|"'solr'"
op|']'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'No Solr POMs found at %s'"
op|'%'
name|'sourceLocation'
op|')'
newline|'\n'
dedent|''
name|'POMtemplates'
op|'['
string|"'grandfather'"
op|']'
op|'='
op|'['
name|'p'
name|'for'
name|'p'
name|'in'
name|'allPOMtemplates'
name|'if'
string|"'/maven/pom.xml.template'"
name|'in'
name|'p'
op|']'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'POMtemplates'
op|'['
string|"'grandfather'"
op|']'
op|')'
op|'=='
number|'0'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'No Lucene/Solr grandfather POM found at %s'"
op|'%'
name|'sourceLocation'
op|')'
newline|'\n'
nl|'\n'
DECL|function|crawl
dedent|''
dedent|''
name|'def'
name|'crawl'
op|'('
name|'downloadedFiles'
op|','
name|'urlString'
op|','
name|'targetDir'
op|','
name|'exclusions'
op|'='
name|'set'
op|'('
op|')'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'for'
name|'text'
op|','
name|'subURL'
name|'in'
name|'getDirEntries'
op|'('
name|'urlString'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'text'
name|'not'
name|'in'
name|'exclusions'
op|':'
newline|'\n'
indent|'      '
name|'path'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'targetDir'
op|','
name|'text'
op|')'
newline|'\n'
name|'if'
name|'text'
op|'.'
name|'endswith'
op|'('
string|"'/'"
op|')'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'          '
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'path'
op|')'
newline|'\n'
dedent|''
name|'crawl'
op|'('
name|'downloadedFiles'
op|','
name|'subURL'
op|','
name|'path'
op|','
name|'exclusions'
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'path'
op|')'
name|'or'
name|'not'
name|'DEBUG'
op|':'
newline|'\n'
indent|'          '
name|'download'
op|'('
name|'text'
op|','
name|'subURL'
op|','
name|'targetDir'
op|','
name|'quiet'
op|'='
name|'True'
op|')'
newline|'\n'
dedent|''
name|'downloadedFiles'
op|'.'
name|'append'
op|'('
name|'path'
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'stdout'
op|'.'
name|'write'
op|'('
string|"'.'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|main
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'main'
op|'('
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'  '
name|'if'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|')'
op|'<'
number|'4'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
op|')'
newline|'\n'
name|'print'
op|'('
string|"'Usage python -u %s BaseURL version tmpDir'"
op|'%'
name|'sys'
op|'.'
name|'argv'
op|'['
number|'0'
op|']'
op|')'
newline|'\n'
name|'print'
op|'('
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'baseURL'
op|'='
name|'sys'
op|'.'
name|'argv'
op|'['
number|'1'
op|']'
newline|'\n'
name|'version'
op|'='
name|'sys'
op|'.'
name|'argv'
op|'['
number|'2'
op|']'
newline|'\n'
name|'tmpDir'
op|'='
name|'os'
op|'.'
name|'path'
op|'.'
name|'abspath'
op|'('
name|'sys'
op|'.'
name|'argv'
op|'['
number|'3'
op|']'
op|')'
newline|'\n'
name|'isSigned'
op|'='
name|'True'
newline|'\n'
name|'if'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|')'
op|'=='
number|'5'
op|':'
newline|'\n'
indent|'    '
name|'isSigned'
op|'='
op|'('
name|'sys'
op|'.'
name|'argv'
op|'['
number|'4'
op|']'
op|'=='
string|'"True"'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'smokeTest'
op|'('
name|'baseURL'
op|','
name|'version'
op|','
name|'tmpDir'
op|','
name|'isSigned'
op|')'
newline|'\n'
nl|'\n'
DECL|function|smokeTest
dedent|''
name|'def'
name|'smokeTest'
op|'('
name|'baseURL'
op|','
name|'version'
op|','
name|'tmpDir'
op|','
name|'isSigned'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'  '
name|'if'
name|'not'
name|'DEBUG'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'tmpDir'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'raise'
name|'RuntimeError'
op|'('
string|"'temp dir %s exists; please remove first'"
op|'%'
name|'tmpDir'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'exists'
op|'('
name|'tmpDir'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'os'
op|'.'
name|'makedirs'
op|'('
name|'tmpDir'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'lucenePath'
op|'='
name|'None'
newline|'\n'
name|'solrPath'
op|'='
name|'None'
newline|'\n'
name|'print'
op|'('
op|')'
newline|'\n'
name|'print'
op|'('
string|'\'Load release URL "%s"...\''
op|'%'
name|'baseURL'
op|')'
newline|'\n'
name|'newBaseURL'
op|'='
name|'unshortenURL'
op|'('
name|'baseURL'
op|')'
newline|'\n'
name|'if'
name|'newBaseURL'
op|'!='
name|'baseURL'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'  unshortened: %s'"
op|'%'
name|'newBaseURL'
op|')'
newline|'\n'
name|'baseURL'
op|'='
name|'newBaseURL'
newline|'\n'
nl|'\n'
dedent|''
name|'for'
name|'text'
op|','
name|'subURL'
name|'in'
name|'getDirEntries'
op|'('
name|'baseURL'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'text'
op|'.'
name|'lower'
op|'('
op|')'
op|'.'
name|'find'
op|'('
string|"'lucene'"
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'      '
name|'lucenePath'
op|'='
name|'subURL'
newline|'\n'
dedent|''
name|'elif'
name|'text'
op|'.'
name|'lower'
op|'('
op|')'
op|'.'
name|'find'
op|'('
string|"'solr'"
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'      '
name|'solrPath'
op|'='
name|'subURL'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'if'
name|'lucenePath'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'could not find lucene subdir'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'solrPath'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'could not find solr subdir'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'print'
op|'('
op|')'
newline|'\n'
name|'print'
op|'('
string|"'Test Lucene...'"
op|')'
newline|'\n'
name|'checkSigs'
op|'('
string|"'lucene'"
op|','
name|'lucenePath'
op|','
name|'version'
op|','
name|'tmpDir'
op|','
name|'isSigned'
op|')'
newline|'\n'
name|'for'
name|'artifact'
name|'in'
op|'('
string|"'lucene-%s.tgz'"
op|'%'
name|'version'
op|','
string|"'lucene-%s.zip'"
op|'%'
name|'version'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'unpack'
op|'('
string|"'lucene'"
op|','
name|'tmpDir'
op|','
name|'artifact'
op|','
name|'version'
op|')'
newline|'\n'
dedent|''
name|'unpack'
op|'('
string|"'lucene'"
op|','
name|'tmpDir'
op|','
string|"'lucene-%s-src.tgz'"
op|'%'
name|'version'
op|','
name|'version'
op|')'
newline|'\n'
nl|'\n'
name|'print'
op|'('
op|')'
newline|'\n'
name|'print'
op|'('
string|"'Test Solr...'"
op|')'
newline|'\n'
name|'checkSigs'
op|'('
string|"'solr'"
op|','
name|'solrPath'
op|','
name|'version'
op|','
name|'tmpDir'
op|','
name|'isSigned'
op|')'
newline|'\n'
name|'for'
name|'artifact'
name|'in'
op|'('
string|"'apache-solr-%s.tgz'"
op|'%'
name|'version'
op|','
string|"'apache-solr-%s.zip'"
op|'%'
name|'version'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'unpack'
op|'('
string|"'solr'"
op|','
name|'tmpDir'
op|','
name|'artifact'
op|','
name|'version'
op|')'
newline|'\n'
dedent|''
name|'unpack'
op|'('
string|"'solr'"
op|','
name|'tmpDir'
op|','
string|"'apache-solr-%s-src.tgz'"
op|'%'
name|'version'
op|','
name|'version'
op|')'
newline|'\n'
nl|'\n'
name|'print'
op|'('
string|"'Test Maven artifacts for Lucene and Solr...'"
op|')'
newline|'\n'
name|'checkMaven'
op|'('
name|'baseURL'
op|','
name|'tmpDir'
op|','
name|'version'
op|','
name|'isSigned'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'  '
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
op|':'
newline|'\n'
indent|'    '
name|'import'
name|'traceback'
newline|'\n'
name|'traceback'
op|'.'
name|'print_exc'
op|'('
op|')'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
dedent|''
name|'sys'
op|'.'
name|'exit'
op|'('
number|'0'
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
