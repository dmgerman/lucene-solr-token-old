begin_unit
comment|'# Licensed to the Apache Software Foundation (ASF) under one or more'
nl|'\n'
comment|'# contributor license agreements.  See the NOTICE file distributed with'
nl|'\n'
comment|'# this work for additional information regarding copyright ownership.'
nl|'\n'
comment|'# The ASF licenses this file to You under the Apache License, Version 2.0'
nl|'\n'
comment|'# (the "License"); you may not use this file except in compliance with'
nl|'\n'
comment|'# the License.  You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#     http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'sys'
newline|'\n'
name|'sys'
op|'.'
name|'path'
op|'.'
name|'append'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'dirname'
op|'('
name|'__file__'
op|')'
op|')'
newline|'\n'
name|'from'
name|'scriptutil'
name|'import'
op|'*'
newline|'\n'
nl|'\n'
name|'import'
name|'argparse'
newline|'\n'
name|'import'
name|'re'
newline|'\n'
nl|'\n'
DECL|function|update_changes
name|'def'
name|'update_changes'
op|'('
name|'filename'
op|','
name|'new_version'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'print'
op|'('
string|"'  adding new section to %s...'"
op|'%'
name|'filename'
op|','
name|'end'
op|'='
string|"''"
op|','
name|'flush'
op|'='
name|'True'
op|')'
newline|'\n'
name|'matcher'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"r'\\d+\\.\\d+\\.\\d+\\s+==='"
op|')'
newline|'\n'
DECL|function|edit
name|'def'
name|'edit'
op|'('
name|'buffer'
op|','
name|'match'
op|','
name|'line'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'new_version'
op|'.'
name|'dot'
name|'in'
name|'line'
op|':'
newline|'\n'
indent|'      '
name|'return'
name|'None'
newline|'\n'
dedent|''
name|'match'
op|'='
name|'new_version'
op|'.'
name|'previous_dot_matcher'
op|'.'
name|'search'
op|'('
name|'line'
op|')'
newline|'\n'
name|'if'
name|'match'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'      '
name|'buffer'
op|'.'
name|'append'
op|'('
name|'line'
op|'.'
name|'replace'
op|'('
name|'match'
op|'.'
name|'group'
op|'('
number|'0'
op|')'
op|','
name|'new_version'
op|'.'
name|'dot'
op|')'
op|')'
newline|'\n'
name|'buffer'
op|'.'
name|'append'
op|'('
string|"'(No Changes)\\n\\n'"
op|')'
newline|'\n'
dedent|''
name|'buffer'
op|'.'
name|'append'
op|'('
name|'line'
op|')'
newline|'\n'
name|'return'
name|'match'
name|'is'
name|'not'
name|'None'
newline|'\n'
nl|'\n'
dedent|''
name|'changed'
op|'='
name|'update_file'
op|'('
name|'filename'
op|','
name|'matcher'
op|','
name|'edit'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'done'"
name|'if'
name|'changed'
name|'else'
string|"'uptodate'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|add_constant
dedent|''
name|'def'
name|'add_constant'
op|'('
name|'new_version'
op|','
name|'deprecate'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'filename'
op|'='
string|"'lucene/core/src/java/org/apache/lucene/util/Version.java'"
newline|'\n'
name|'print'
op|'('
string|"'  adding constant %s...'"
op|'%'
name|'new_version'
op|'.'
name|'constant'
op|','
name|'end'
op|'='
string|"''"
op|','
name|'flush'
op|'='
name|'True'
op|')'
newline|'\n'
name|'constant_prefix'
op|'='
string|"'public static final Version LUCENE_'"
newline|'\n'
name|'matcher'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
name|'constant_prefix'
op|')'
newline|'\n'
name|'prev_matcher'
op|'='
name|'new_version'
op|'.'
name|'make_previous_matcher'
op|'('
name|'prefix'
op|'='
name|'constant_prefix'
op|','
name|'sep'
op|'='
string|"'_'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|ensure_deprecated
name|'def'
name|'ensure_deprecated'
op|'('
name|'buffer'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'last'
op|'='
name|'buffer'
op|'['
op|'-'
number|'1'
op|']'
newline|'\n'
name|'if'
name|'last'
op|'.'
name|'strip'
op|'('
op|')'
op|'!='
string|"'@Deprecated'"
op|':'
newline|'\n'
indent|'      '
name|'spaces'
op|'='
string|"' '"
op|'*'
op|'('
name|'len'
op|'('
name|'last'
op|')'
op|'-'
name|'len'
op|'('
name|'last'
op|'.'
name|'lstrip'
op|'('
op|')'
op|')'
op|'-'
number|'1'
op|')'
newline|'\n'
name|'buffer'
op|'['
op|'-'
number|'1'
op|']'
op|'='
name|'spaces'
op|'+'
op|'('
string|"' * @deprecated (%s) Use latest\\n'"
op|'%'
name|'new_version'
op|')'
newline|'\n'
name|'buffer'
op|'.'
name|'append'
op|'('
name|'spaces'
op|'+'
string|"' */\\n'"
op|')'
newline|'\n'
name|'buffer'
op|'.'
name|'append'
op|'('
name|'spaces'
op|'+'
string|"'@Deprecated\\n'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|buffer_constant
dedent|''
dedent|''
name|'def'
name|'buffer_constant'
op|'('
name|'buffer'
op|','
name|'line'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'spaces'
op|'='
string|"' '"
op|'*'
op|'('
name|'len'
op|'('
name|'line'
op|')'
op|'-'
name|'len'
op|'('
name|'line'
op|'.'
name|'lstrip'
op|'('
op|')'
op|')'
op|')'
newline|'\n'
name|'buffer'
op|'.'
name|'append'
op|'('
string|"'\\n'"
op|'+'
name|'spaces'
op|'+'
string|"'/**\\n'"
op|')'
newline|'\n'
name|'buffer'
op|'.'
name|'append'
op|'('
name|'spaces'
op|'+'
string|"' * Match settings and bugs in Lucene\\'s %s release.\\n'"
op|'%'
name|'new_version'
op|')'
newline|'\n'
name|'if'
name|'deprecate'
op|':'
newline|'\n'
indent|'      '
name|'buffer'
op|'.'
name|'append'
op|'('
name|'spaces'
op|'+'
string|"' * @deprecated Use latest\\n'"
op|')'
newline|'\n'
dedent|''
name|'buffer'
op|'.'
name|'append'
op|'('
name|'spaces'
op|'+'
string|"' */\\n'"
op|')'
newline|'\n'
name|'if'
name|'deprecate'
op|':'
newline|'\n'
indent|'      '
name|'buffer'
op|'.'
name|'append'
op|'('
name|'spaces'
op|'+'
string|"'@Deprecated\\n'"
op|')'
newline|'\n'
dedent|''
name|'buffer'
op|'.'
name|'append'
op|'('
name|'spaces'
op|'+'
string|"'public static final Version %s = new Version(%d, %d, %d);\\n'"
op|'%'
nl|'\n'
op|'('
name|'new_version'
op|'.'
name|'constant'
op|','
name|'new_version'
op|'.'
name|'major'
op|','
name|'new_version'
op|'.'
name|'minor'
op|','
name|'new_version'
op|'.'
name|'bugfix'
op|')'
op|')'
newline|'\n'
nl|'\n'
DECL|class|Edit
dedent|''
name|'class'
name|'Edit'
op|'('
name|'object'
op|')'
op|':'
newline|'\n'
DECL|variable|found
indent|'    '
name|'found'
op|'='
op|'-'
number|'1'
newline|'\n'
DECL|member|__call__
name|'def'
name|'__call__'
op|'('
name|'self'
op|','
name|'buffer'
op|','
name|'match'
op|','
name|'line'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'new_version'
op|'.'
name|'constant'
name|'in'
name|'line'
op|':'
newline|'\n'
indent|'        '
name|'return'
name|'None'
comment|'# constant already exists'
newline|'\n'
comment|'# outter match is just to find lines declaring version constants'
nl|'\n'
dedent|''
name|'match'
op|'='
name|'prev_matcher'
op|'.'
name|'search'
op|'('
name|'line'
op|')'
newline|'\n'
name|'if'
name|'match'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'        '
name|'ensure_deprecated'
op|'('
name|'buffer'
op|')'
comment|'# old version should be deprecated'
newline|'\n'
name|'self'
op|'.'
name|'found'
op|'='
name|'len'
op|'('
name|'buffer'
op|')'
op|'+'
number|'1'
comment|'# extra 1 for buffering current line below'
newline|'\n'
dedent|''
name|'elif'
name|'self'
op|'.'
name|'found'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
comment|"# we didn't match, but we previously had a match, so insert new version here"
nl|'\n'
comment|'# first find where to insert (first empty line before current constant)'
nl|'\n'
indent|'        '
name|'c'
op|'='
op|'['
op|']'
newline|'\n'
name|'buffer_constant'
op|'('
name|'c'
op|','
name|'line'
op|')'
newline|'\n'
name|'tmp'
op|'='
name|'buffer'
op|'['
name|'self'
op|'.'
name|'found'
op|':'
op|']'
newline|'\n'
name|'buffer'
op|'['
name|'self'
op|'.'
name|'found'
op|':'
op|']'
op|'='
name|'c'
newline|'\n'
name|'buffer'
op|'.'
name|'extend'
op|'('
name|'tmp'
op|')'
newline|'\n'
name|'buffer'
op|'.'
name|'append'
op|'('
name|'line'
op|')'
newline|'\n'
name|'return'
name|'True'
newline|'\n'
nl|'\n'
dedent|''
name|'buffer'
op|'.'
name|'append'
op|'('
name|'line'
op|')'
newline|'\n'
name|'return'
name|'False'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'changed'
op|'='
name|'update_file'
op|'('
name|'filename'
op|','
name|'matcher'
op|','
name|'Edit'
op|'('
op|')'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'done'"
name|'if'
name|'changed'
name|'else'
string|"'uptodate'"
op|')'
newline|'\n'
nl|'\n'
DECL|variable|version_prop_re
dedent|''
name|'version_prop_re'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"'version\\.base=(.*)'"
op|')'
newline|'\n'
DECL|function|update_build_version
name|'def'
name|'update_build_version'
op|'('
name|'new_version'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'print'
op|'('
string|"'  changing version.base...'"
op|','
name|'end'
op|'='
string|"''"
op|','
name|'flush'
op|'='
name|'True'
op|')'
newline|'\n'
name|'filename'
op|'='
string|"'lucene/version.properties'"
newline|'\n'
DECL|function|edit
name|'def'
name|'edit'
op|'('
name|'buffer'
op|','
name|'match'
op|','
name|'line'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'new_version'
op|'.'
name|'dot'
name|'in'
name|'line'
op|':'
newline|'\n'
indent|'      '
name|'return'
name|'None'
newline|'\n'
dedent|''
name|'buffer'
op|'.'
name|'append'
op|'('
string|"'version.base='"
op|'+'
name|'new_version'
op|'.'
name|'dot'
op|'+'
string|"'\\n'"
op|')'
newline|'\n'
name|'return'
name|'True'
newline|'\n'
nl|'\n'
dedent|''
name|'changed'
op|'='
name|'update_file'
op|'('
name|'filename'
op|','
name|'version_prop_re'
op|','
name|'edit'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'done'"
name|'if'
name|'changed'
name|'else'
string|"'uptodate'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|update_latest_constant
dedent|''
name|'def'
name|'update_latest_constant'
op|'('
name|'new_version'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'print'
op|'('
string|"'  changing Version.LATEST to %s...'"
op|'%'
name|'new_version'
op|'.'
name|'constant'
op|','
name|'end'
op|'='
string|"''"
op|','
name|'flush'
op|'='
name|'True'
op|')'
newline|'\n'
name|'filename'
op|'='
string|"'lucene/core/src/java/org/apache/lucene/util/Version.java'"
newline|'\n'
name|'matcher'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"'public static final Version LATEST'"
op|')'
newline|'\n'
DECL|function|edit
name|'def'
name|'edit'
op|'('
name|'buffer'
op|','
name|'match'
op|','
name|'line'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'new_version'
op|'.'
name|'constant'
name|'in'
name|'line'
op|':'
newline|'\n'
indent|'      '
name|'return'
name|'None'
newline|'\n'
dedent|''
name|'buffer'
op|'.'
name|'append'
op|'('
name|'line'
op|'.'
name|'rpartition'
op|'('
string|"'='"
op|')'
op|'['
number|'0'
op|']'
op|'+'
op|'('
string|"'= %s;\\n'"
op|'%'
name|'new_version'
op|'.'
name|'constant'
op|')'
op|')'
newline|'\n'
name|'return'
name|'True'
newline|'\n'
nl|'\n'
dedent|''
name|'changed'
op|'='
name|'update_file'
op|'('
name|'filename'
op|','
name|'matcher'
op|','
name|'edit'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'done'"
name|'if'
name|'changed'
name|'else'
string|"'uptodate'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|onerror
dedent|''
name|'def'
name|'onerror'
op|'('
name|'x'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'raise'
name|'x'
newline|'\n'
nl|'\n'
DECL|function|update_example_solrconfigs
dedent|''
name|'def'
name|'update_example_solrconfigs'
op|'('
name|'new_version'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'print'
op|'('
string|"'  updating example solrconfig.xml files'"
op|')'
newline|'\n'
name|'matcher'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"'<luceneMatchVersion>'"
op|')'
newline|'\n'
nl|'\n'
name|'paths'
op|'='
op|'['
string|"'solr/server/solr/configsets'"
op|','
string|"'solr/example'"
op|']'
newline|'\n'
name|'for'
name|'path'
name|'in'
name|'paths'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'not'
name|'os'
op|'.'
name|'path'
op|'.'
name|'isdir'
op|'('
name|'path'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'raise'
name|'RuntimeError'
op|'('
string|'"Can\'t locate configset dir (layout change?) : "'
op|'+'
name|'path'
op|')'
newline|'\n'
dedent|''
name|'for'
name|'root'
op|','
name|'dirs'
op|','
name|'files'
name|'in'
name|'os'
op|'.'
name|'walk'
op|'('
name|'path'
op|','
name|'onerror'
op|'='
name|'onerror'
op|')'
op|':'
newline|'\n'
indent|'      '
name|'for'
name|'f'
name|'in'
name|'files'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'f'
op|'=='
string|"'solrconfig.xml'"
op|':'
newline|'\n'
indent|'          '
name|'update_solrconfig'
op|'('
name|'os'
op|'.'
name|'path'
op|'.'
name|'join'
op|'('
name|'root'
op|','
name|'f'
op|')'
op|','
name|'matcher'
op|','
name|'new_version'
op|')'
newline|'\n'
nl|'\n'
DECL|function|update_solrconfig
dedent|''
dedent|''
dedent|''
dedent|''
dedent|''
name|'def'
name|'update_solrconfig'
op|'('
name|'filename'
op|','
name|'matcher'
op|','
name|'new_version'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'print'
op|'('
string|"'    %s...'"
op|'%'
name|'filename'
op|','
name|'end'
op|'='
string|"''"
op|','
name|'flush'
op|'='
name|'True'
op|')'
newline|'\n'
DECL|function|edit
name|'def'
name|'edit'
op|'('
name|'buffer'
op|','
name|'match'
op|','
name|'line'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'if'
name|'new_version'
op|'.'
name|'dot'
name|'in'
name|'line'
op|':'
newline|'\n'
indent|'      '
name|'return'
name|'None'
newline|'\n'
dedent|''
name|'match'
op|'='
name|'new_version'
op|'.'
name|'previous_dot_matcher'
op|'.'
name|'search'
op|'('
name|'line'
op|')'
newline|'\n'
name|'if'
name|'match'
name|'is'
name|'None'
op|':'
newline|'\n'
indent|'      '
name|'return'
name|'False'
newline|'\n'
dedent|''
name|'buffer'
op|'.'
name|'append'
op|'('
name|'line'
op|'.'
name|'replace'
op|'('
name|'match'
op|'.'
name|'group'
op|'('
number|'1'
op|')'
op|','
name|'new_version'
op|'.'
name|'dot'
op|')'
op|')'
newline|'\n'
name|'return'
name|'True'
newline|'\n'
nl|'\n'
dedent|''
name|'changed'
op|'='
name|'update_file'
op|'('
name|'filename'
op|','
name|'matcher'
op|','
name|'edit'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'done'"
name|'if'
name|'changed'
name|'else'
string|"'uptodate'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|check_lucene_version_tests
dedent|''
name|'def'
name|'check_lucene_version_tests'
op|'('
op|')'
op|':'
newline|'\n'
indent|'  '
name|'print'
op|'('
string|"'  checking lucene version tests...'"
op|','
name|'end'
op|'='
string|"''"
op|','
name|'flush'
op|'='
name|'True'
op|')'
newline|'\n'
name|'base_dir'
op|'='
name|'os'
op|'.'
name|'getcwd'
op|'('
op|')'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
string|"'lucene/core'"
op|')'
newline|'\n'
name|'run'
op|'('
string|"'ant test -Dtestcase=TestVersion'"
op|')'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
name|'base_dir'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'ok'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|check_solr_version_tests
dedent|''
name|'def'
name|'check_solr_version_tests'
op|'('
op|')'
op|':'
newline|'\n'
indent|'  '
name|'print'
op|'('
string|"'  checking solr version tests...'"
op|','
name|'end'
op|'='
string|"''"
op|','
name|'flush'
op|'='
name|'True'
op|')'
newline|'\n'
name|'base_dir'
op|'='
name|'os'
op|'.'
name|'getcwd'
op|'('
op|')'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
string|"'solr/core'"
op|')'
newline|'\n'
name|'run'
op|'('
string|"'ant test -Dtestcase=TestLuceneMatchVersion'"
op|')'
newline|'\n'
name|'os'
op|'.'
name|'chdir'
op|'('
name|'base_dir'
op|')'
newline|'\n'
name|'print'
op|'('
string|"'ok'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|read_config
dedent|''
name|'def'
name|'read_config'
op|'('
op|')'
op|':'
newline|'\n'
indent|'  '
name|'parser'
op|'='
name|'argparse'
op|'.'
name|'ArgumentParser'
op|'('
name|'description'
op|'='
string|"'Add a new version'"
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'add_argument'
op|'('
string|"'version'"
op|','
name|'type'
op|'='
name|'Version'
op|'.'
name|'parse'
op|')'
newline|'\n'
name|'parser'
op|'.'
name|'add_argument'
op|'('
string|"'-c'"
op|','
string|"'--changeid'"
op|','
name|'type'
op|'='
name|'str'
op|','
name|'help'
op|'='
string|"'Git ChangeId (commit hash) for downstream version change to merge'"
op|')'
newline|'\n'
name|'c'
op|'='
name|'parser'
op|'.'
name|'parse_args'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'c'
op|'.'
name|'branch_type'
op|'='
name|'find_branch_type'
op|'('
op|')'
newline|'\n'
name|'c'
op|'.'
name|'matching_branch'
op|'='
name|'c'
op|'.'
name|'version'
op|'.'
name|'is_bugfix_release'
op|'('
op|')'
name|'and'
name|'c'
op|'.'
name|'branch_type'
op|'=='
name|'BranchType'
op|'.'
name|'release'
name|'or'
name|'c'
op|'.'
name|'version'
op|'.'
name|'is_minor_release'
op|'('
op|')'
name|'and'
name|'c'
op|'.'
name|'branch_type'
op|'=='
name|'BranchType'
op|'.'
name|'stable'
name|'or'
name|'c'
op|'.'
name|'version'
op|'.'
name|'is_major_release'
op|'('
op|')'
name|'and'
name|'c'
op|'.'
name|'branch_type'
op|'=='
name|'BranchType'
op|'.'
name|'major'
newline|'\n'
nl|'\n'
name|'print'
op|'('
string|'"branch_type is %s "'
op|'%'
name|'c'
op|'.'
name|'branch_type'
op|')'
newline|'\n'
name|'if'
name|'c'
op|'.'
name|'changeid'
name|'and'
name|'c'
op|'.'
name|'version'
op|'.'
name|'is_major_release'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'parser'
op|'.'
name|'error'
op|'('
string|"'Cannot use --changeid for major release'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'c'
op|'.'
name|'changeid'
name|'and'
name|'c'
op|'.'
name|'matching_branch'
op|':'
newline|'\n'
indent|'    '
name|'parser'
op|'.'
name|'error'
op|'('
string|"'Cannot use --changeid on branch that new version will originate on'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'c'
op|'.'
name|'version'
op|'.'
name|'is_bugfix_release'
op|'('
op|')'
name|'and'
name|'c'
op|'.'
name|'branch_type'
name|'in'
op|'['
name|'BranchType'
op|'.'
name|'major'
op|','
name|'BranchType'
op|'.'
name|'stable'
op|']'
name|'and'
name|'not'
name|'c'
op|'.'
name|'changeid'
op|':'
newline|'\n'
indent|'    '
name|'parser'
op|'.'
name|'error'
op|'('
string|"'Adding bugfix release on master or stable branch requires --changeid'"
op|')'
newline|'\n'
dedent|''
name|'if'
name|'c'
op|'.'
name|'version'
op|'.'
name|'is_minor_release'
op|'('
op|')'
name|'and'
name|'c'
op|'.'
name|'branch_type'
name|'in'
op|'['
name|'BranchType'
op|'.'
name|'major'
op|']'
name|'and'
name|'not'
name|'c'
op|'.'
name|'changeid'
op|':'
newline|'\n'
indent|'    '
name|'parser'
op|'.'
name|'error'
op|'('
string|"'Adding minor release on master branch requires --changeid'"
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'return'
name|'c'
newline|'\n'
nl|'\n'
DECL|function|main
dedent|''
name|'def'
name|'main'
op|'('
op|')'
op|':'
newline|'\n'
indent|'  '
name|'c'
op|'='
name|'read_config'
op|'('
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'c'
op|'.'
name|'changeid'
op|':'
newline|'\n'
indent|'    '
name|'cherry_pick_change'
op|'('
name|'c'
op|'.'
name|'changeid'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'print'
op|'('
string|"'\\nAdding new version %s'"
op|'%'
name|'c'
op|'.'
name|'version'
op|')'
newline|'\n'
name|'update_changes'
op|'('
string|"'lucene/CHANGES.txt'"
op|','
name|'c'
op|'.'
name|'version'
op|')'
newline|'\n'
name|'update_changes'
op|'('
string|"'solr/CHANGES.txt'"
op|','
name|'c'
op|'.'
name|'version'
op|')'
newline|'\n'
name|'add_constant'
op|'('
name|'c'
op|'.'
name|'version'
op|','
name|'not'
name|'c'
op|'.'
name|'matching_branch'
op|')'
newline|'\n'
nl|'\n'
name|'if'
name|'not'
name|'c'
op|'.'
name|'changeid'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'\\nUpdating latest version'"
op|')'
newline|'\n'
name|'update_build_version'
op|'('
name|'c'
op|'.'
name|'version'
op|')'
newline|'\n'
name|'update_latest_constant'
op|'('
name|'c'
op|'.'
name|'version'
op|')'
newline|'\n'
name|'update_example_solrconfigs'
op|'('
name|'c'
op|'.'
name|'version'
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'c'
op|'.'
name|'version'
op|'.'
name|'is_major_release'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'\\nTODO: '"
op|')'
newline|'\n'
name|'print'
op|'('
string|"'  - Move backcompat oldIndexes to unsupportedIndexes in TestBackwardsCompatibility'"
op|')'
newline|'\n'
name|'print'
op|'('
string|"'  - Update IndexFormatTooOldException throw cases'"
op|')'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'\\nTesting changes'"
op|')'
newline|'\n'
name|'check_lucene_version_tests'
op|'('
op|')'
newline|'\n'
name|'check_solr_version_tests'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'print'
op|'('
op|')'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'  '
name|'try'
op|':'
newline|'\n'
indent|'    '
name|'main'
op|'('
op|')'
newline|'\n'
dedent|''
name|'except'
name|'KeyboardInterrupt'
op|':'
newline|'\n'
indent|'    '
name|'print'
op|'('
string|"'\\nReceived Ctrl-C, exiting early'"
op|')'
newline|'\n'
dedent|''
dedent|''
endmarker|''
end_unit
