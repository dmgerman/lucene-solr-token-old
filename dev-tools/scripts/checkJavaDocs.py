begin_unit
comment|'# Licensed to the Apache Software Foundation (ASF) under one or more'
nl|'\n'
comment|'# contributor license agreements.  See the NOTICE file distributed with'
nl|'\n'
comment|'# this work for additional information regarding copyright ownership.'
nl|'\n'
comment|'# The ASF licenses this file to You under the Apache License, Version 2.0'
nl|'\n'
comment|'# (the "License"); you may not use this file except in compliance with'
nl|'\n'
comment|'# the License.  You may obtain a copy of the License at'
nl|'\n'
comment|'#'
nl|'\n'
comment|'#     http://www.apache.org/licenses/LICENSE-2.0'
nl|'\n'
comment|'#'
nl|'\n'
comment|'# Unless required by applicable law or agreed to in writing, software'
nl|'\n'
comment|'# distributed under the License is distributed on an "AS IS" BASIS,'
nl|'\n'
comment|'# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.'
nl|'\n'
comment|'# See the License for the specific language governing permissions and'
nl|'\n'
comment|'# limitations under the License.'
nl|'\n'
nl|'\n'
name|'import'
name|'sys'
newline|'\n'
name|'import'
name|'os'
newline|'\n'
name|'import'
name|'re'
newline|'\n'
nl|'\n'
DECL|variable|reHREF
name|'reHREF'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"'<a.*?>(.*?)</a>'"
op|','
name|'re'
op|'.'
name|'IGNORECASE'
op|')'
newline|'\n'
nl|'\n'
DECL|variable|reMarkup
name|'reMarkup'
op|'='
name|'re'
op|'.'
name|'compile'
op|'('
string|"'<.*?>'"
op|')'
newline|'\n'
nl|'\n'
DECL|function|checkSummary
name|'def'
name|'checkSummary'
op|'('
name|'fullPath'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'printed'
op|'='
name|'False'
newline|'\n'
name|'f'
op|'='
name|'open'
op|'('
name|'fullPath'
op|')'
newline|'\n'
name|'anyMissing'
op|'='
name|'False'
newline|'\n'
name|'sawPackage'
op|'='
name|'False'
newline|'\n'
name|'desc'
op|'='
op|'['
op|']'
newline|'\n'
name|'lastHREF'
op|'='
name|'None'
newline|'\n'
name|'for'
name|'line'
name|'in'
name|'f'
op|'.'
name|'readlines'
op|'('
op|')'
op|':'
newline|'\n'
indent|'    '
name|'lineLower'
op|'='
name|'line'
op|'.'
name|'strip'
op|'('
op|')'
op|'.'
name|'lower'
op|'('
op|')'
newline|'\n'
name|'if'
name|'desc'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
comment|'# TODO: also detect missing description in overview-summary'
nl|'\n'
indent|'      '
name|'if'
name|'lineLower'
op|'.'
name|'startswith'
op|'('
string|"'package '"
op|')'
name|'or'
name|'lineLower'
op|'.'
name|'startswith'
op|'('
string|'\'<h1 title="package" \''
op|')'
op|':'
newline|'\n'
indent|'        '
name|'sawPackage'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'elif'
name|'sawPackage'
op|':'
newline|'\n'
indent|'        '
name|'if'
name|'lineLower'
op|'.'
name|'startswith'
op|'('
string|"'<table '"
op|')'
name|'or'
name|'lineLower'
op|'.'
name|'startswith'
op|'('
string|"'<b>see: '"
op|')'
op|':'
newline|'\n'
indent|'          '
name|'desc'
op|'='
string|"' '"
op|'.'
name|'join'
op|'('
name|'desc'
op|')'
newline|'\n'
name|'desc'
op|'='
name|'reMarkup'
op|'.'
name|'sub'
op|'('
string|"' '"
op|','
name|'desc'
op|')'
newline|'\n'
name|'desc'
op|'='
name|'desc'
op|'.'
name|'strip'
op|'('
op|')'
newline|'\n'
name|'if'
name|'desc'
op|'=='
string|"''"
op|':'
newline|'\n'
indent|'            '
name|'if'
name|'not'
name|'printed'
op|':'
newline|'\n'
indent|'              '
name|'print'
newline|'\n'
name|'print'
name|'fullPath'
newline|'\n'
name|'printed'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'print'
string|"'  no package description (missing package.html in src?)'"
newline|'\n'
name|'anyMissing'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'desc'
op|'='
name|'None'
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
indent|'          '
name|'desc'
op|'.'
name|'append'
op|'('
name|'lineLower'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'if'
name|'lineLower'
name|'in'
op|'('
string|"'<td>&nbsp;</td>'"
op|','
string|"'<td></td>'"
op|','
string|'\'<td class="collast">&nbsp;</td>\''
op|')'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'not'
name|'printed'
op|':'
newline|'\n'
indent|'        '
name|'print'
newline|'\n'
name|'print'
name|'fullPath'
newline|'\n'
name|'printed'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'print'
string|"'  missing: %s'"
op|'%'
name|'unescapeHTML'
op|'('
name|'lastHREF'
op|')'
newline|'\n'
name|'anyMissing'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'elif'
name|'lineLower'
op|'.'
name|'find'
op|'('
string|"'licensed to the apache software foundation'"
op|')'
op|'!='
op|'-'
number|'1'
name|'or'
name|'lineLower'
op|'.'
name|'find'
op|'('
string|"'copyright 2004 the apache software foundation'"
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'not'
name|'printed'
op|':'
newline|'\n'
indent|'        '
name|'print'
newline|'\n'
name|'print'
name|'fullPath'
newline|'\n'
name|'printed'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'print'
string|"'  license-is-javadoc: %s'"
op|'%'
name|'unescapeHTML'
op|'('
name|'lastHREF'
op|')'
newline|'\n'
name|'anyMissing'
op|'='
name|'True'
newline|'\n'
dedent|''
name|'m'
op|'='
name|'reHREF'
op|'.'
name|'search'
op|'('
name|'line'
op|')'
newline|'\n'
name|'if'
name|'m'
name|'is'
name|'not'
name|'None'
op|':'
newline|'\n'
indent|'      '
name|'lastHREF'
op|'='
name|'m'
op|'.'
name|'group'
op|'('
number|'1'
op|')'
newline|'\n'
dedent|''
dedent|''
name|'if'
name|'desc'
name|'is'
name|'not'
name|'None'
name|'and'
name|'fullPath'
op|'.'
name|'find'
op|'('
string|"'/overview-summary.html'"
op|')'
op|'=='
op|'-'
number|'1'
op|':'
newline|'\n'
indent|'    '
name|'raise'
name|'RuntimeError'
op|'('
string|"'BUG: failed to locate description in %s'"
op|'%'
name|'fullPath'
op|')'
newline|'\n'
dedent|''
name|'f'
op|'.'
name|'close'
op|'('
op|')'
newline|'\n'
name|'return'
name|'anyMissing'
newline|'\n'
nl|'\n'
DECL|function|unescapeHTML
dedent|''
name|'def'
name|'unescapeHTML'
op|'('
name|'s'
op|')'
op|':'
newline|'\n'
indent|'  '
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'&lt;'"
op|','
string|"'<'"
op|')'
newline|'\n'
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'&gt;'"
op|','
string|"'>'"
op|')'
newline|'\n'
name|'s'
op|'='
name|'s'
op|'.'
name|'replace'
op|'('
string|"'&amp;'"
op|','
string|"'&'"
op|')'
newline|'\n'
name|'return'
name|'s'
newline|'\n'
nl|'\n'
DECL|function|checkPackageSummaries
dedent|''
name|'def'
name|'checkPackageSummaries'
op|'('
name|'root'
op|','
name|'level'
op|'='
string|"'class'"
op|')'
op|':'
newline|'\n'
indent|'  '
string|'"""\n  Just checks for blank summary lines in package-summary.html; returns\n  True if there are problems.\n  """'
newline|'\n'
nl|'\n'
name|'if'
name|'level'
op|'!='
string|"'class'"
name|'and'
name|'level'
op|'!='
string|"'package'"
op|':'
newline|'\n'
indent|'    '
name|'print'
string|'\'unsupported level: %s, must be "class" or "package"\''
op|'%'
name|'level'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
comment|"#for dirPath, dirNames, fileNames in os.walk('%s/lucene/build/docs/api' % root):"
nl|'\n'
nl|'\n'
dedent|''
name|'if'
name|'False'
op|':'
newline|'\n'
indent|'    '
name|'os'
op|'.'
name|'chdir'
op|'('
name|'root'
op|')'
newline|'\n'
name|'print'
newline|'\n'
name|'print'
string|'\'Run "ant javadocs" > javadocs.log...\''
newline|'\n'
name|'if'
name|'os'
op|'.'
name|'system'
op|'('
string|"'ant javadocs > javadocs.log 2>&1'"
op|')'
op|':'
newline|'\n'
indent|'      '
name|'print'
string|"'  FAILED'"
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
name|'anyMissing'
op|'='
name|'False'
newline|'\n'
name|'for'
name|'dirPath'
op|','
name|'dirNames'
op|','
name|'fileNames'
name|'in'
name|'os'
op|'.'
name|'walk'
op|'('
name|'root'
op|')'
op|':'
newline|'\n'
nl|'\n'
indent|'    '
name|'if'
name|'dirPath'
op|'.'
name|'find'
op|'('
string|"'/all/'"
op|')'
op|'!='
op|'-'
number|'1'
op|':'
newline|'\n'
comment|'# These are dups (this is a bit risk, eg, root IS this /all/ directory..)'
nl|'\n'
indent|'      '
name|'continue'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
string|"'package-summary.html'"
name|'in'
name|'fileNames'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'level'
op|'!='
string|"'package'"
name|'and'
name|'checkSummary'
op|'('
string|"'%s/package-summary.html'"
op|'%'
name|'dirPath'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'anyMissing'
op|'='
name|'True'
newline|'\n'
dedent|''
dedent|''
name|'if'
string|"'overview-summary.html'"
name|'in'
name|'fileNames'
op|':'
newline|'\n'
indent|'      '
name|'if'
name|'checkSummary'
op|'('
string|"'%s/overview-summary.html'"
op|'%'
name|'dirPath'
op|')'
op|':'
newline|'\n'
indent|'        '
name|'anyMissing'
op|'='
name|'True'
newline|'\n'
nl|'\n'
dedent|''
dedent|''
dedent|''
name|'return'
name|'anyMissing'
newline|'\n'
nl|'\n'
dedent|''
name|'if'
name|'__name__'
op|'=='
string|"'__main__'"
op|':'
newline|'\n'
indent|'  '
name|'if'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|')'
op|'<'
number|'2'
name|'or'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|')'
op|'>'
number|'3'
op|':'
newline|'\n'
indent|'    '
name|'print'
string|"'usage: %s <dir> [class|package]'"
op|'%'
name|'sys'
op|'.'
name|'argv'
op|'['
number|'0'
op|']'
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
dedent|''
name|'if'
name|'len'
op|'('
name|'sys'
op|'.'
name|'argv'
op|')'
op|'=='
number|'2'
op|':'
newline|'\n'
DECL|variable|level
indent|'    '
name|'level'
op|'='
string|"'class'"
newline|'\n'
dedent|''
name|'else'
op|':'
newline|'\n'
DECL|variable|level
indent|'    '
name|'level'
op|'='
name|'sys'
op|'.'
name|'argv'
op|'['
number|'2'
op|']'
newline|'\n'
dedent|''
name|'if'
name|'checkPackageSummaries'
op|'('
name|'sys'
op|'.'
name|'argv'
op|'['
number|'1'
op|']'
op|','
name|'level'
op|')'
op|':'
newline|'\n'
indent|'    '
name|'print'
newline|'\n'
name|'print'
string|"'Missing javadocs were found!'"
newline|'\n'
name|'sys'
op|'.'
name|'exit'
op|'('
number|'1'
op|')'
newline|'\n'
dedent|''
name|'sys'
op|'.'
name|'exit'
op|'('
number|'0'
op|')'
newline|'\n'
dedent|''
endmarker|''
end_unit
